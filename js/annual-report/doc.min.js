var docChart,Doc;function import$(t,e){var n,a={}.hasOwnProperty;for(n in e)a.call(e,n)&&(t[n]=e[n]);return t}function in$(t,e){for(var n=-1,a=e.length>>>0;++n<a;)if(t===e[n])return!0;return!1}docChart={cut3:function(t){var e=t.ctrl,n=t.view,t=e;return(e=docChart.cut3.obj)||(docChart.cut3.obj=e={},n=n.getAll("chart").filter(function(t){return"cut3"===t.getAttribute("data-name")})[0],e.aniloop=new aniloop,e.timeline=new timeline({aniloop:e.aniloop}),e.aniloop.setTimeline(e.timeline),e.active={year:t.getYears()[0]},e.svg={map:ld$.find(n,"[ld=map]",0),bar:ld$.find(n,"[ld=bar]",0),bubble:ld$.find(n,"[ld=bubble]",0)},e.subchart={map:new subchart.map(((n={host:e,svg:e.svg.map,demo:!0}).timeline=e.timeline,n.aniloop=e.aniloop,n)),bar:new subchart.bar(((n={host:e,svg:e.svg.bar,demo:!0}).timeline=e.timeline,n.aniloop=e.aniloop,n)),bubble:new subchart.bubble(((n={host:e,svg:e.svg.bubble,demo:!0}).timeline=e.timeline,n.aniloop=e.aniloop,n))}),e.values=t.getValues(),e.years=t.getYears(),e.valtypes=t.getValtypes(),e.categories=t.getCategories().map(function(t){return t.name}),e.scale=t.scale,e.subchart.bar.prepare()},cut2:function(t){var e=t.ctrl,n=(t.view,e),a={svg:{trend:null},lines:n.lines,ptsValid:n.ptsValid,scale:n.scale,mode:n.getMode(),bipolar:n.getBipolar()},r=n.scale.x.range(),i=n.scale.y.range(),c=ld$.find("[ld=chart][data-name=cut2]",0),o=c.getBoundingClientRect(),l=(r[1]+r[0])/2,t=(i[1]+i[0])/2,e=(o.width-20)/(r[1]-r[0]),o=Math.abs((o.height-20)/(i[1]-i[0])),r=[(r[1]-r[0])*e,(i[0]-i[1])*o],i=r[0],r=r[1];if(a.svg.trend=ld$.find(c,"[ld=line]",0),a.svg.trend.setAttribute("transform","translate("+(10+i/2)+","+(10+r/2)+") scale("+e+","+o+") translate("+-l+", "+-t+")"),n.renderLine.apply(a),n.renderCircle.apply(a),n.renderRect.apply(a),"年份"!==n.getValtype({alt:!0}))return d3.select(a.svg.trend).selectAll("path").each(function(t,e){if("廣播電視"===t.catname)return d3.select(this).attr("highlight",!0)})},cut1:function(t){var a,e,n,r,i,c,o,l,u=t.ctrl,s=t.bar,d=t.view,g=u,v={svg:{trend:null},lines:g.lines,ptsValid:g.ptsValid,scale:g.scale};return"value"===g.getMode()&&(v.scale=import$({},g.scale),v.scale.y=d3.scaleLinear().domain([0,g.scale.y.domain()[1]]).range(g.scale.y.range())),o=g.scale.x.range(),a=g.scale.y.range(),c=d.get("bar").parentNode.getBoundingClientRect(),e=(o[1]+o[0])/2,n=(a[1]+a[0])/2,r=10,t=(c.width-20)/(o[1]-o[0]),i=Math.abs((c.height-20)/(a[1]-a[0])),c=(u=[(o[1]-o[0])*t,(a[0]-a[1])*i])[0],o=u[1],(u=g.bands[0].pts.map(function(t){return t})).sort(function(t,e){return isNaN(t.y)?1:isNaN(e.y)?-1:e.y-t.y}),l={x:d3.scaleBand().range(g.scale.x.range()).domain(u.map(function(t){return t.catname})).paddingInner(.2)},d3.select(d.get("line")).transition().duration(350).attr("opacity",s?0:1),d3.select(d.get("bar")).transition().duration(350).attr("opacity",s?1:0),s?(v.svg.trend=d.get("bar"),v.svg.trend.setAttribute("transform","translate("+(r+c/2)+","+(r+o/2)+") scale("+t+","+i+") translate("+-e+", "+-n+")"),(u=(s=d3.select(v.svg.trend)).selectAll("rect").data(u)).exit().remove(),u.enter().append("rect").attr("x",function(t,e){return l.x(t.catname)}).attr("width",function(t,e){return l.x.bandwidth()}).attr("y",function(){return a[0]}).attr("height",function(){return 1/i}).attr("fill",function(t,e){return g.scale.color(t.catname)}),s.selectAll("rect").transition().duration(350).attr("x",function(t,e){return l.x(t.catname)}).attr("width",function(t,e){return l.x.bandwidth()}).attr("y",function(t,e){var n;return(n=isNaN(t.y)?a[0]:g.scale.y(t.y))<(t=a[0]-1/i)?n:t}).attr("height",function(t,e){var n;return(n=isNaN(t.y)?1/i:a[0]-g.scale.y(t.y))>(t=1/i)?n:t}).attr("fill",function(t,e){return g.scale.color(t.catname)})):(v.svg.trend=d.get("line"),v.svg.trend.setAttribute("transform","translate("+(r+c/2)+","+(r+o/2)+") scale("+t+","+i+") translate("+-e+", "+-n+")"),g.renderLine.apply(v),g.renderCircle.apply(v))}},Doc=function(t){var e,n=t.ctrl,a=n,r=!0,i=new ldView({root:document.body,action:{click:{highlight:function(t){t=(t.node.getAttribute("data-name")||"").split(",");return a.render({highlight:t}),i.render(["chart"])},"cut1-view":function(t){var e=t.node;return i.getAll("cut1-view").map(function(t){return t.classList.toggle("active",e===t)}),a.setMode("value",!0),docChart.cut1({ctrl:n,bar:r="bar"===e.getAttribute("data-name"),view:i})},"cut2-view":function(t){t=t.node;return a.setMode(t.getAttribute("data-name"),!0),docChart.cut2({ctrl:n,view:i}),i.render(["cut2-view"]),i.render(["cut1-view"])},"cut2-custom":function(t){t.node;return a.setValtype("家數"),a.setValtype("營業額",!0)},"cut3-play":function(t){t.node;return docChart.cut3.obj.aniloop.toggle()},"cut3-view":function(t){t=t.node;return docChart.cut3.obj.mode=t.getAttribute("data-name")},"clear-valtype-alt":function(){return a.setValtype("年份",!0)},"set-cat":function(t){var e=t.node.getAttribute("data-name");return i.getAll("set-cat").map(function(t){return t.classList.toggle("active",t.getAttribute("data-name")===e)}),debounce(150).then(function(){return a.setCattype(e),i.render(["choose-cat","choose-val","category","chart"])})},"cat-all":function(){return a.toggleActiveCategories("全選")},"cat-none":function(){return a.toggleActiveCategories("全不選")},"cat-toggle":function(t){var e=t.node;return(t=e.getAttribute("data-cattype"))&&a.setCattype(t),a.toggleActiveCategories((e.getAttribute("data-name")||"").split(","))},"cat-set":function(t){var e=t.node;return(t=e.getAttribute("data-cattype"))&&a.setCattype(t),a.setActiveCategories((e.getAttribute("data-name")||"").split(","))},"cat-hide":function(t){var e,n=t.node;return(t=n.getAttribute("data-cattype"))&&a.setCattype(t),e=(n.getAttribute("data-name")||"").split(","),n=a.getCategories().map(function(t){return t.name}).filter(function(t){return!in$(t,e)}),a.setActiveCategories(n)}},input:{"choose-view":function(t){t=t.node;return a.setMode(t.value,!0),i.render(["choose-view","chart"])},"choose-val":function(t){var e=t.node,t=e.hasAttribute("data-alt")&&"false"!==e.getAttribute("data-alt");return a.setValtype(e.value,t),i.render(["choose-val","chart"])},"choose-cat":function(t){t=t.node;return a.setCattype(t.value),i.render(["choose-cat","choose-val","category","chart"])}}},handler:{chart:function(t){var e=t.node;return debounce(100).then(function(){var t=e.getAttribute("data-name");return docChart[t]({ctrl:n,bar:r,view:i})})},"choose-cat":function(t){return t.node.value=a.getCattype()},valtype:function(t){var e=t.node,t=e.hasAttribute("data-alt")&&"false"!==e.getAttribute("data-alt"),n=a.getValtype({alt:t}),t=["年份","外銷","內銷","家數","營業額"].filter(function(t){return~n.indexOf(t)})[0];return e.innerText=t||n},"choose-val":function(t){var e=t.node,t=e.hasAttribute("data-alt")&&"false"!==e.getAttribute("data-alt"),n=a.getValtype({alt:t}),t=["年份","外銷","內銷","家數","營業額"].filter(function(t){return~n.indexOf(t)})[0];return e.value=t||n},"choose-view":function(t){return t.node.value=a.getMode()},"cut2-view":function(t){t=t.node;return t.classList.toggle("active",a.getMode()===t.getAttribute("data-name"))},category:{key:function(t){return t.name},list:function(){return a.getCategories().concat([{name:"全不選",active:!0},{name:"全選",active:!0}])},action:{click:function(t){t=t.data;return a.toggleActiveCategories(t.name)}},handler:function(t){var e=t.node,n=t.data,t=t.idx;return e.style.animationDelay=t/40+"s",e.classList.toggle("d-flex",!0),e.classList.toggle("d-none",!1),ld$.find(e,"span",0).innerText=n.name,ld$.find(e,"div",0).style.background=a.scale.color(n.name),e.classList.toggle("inactive",!n.active)}}}});return a.on("active-categories-changed",function(){return i.render(["category","chart"])}),a.on("cattype-changed",function(){return i.render(["category","chart"])}),a.on("mode-changed",function(){return i.render(["category","cut2-view","chart"])}),a.on("bipolar-changed",function(){return i.render(["category","chart"])}),a.on("valtype-changed",function(){return i.render(["category","chart","choose-val","valtype"])}),e={},function(t){return t.map(function(t){return e[t.target.getAttribute("ld")]=t.isIntersecting})}};