function import$(t,e){var a,i={}.hasOwnProperty;for(a in e)i.call(e,a)&&(t[a]=e[a]);return t}subchart.bar=function(t){return this.host=(t=null==t?{}:t).host,this.svg=t.svg,this.demo=t.demo,this.timeline=t.timeline,this.aniloop=t.aniloop,this},subchart.bar.prototype=import$(import$(Object.create(Object.prototype),subchart.interface),{len:10,timeDelta:0,scale:{},hide:function(){return this.svg.classList.toggle("d-none",!0)},prepare:function(){var t,a,i,e;if(this.svg.classList.toggle("d-none",!1),this.box=this.svg.getBoundingClientRect(),this.values=(e=this.host).values,this.years=e.years,this.valtypes=e.valtypes,this.categories=e.categories,e=(t=[this.timeline,this.aniloop])[0],(t=t[1]).setObj(this),e.set({years:this.years,svg:this.svg}),t.reset(),e=function(){var t,e=[];for(a in t=this.values)i=t[a],e.push([a,i]);return e}.call(this).filter(function(t){return!("合計"===t[0])}).map(function(t){return t[1].map(function(t){return+t}).filter(function(t){return!isNaN(t)})}),Math.min.apply(Math,e.map(function(t){return Math.min.apply(Math,t)})),e=Math.max.apply(Math,e.map(function(t){return Math.max.apply(Math,t)})),this.textLen=Math.max.apply(Math,this.categories.map(function(t){return t.length})),this.data=this.categories.filter(function(t){return!("合計"===t)}).map(function(t,e){return{key:t,val:0}}),this.dh=(this.box.height-80)/this.data.length,this.demo?this.scale=d3.scaleLinear().domain([0,e]).range([14*this.textLen+10,this.box.width-30]):this.scale=d3.scaleLinear().domain([0,e]).range([20*this.textLen+10,this.box.width-30]),this.host.active)return t.setTime(1e3*(this.host.active.year-this.years[0]),!0),t.pause(),t.render()},delta:function(t){var i=this,e=t/1e3,s=Math.floor(e),r=e-s;if(s%=this.years.length-1,aniloop.main.time.keep&&!s&&0<t&&(s=this.years.length-1),this.data.map(function(t,e){var a=+i.values[t.key][s],t=+i.values[t.key][(s+1)%i.years.length];if(a=isNaN(a)?0:a,t=isNaN(t)?0:t,i.data[e].val=(t-a)*r+a,aniloop.main.time.keep)return i.data[e].val=a}),this.data.sort(function(t,e){return e.val>t.val?1:e.val<t.val?-1:0}),this.data.map(function(t,e){return t.idx!==e&&(null==t.odx&&(t.odx=e),t.idx=e),t.odx=.2*(t.idx-t.odx)+t.odx}),aniloop.main.time.keep)return this.render(t)},render:function(t){var i=this,s=this,e=d3.select(this.svg).selectAll("g.bar").data(this.data,function(t){return t.key});if(e.exit().remove(),e.enter().append("g").attr("class","bar").each(function(t,e){return d3.select(this).append("rect"),d3.select(this).append("text").attr("class","value").attr("opacity",s.demo?0:1),d3.select(this).append("text").attr("class","label").attr("text-anchor","end").attr("dy",".38em").attr("opacity",(s.demo,1))}),d3.select(this.svg).selectAll("g.bar").attr("transform",function(t,e){var a=t.odx*(i.dh+1)+10;return"translate(10,"+(a=aniloop.main.time.keep?t.idx*(i.dh+1)+10:a)+")"}).each(function(t,e){var a=s.scale(t.val)-s.scale(0),i=t.val;return i=1e4<i?Number(i/1e3).toFixed(1)+"k":Number(i).toFixed(2),d3.select(this).select("text.label").text(t.key).attr("x",s.scale(0)-10).attr("y",s.dh/2),d3.select(this).select("text.value").attr("x",s.scale(t.val)+(200<a?-5:5)).attr("y",s.dh/2).attr("dy",".38em").attr("text-anchor",200<a?"end":"start").text(i),d3.select(this).select("rect").attr("x",s.scale(0)).attr("width",a).attr("height",function(){return s.dh}).attr("fill",function(){return s.host.scale.color(t.key)})}),!this.demo)return this.chartInfo(t,"right")}});