ld$.fetch("/assets/data/annual-report/industry.json",{method:"GET"},{type:"json"}).then(function(l){var c,t,e,n,r,a,i,u,o,d,s,h,f,p,g,m,y,v=svg.getBoundingClientRect(),w=10;for(e in console.log(l),c=l.label.map(function(t){return+t}),t=[],n=l.attr)for(a in r=n[e])for(i=r[a],u=0,o=c.length;u<o;++u)d=u,t.push({type:e,cat:a,year:c[d],value:+i[d]});return s=function(){var t=[];for(h in l.attr["外銷收入占比"])t.push(h);return t}().map(function(n){for(var t,e=c.map(function(t,e){return[t,+l.attr["外銷收入占比"][n][e],0,0]}),r=0,a=0,i=e.length;a<i;++a)r+=e[t=a][1],e[t][3]=r;for(a=0,i=e.length;a<i;++a)e[t=a][2]=e[t][1]/r,e[t][3]=e[t][3]/r;return e}),d3.scaleLinear().domain([0,s.length-1]).range([w,v.width-w]),f=d3.scaleBand().domain(c).range([w,v.width-w]),d3.scaleLinear().domain([Math.min.apply(Math,c),Math.max.apply(Math,c)]).range([w,v.width-w]),p=Math.min.apply(Math,s.map(function(t){return Math.min.apply(Math,t.map(function(t){return t[1]}).filter(function(t){return!isNaN(t)}))})),g=Math.max.apply(Math,s.map(function(t){return Math.max.apply(Math,t.map(function(t){return t[1]}).filter(function(t){return!isNaN(t)}))})),m=d3.scaleLinear().domain([p,g]).range([v.height-w,w]),y=d3.scaleLinear().domain([0,1]).range([w,v.height-w]),v=d3.line().curve(d3.curveCardinal).defined(function(t){return!isNaN(t[1])}).x(function(t){return f(t[0])+f.bandwidth()/2}).y(function(t){return m(t[1])}),(w=d3.select("svg").selectAll("path").data(s)).enter().append("path").attr("d",v).attr("stroke","#000").attr("stroke-width","1").attr("fill","none"),w.exit().remove(),d3.select("svg").selectAll("g").data(s).enter().append("g"),d3.select("svg").selectAll("g").each(function(t,e){var n=this;return console.log(t),d3.select(this).selectAll("circle").data(t.filter(function(t){return!isNaN(t[1])})).enter().append("circle"),d3.select(this).selectAll("circle").attr("cx",function(t){return f(t[0])+f.bandwidth()/2}).attr("cy",function(t){return m(t[1])}).attr("r",3).attr("fill","#fff").attr("stroke","black").attr("stroke-width",1),d3.select(this).selectAll("rect").data(t.filter(function(t){return!isNaN(t[1])})).enter().append("rect"),d3.select(this).selectAll("rect").attr("x",function(t,e){return f(t[0])+f.bandwidth()/2}).attr("y",function(t){return m(t[1])}).attr("width",function(t){return 0}).attr("height",function(t){return 0}).attr("fill",function(t,e){return d3.interpolateSpectral((t[0]-2008)/10)}).attr("stroke","#000").attr("stroke-width","1"),setTimeout(function(){return d3.select(n).selectAll("rect").transition().duration(1e3).attr("x",function(t,e){return f(t[0])}).attr("y",function(t){return y(t[3]-t[2])}).attr("width",function(t){return f.bandwidth()}).attr("height",function(t){return y(t[3])-y(t[3]-t[2])})},1e3)})});