function import$(t,e){var i,n={}.hasOwnProperty;for(i in e)n.call(e,i)&&(t[i]=e[i]);return t}subchart.map=function(t){return this.host=(t=null==t?{}:t).host,this.svg=t.svg,this.aniloop=t.aniloop,this.timeline=t.timeline,this},subchart.map.prototype=import$(import$(Object.create(Object.prototype),subchart.interface),{hide:function(){return this.svg.classList.toggle("d-none",!0)},prepare:function(){var t,e,i,n=this;return this.values=(t=this.host).values,this.years=t.years,this.valtypes=t.valtypes,this.categories=t.categories,this.svg.classList.toggle("d-none",!1),this.box=this.svg.getBoundingClientRect(),this.popup=debounce(350,function(t){return n._popup(t)}),t=[this.timeline,this.aniloop],e=t[0],i=t[1],(this.inited?Promise.resolve():(this.pdmap=pdmaptw.create({root:this.svg,type:"county",baseurl:"assets/lib/pdmaptw/main",padding:40}),this.pdmap.init().then(function(){return n.inited=!0}))).then(function(){if(n.pdmap.fit(),i.setObj(n),e.set({years:n.years,svg:n.svg}),i.reset(),n.host.active)return i.setTime(1e3*(n.host.active.year-n.years[0])),i.pause(),i.render()})},delta:function(){},_popup:function(t){var e,i,n,r,s=this;return this.view||(this.view=new ldView({root:ld$.find("[ld-scope=perspective-popup]",0),context:t,handler:{popup:function(){},catname:function(t){var e=t.node,t=t.context;if(t)return e.innerText=t.properties.name},unit:function(t){var e=t.node;t.context;return e.innerText=s.host.unit},valname:function(t){var e=t.node;t.context;return e.innerText=s.host.valtype},value:function(t){var e=t.node,t=t.context;if(t)return e.innerText=t.properties.value}}})),e=this.view.get("popup"),t?(this.view.setContext(t),this.view.render(),n=(i=[(r=t.properties.node.getBoundingClientRect()).x+r.width/2,r.y+r.height/2])[0],t=i[1],i[2],r=e.getBoundingClientRect(),import$(e.style,{left:n+"px",top:(t>this.box.height/2?t-r.height:t+r.height)+"px",opacity:1})):((i=e.style).opacity=0,i)},render:function(t){var e;if(this.dataset=this.host.dataset,e=timeline.getTime(),!t||this.activeTime!==Math.floor(e))return this.activeTime=Math.floor(e),this.renderAlt(t)},renderAlt:function(t){var n,e,i,r,s,a,o,l,p=this;return this.dataset=this.host.dataset,n=this.dataset["縣市"].attr[this.host.valtype].data,e=this.dataset["縣市"].label,o=function(){var t,e=[];for(i in t=n)r=t[i],e.push([i,r]);return e}().filter(function(t){return!("無法區分"===(t=t[0])||"合計"===t)}).map(function(t){return t[1].map(function(t){return+t}).filter(function(t){return!isNaN(t)})}),l=Math.min.apply(Math,o.map(function(t){return Math.min.apply(Math,t)})),o=Math.max.apply(Math,o.map(function(t){return Math.max.apply(Math,t)})),s=this.activeTime%e.length,d3.select(this.svg).select("g.pdmaptw").selectAll("path").each(function(t,e){var i=t.properties.name.replace(/台/g,"臺");return t.properties.value=+n[i][s],t.properties.node=this}).on("mouseover",function(t,e){return p.popup.clear(),p.popup(t)}).on("mouseout",function(t,e){return p.popup()}),l=(a=d3.scaleSequential(d3.interpolateCividis).domain([l,o])).ticks(5),d3.select(this.svg).select("g.pdmaptw").selectAll("path").transition().duration(350).attr("fill",function(t){return a(t.properties.value)}),(o=d3.select(this.svg).selectAll("text.unit").data([1],function(t){return t})).exit().remove(),o.enter().append("text").attr("class","unit"),d3.select(this.svg).selectAll("text.unit").text("單位: "+this.host.unit).attr("x",16).attr("y",24).attr("font-size",".8em"),(o=d3.select(this.svg).selectAll("g.color-legends").data([1],function(t){return t})).exit().remove(),o.enter().append("g").attr("class","color-legends"),d3.select(this.svg).selectAll("g.color-legends").attr("transform","translate(24,42)"),(l=d3.select(this.svg).select("g.color-legends").selectAll("g.color-legend").data(l)).exit().remove(),l.enter().append("g").attr("class","color-legend").each(function(t,e){return d3.select(this).append("circle"),d3.select(this).append("text")}),d3.select(this.svg).selectAll("g.color-legend").attr("transform",function(t,e){return"translate(0,"+20*e+")"}).each(function(t,e){return d3.select(this).select("circle").attr("fill",a(t)).attr("r",6),d3.select(this).select("text").attr("dy",".38em").attr("dx",9).attr("font-size",".8em").text(t)}),this.chartInfo(t,"right")}});