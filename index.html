<!DOCTYPE html><html><head><meta http-equiv="Content-type" content="text/html;charset=UTF-8"><base href="/"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1"><link rel="stylesheet" type="text/css" href="assets/lib/bootstrap/main/css/bootstrap.min.css?v=bceabf5"><link rel="stylesheet" type="text/css" href="assets/lib/@loadingio/bootstrap.ext/main/index.min.css?v=bceabf5"><link rel="stylesheet" type="text/css" href="assets/lib/ldiconfont/main/ldif.css?v=bceabf5"><link rel="stylesheet" type="text/css" href="assets/lib/ldslider/main/ldrs.min.css?v=bceabf5"><link rel="stylesheet" type="text/css" href="assets/lib/ldcover/main/ldcv.min.css?v=bceabf5"><link rel="stylesheet" type="text/css" href="assets/lib/ldloader/main/ldld.min.css?v=bceabf5"><link rel="stylesheet" type="text/css" href="assets/lib/ldbutton/main/ldbtn.min.css?v=bceabf5"><link rel="stylesheet" type="text/css" href="assets/lib/ldpalettepicker/main/index.min.css?v=bceabf5"><link rel="stylesheet" type="text/css" href="assets/lib/@loadingio/loading.css/main/loading.min.css?v=bceabf5"><link rel="stylesheet" type="text/css" href="assets/lib/@loadingio/transition.css/main/transition.min.css?v=bceabf5"><link rel="stylesheet" type="text/css" href="assets/lib/@loadingio/ldcolorpicker/main/ldcp.min.css?v=bceabf5"><link rel="stylesheet" type="text/css" href="assets/lib/@plotdb/sheet/main/index.min.css?v=bceabf5"><link rel="stylesheet" type="text/css" href="assets/lib/clusterize.js/main/clusterize.css?v=bceabf5"><link rel="stylesheet" type="text/css" href="css/panel.css?v=bceabf5"><link rel="stylesheet" type="text/css" href="css/index.css?v=bceabf5"><link rel="stylesheet" type="text/css" href="assets/lib/@plotdb/chart/main/chart.min.css?v=bceabf5"><title>文化內容產業概況</title><style type="text/css">#root {
  width: 1024px;
  height: 100%;
  display: flex;
  margin: auto;
}
#side-panels {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: end;
  position: relative;
  width: 260px;
  height: 100%;
}
#main-panel {
  flex: 1 0 auto;
  display: flex;
  align-items: center;
  margin-left: 1.5em;
  max-width: 90vh;
}
.main-panel-inner {
  padding: 0.5em 1.5m 1.5em 1.5em;
  display: flex;
  flex-direction: column;
  height: 100%;
}
.side-panel {
  opacity: 0;
  transition: all 0.15s ease-in-out;
  position: absolute;
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: flex-end;
  z-index: 1;
}
.side-panel.active {
  opacity: 1;
  z-index: 2;
}
@media (min-width: 961px) and (min-height: 700px) {
  .d-mdh-none {
    display: none !important;
  }
  .d-mdh-block {
    display: block !important;
  }
}
@media (max-width: 1024px) {
  #root {
    width: 100%;
    padding: 1em;
    display: block;
  }
  #side-panels {
    width: 100%;
    height: 100%;
  }
  #main-panel {
    margin: 0;
  }
  .side-panel {
    display: none;
    position: relative;
    margin-bottom: 3em;
    align-items: stretch;
  }
  .side-panel.active {
    display: flex;
  }
  .main-panel-inner {
    padding: 0;
    display: flex;
    flex-direction: column;
    height: 100%;
  }
}
.dataset-item:hover {
  background: rgba(0,0,0,0.5);
}
.dataset-item.active {
  background: #09f;
  color: #fff;
}
</style></head><body><div class="w-100 h-100 ld ld-over-inverse running" ld="loader"><div class="ld" style="width:100%;height:100%;top:0;left:0;"><img style="left:0;right:0;margin:-2.5em auto 0;width:5em;height:5em;" src="/assets/img/loader.svg"><div style="width:max-content;left:0;right:0;margin:2.5em auto 0;text-align:center;"><div class="text-sm">程式載入中<br>請稍候 ...</div></div></div><div id="root"><div id="side-panels"><div class="side-panel" ld-scope="" ld="panel list-scope" data-name="list"><div class="w-100 d-flex flex-column" style="height:80%"><div class="d-flex justify-content-end" style="flex:0 0 auto"><h5>產調詳細數據</h5></div><div class="rounded p-3 text-right pnl" style="flex:0 0 auto"><div class="d-flex mb-2 align-items-center justify-content-end text-sm" style="line-height:1em"><div class="rounded-circle mr-2" style="height:.9em;width:.9em;" ld="picked-cat-color"></div><div><span ld="picked-cat"></span>產業</div></div><div class="mb-1" ld="picked-cat-color" style="width:100%;border-radius:2px;height:2px"></div><div class="text-hl" style="min-height:3em" ld="picked-name">...</div></div><div class="text-left pnl mt-3 px-0 pb-0" style="flex:1 0 100px"><div class="d-flex flex-column h-100"><div class="px-3"><input class="form-control mb-3" style="border-color:rgba(255,255,255,.2);background:rgba(0,0,0,.5)" ld="dataset-search-field" placeholder="搜尋資料 ... "></div><div class="flex-grow-1" style="overflow-y:scroll"><div class="px-3 py-1 dataset-item" ld="no-data-item">沒有資料符合搜尋條件</div><div class="dataset-item py-1 px-3 clickable" ld-each="data-item"><div class="d-flex align-items-stretch"><div style="flex:0 0 auto;padding:.2em 0"><div class="mr-2 h-100" style="width:.25em;border-radius:.1em" ld="dataset-color"></div></div><div class="flex-grow-1" ld="dataset-name">...</div></div></div></div></div></div></div></div><div class="side-panel" ld-scope="" ld="panel" data-name="config"><div class="text-right mb-4"><div class="btn btn-sm btn-outline-secondary" ld="close-panel">關閉面板 <i class="i-close"></i></div></div><h3>設定</h3><div class="position-relative"><div ld-each="tab"><div class="config mb-4" ld-each="config"></div></div></div></div><div class="side-panel" ld-scope="" ld="panel" data-name="detail"><div class="text-right mb-4"><div class="btn btn-sm btn-outline-secondary" ld="close-panel">關閉面板 <i class="i-close"></i></div></div><h3 class="w-100 border-bottom border-dark pb-2 mb-2 text-right text-hl" ld="cat2">...</h3><p class="text-right mb-4" ld="cat1"></p><div class="mb-4" style="display:grid;gap:.25em;grid-template-columns:1fr 1fr 2.2em"><div>產值</div><div class="text-right text-hl" ld="value" data-name="產值">0</div><div class="text-left">億元</div><div>出口值</div><div class="text-right text-hl" ld="value" data-name="出口值">0</div><div class="text-left">億元</div><div>就業人數</div><div class="text-right text-hl" ld="value" data-name="就業人數">0</div><div class="text-left">人</div><div>營利事業家數</div><div class="text-right text-hl" ld="value" data-name="家數">0</div><div class="text-left">家</div></div><h5 class="text-right pt-4"><span ld="dimension"></span>歷年走勢</h5><div class="aspect-ratio ratio-2by1"><div class="rounded p-2 position-relative" style="background:rgba(0,0,0,.5)" ld="detail-chart"><div class="position-absolute w-100 h-100 z-fixed" ld="detail-chart-disabled" style="top:0;left:0"><div class="d-flex align-items-center justify-content-center w-100 h-100 bg-dark" ld="detail-chart-disabled"><span>資料不足，無法顯示走勢</span></div></div></div></div></div><div class="side-panel active" ld="panel" data-name="overview"><h3 class="border-bottom border-dark pb-2 mb-3">文化內容產業概況</h3><div class="d-flex clickable mb-3" style="line-height:1em;margin-right:-.5em;color:#ddd"><div class="p-2 mr-2 rounded" ld="dimension-tab" data-name="產值">產值</div><div class="p-2 rounded" ld="dimension-tab" data-name="出口值">出口值</div><div class="p-2 mr-2 rounded" ld="dimension-tab" data-name="就業人數">就業人數</div><div class="p-2 mr-2 rounded" ld="dimension-tab" data-name="家數">家數</div></div><div class="mb-4 text-lg text-right pnl w-100 pt-3"><div class="dropright text-sm" ld="dropdown"><div class="text-sm dropdown-toggle clickable" data-toggle="dropdown"><span ld="year"></span> 年</div><div class="dropdown-menu shadow"><div class="dropdown-item" ld-each="year-item"></div></div></div><div>產業總<span ld="dimension">就業人數</span></div><div class="d-flex justify-content-end align-items-baseline"><h1 class="m-0" style="line-height:1em" ld="value" data-name="總數">0</h1><div class="text-sm" ld="unit">人</div></div></div><div class="text-lg mb-2">子產業</div><div class="w-100" style="display:grid;grid-template-columns:1fr 1fr;grid-template-rows:1fr 1fr;gap:1em"><div class="text-right pnl hover d-flex align-items-stretch justify-content-between" style="padding:.75em"><div class="rounded mr-2" ld="cat-color" data-name="遊戲" style="width:.75em;height:100%;background:#d55741"></div><div class="text-right"><div>遊戲</div><div class="d-flex justify-content-end align-items-baseline"><div class="m-0" style="font-weight:700;font-size:1.25em;line-height:1em" ld="value" data-name="遊戲">0</div><div class="text-nowrap" style="font-size:10px" ld="unit">人</div></div></div></div><div class="text-right pnl hover d-flex align-items-stretch justify-content-between" style="padding:.75em"><div class="rounded mr-2" ld="cat-color" data-name="流行音樂" style="width:.75em;height:100%;background:#e8c05c"></div><div class="text-right"><div>流行音樂</div><div class="d-flex justify-content-end align-items-baseline"><div class="m-0" style="font-weight:700;font-size:1.25em;line-height:1em" ld="value" data-name="流行音樂">0</div><div class="text-nowrap" style="font-size:10px" ld="unit">人</div></div></div></div><div class="text-right pnl hover d-flex align-items-stretch justify-content-between" style="padding:.75em"><div class="rounded mr-2" ld="cat-color" data-name="影視" style="width:.75em;height:100%;background:#7febb2"></div><div class="text-right"><div>影視</div><div class="d-flex justify-content-end align-items-baseline"><div class="m-0" style="font-weight:700;font-size:1.25em;line-height:1em" ld="value" data-name="影視">0</div><div class="text-nowrap" style="font-size:10px" ld="unit">人</div></div></div></div><div class="text-right pnl hover d-flex align-items-stretch justify-content-between" style="padding:.75em"><div class="rounded mr-2" ld="cat-color" data-name="出版" style="width:.75em;height:100%;background:#577aeb"></div><div class="text-right"><div>出版</div><div class="d-flex justify-content-end align-items-baseline"><div class="m-0" style="font-weight:700;font-size:1.25em;line-height:1em" ld="value" data-name="出版">0</div><div class="text-nowrap" style="font-size:10px" ld="unit">人</div></div></div></div></div><div class="text-sm mt-4"><span>您也可以使用 <span class="text-primary clickable" ld="ldcv-popup" data-name="sheet">表格</span> 檢視資料，或者針對產業次類別做 <span class="text-primary clickable" ld="ldcv-popup" data-name="group">重整</span>。</span></div></div></div><div id="main-panel"><div class="aspect-ratio ratio-1by1 rounded-lg shadow-sm" style="background:rgba(0,0,0,.2)"><div class="d-none" ld="content" data-name="list"><div class="main-panel-inner" ld="container"><div class="d-flex mb-2 align-items-center"><div class="flex-grow-1 d-flex"><div class="dropdown d-mdh-none"><div class="btn btn-sm btn-primary dropdown-toggle" data-toggle="dropdown">顯示模式</div><div class="dropdown-menu shadow-sm"><div class="dropdown-item" ld="toggle-chart" data-name="treemap">圖表檢視</div><div class="dropdown-item" ld="ldcv-popup" data-name="sheet">表格檢視</div></div></div><div class="mr-2 d-none d-mdh-block"><div class="btn btn-sm btn-primary" ld="toggle-chart" data-name="treemap">圖表檢視</div><div class="btn btn-sm btn-text" ld="ldcv-popup" data-name="sheet">表格檢視</div></div><div class="btn btn-sm btn-text mr-2" ld="toggle-panel" data-name="config">設定</div><div class="dropdown"><div class="btn btn-sm btn-text dropdown-toggle" data-toggle="dropdown">下載</div><div class="dropdown-menu shadow text-sm dropdown-menu-right"><div class="dropdown-item" ld="download" data-type="svg">SVG</div><div class="dropdown-item" ld="download" data-type="png">PNG</div><div class="dropdown-item" ld="download" data-type="csv">CSV</div><div class="dropdown-item" ld="download" data-type="zip">ZIP</div></div></div></div><a class="btn btn-sm btn-text" ld="toggle-panel" data-name="overview"><span>產業概況</span> <i class="i-chevron-right"></i></a></div><div class="w-100" style="display:flex;flex-direction:column;flex:1 0 100px"><div class="d-flex py-2 justify-content-center"><div class="btn btn-sm btn-outline-secondary mx-2 text-sm" ld-each="subdim"></div></div><div ld="list-chart" style="flex:1 0 100px"></div><div class="my-1 mx-4 py-1 px-2 rounded" ld="list-chart-comment" style="white-space:pre-wrap;font-size:12px"></div></div></div></div><div ld="content" data-name="overview"><div class="main-panel-inner" ld="container"><div class="d-flex mb-2 align-items-center"><div class="flex-grow-1 d-flex"><div class="dropdown d-mdh-none"><div class="btn btn-sm btn-primary dropdown-toggle" data-toggle="dropdown">顯示模式</div><div class="dropdown-menu shadow-sm"><div class="dropdown-item" ld="toggle-chart" data-name="treemap">分組比較</div><div class="dropdown-item" ld="toggle-chart" data-name="bubble">整體比較</div><div class="dropdown-item" ld="toggle-chart" data-name="line">歷年走勢</div><div class="dropdown-item" ld="toggle-chart" data-name="bump">歷年順位</div><div class="dropdown-item" ld="ldcv-popup" data-name="sheet">表格檢視</div></div></div><div class="mr-2 d-none d-mdh-block"><div class="btn btn-sm btn-primary" ld="toggle-chart" data-name="treemap">分組比較</div><div class="btn btn-sm btn-text" ld="toggle-chart" data-name="bubble">整體比較</div><div class="btn btn-sm btn-text" ld="toggle-chart" data-name="line">歷年走勢</div><div class="btn btn-sm btn-text" ld="toggle-chart" data-name="bump">歷年順位</div><div class="btn btn-sm btn-text mr-2" ld="ldcv-popup" data-name="sheet">表格檢視</div></div><div class="btn btn-sm btn-text mr-2" ld="toggle-panel" data-name="config">設定</div><div class="dropdown"><div class="btn btn-sm btn-text dropdown-toggle" data-toggle="dropdown">下載</div><div class="dropdown-menu shadow text-sm dropdown-menu-right"><div class="dropdown-item" ld="download" data-type="svg">SVG</div><div class="dropdown-item" ld="download" data-type="png">PNG</div><div class="dropdown-item" ld="download" data-type="csv">CSV ( 完整資料 )</div><div class="dropdown-item" ld="download" data-type="csv" data-subtype="partial">CSV ( 客製檢視資料 )</div><div class="dropdown-item" ld="download" data-type="zip">ZIP</div></div></div></div><a class="btn btn-sm btn-text" ld="toggle-panel" data-name="list"><span>詳細統計數據</span> <i class="i-chevron-right"></i></a></div><div class="w-100" ld="chart" style="flex:1 0 100px"></div></div></div></div></div></div></div><div class="position-fixed ld ldld m-auto d-flex justify-content-center px-3" ld="hint" style="width:fit-content;bottom:2em;left:0;right:0;z-index:6000;pointer-events:none"><div class="alert alert-warning shadow-sm d-inline-block" style="pointer-events:all"><div class="d-flex"><div class="flex-grow-1 mr-4"><span class="mr-4">部份類別沒有資料，所以未呈現在圖表中。您可以參考 <span class="text-primary clickable" ld="ldcv-popup" data-name="sheet">表格檢視</span> 以了解更完整的資料樣貌。</span></div><button class="close" ld="hint-close">&times;</button></div></div></div><div class="ldcv" ld="sheet ldcv" data-name="sheet"><div class="base w-1024 rwd" style="height:80%;max-height:80%"><div class="inner"><div class="p-2 d-flex"><div class="flex-grow-1"><input class="form-control form-control-sm" ld="search" placeholder="關鍵字搜尋 ..."></div><div class="ml-2"><div class="btn btn-sm btn-outline-secondary d-flex align-items-center" data-ldcv-set="">關閉表格 <i class="i-close"></i></div></div></div><div ld="sheet"></div></div></div></div><style type="text/css">[ld~=group-scope] .list-group-item.active input {
  color: #fff;
}
</style><div class="ldcv" ld-scope="" ld="ldcv group-scope" data-name="group"><div class="base" style="max-width:1024px;width:90%;height:90%"><div class="inner d-flex flex-column"><div class="px-4 py-3 d-flex border-bottom"><div class="font-weight-bold flex-grow-1">客製分組</div><div class="mr-4 d-flex align-items-center clickable" ld="switch-line"><div class="mr-1">啟用</div><div class="switch" ld="switch" data-name="enabled"></div></div><div class="mr-3 d-flex align-items-center clickable" ld="switch-line"><span class="mr-1">顯示未選取的分類</span><div class="switch" ld="switch" data-name="show-other"></div></div><div class="mr-3 d-flex align-items-center clickable" ld="switch-line"><span class="mr-1">顯示客製分組的細項</span><div class="switch" ld="switch" data-name="show-detail"></div></div></div><div class="d-flex flex-grow-1" style="overflow:hidden"><div class="d-flex flex-column border-right position-relative bg-white" style="flex:0 0 auto;min-width:12em;width:30%;z-index:1"><div class="flex-grow-1 overflow-scroll d-flex flex-column list-group rounded-0"><div class="px-4 py-3 border-bottom list-group-item" ld-each="custom-group"><div class="d-flex align-items-center" ld="root"><div class="flex-grow-1"><input class="border-0 w-100" value="我的分組" style="background:none;outline:0" ld="name"></div><div class="text-danger" ld="remove"><i class="i-close"></i></div></div></div><div class="px-4 py-3 d-flex clickable" ld="new-group"><div>新增...</div></div><div class="flex-grow-1"></div><div class="px-4 py-3"><div class="btn btn-sm btn-outline-secondary mr-2" ld="group-set">確定</div><div class="btn btn-sm btn-outline-secondary" ld="group-cancel">取消</div></div></div></div><div class="flex-grow-1 h-100 d-flex flex-column position-relative"><div class="border-bottom d-flex shadow-sm" style="padding:.85em 1em"><div class="flex-grow-1"><div class="btn btn-sm btn-outline-secondary mr-2" ld="select-all">全選</div><div class="btn btn-sm btn-outline-secondary" ld="select-none">全不選</div></div></div><div class="flex-grow-1" style="overflow:hidden"><div class="h-100 p-3" style="overflow:scroll"><div class="d-flex flex-wrap justify-content-between"><div class="entry shadow-sm p-2 rounded m-2 flex-grow-1 text-center no-select" ld-each="ccat"></div></div></div></div></div></div></div></div></div><script>if(/MSIE|Trident/.exec(navigator.userAgent)) { window.location.href = "/err/ie/" };</script><script type="text/javascript" src="https://polyfill.io/v3/polyfill.min.js?features=ResizeObserver"></script><script type="text/javascript" src="/assets/lib/i18next/main/umd/i18next.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/@loadingio/ldquery/main/ldq.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/ldview/main/index.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/@loadingio/debounce.js/main/debounce.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/bootstrap.native/main/bootstrap-native-v4.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/papaparse/main/papaparse.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/csv4xls/main/csv4xls.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/proxise/main/proxise.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/@plotdb/csscope/main/csscope.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/@plotdb/rescope/main/rescope.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/@plotdb/block/main/block.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/@plotdb/konfig/main/konfig.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/@plotdb/konfig/main/konfig.widget.bootstrap.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/ldcolor/main/ldcolor.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/ldcover/main/ldcv.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/ldloader/main/ldld.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/ldslider/main/ldrs.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/@loadingio/ldcolorpicker/main/ldcp.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/ldpalettepicker/main/index.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/ldpalettepicker/main/all.palettes.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/@plotdb/sheet/main/index.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/ldfile/main/index.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/smiltool/main/smiltool.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/jszip/main/jszip.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/clusterize.js/main/clusterize.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/@plotdb/datum/main/index.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/@plotdb/chart/main/chart.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/@plotdb/chart/main/utils/tint.min.js?v=bceabf5"></script><script>var metacsv;
metacsv = function(opt){
  opt == null && (opt = {});
  return new Promise(function(res, rej){
    var p;
    p = opt.url
      ? ld$.fetch(opt.url, {
        method: 'GET'
      }, {
        type: 'text'
      })
      : typeof opt === 'string'
        ? opt
        : opt.raw ? opt.raw : null;
    if (!p) {
      return rej(new Error("invalid argument in metacsv"));
    }
    return p.then(function(raw){
      raw = raw.trim();
      return Papa.parse(raw).data;
    }).then(function(data){
      var head, body, ret, types;
      head = data.slice(6, 7)[0];
      body = data.slice(7).map(function(d){
        return Object.fromEntries(head.map(function(h, i){
          return [h, d[i]];
        }));
      });
      ret = {
        head: head,
        body: body,
        sheet: [head].concat(data.slice(7)),
        unit: Object.fromEntries(data.slice(4, 5)[0].map(function(d, i){
          return [head[i], d];
        })),
        mag: Object.fromEntries(data.slice(5, 6)[0].map(function(d, i){
          return [head[i], d];
        })),
        meta: data.slice(0, 6)
      };
      types = datum.type.get(ret);
      ret.type = Object.fromEntries(ret.head.map(function(d, i){
        var t, obj;
        t = ret.meta[3][i];
        if (t === 'T') {
          t = 'O';
        }
        obj = !t ? types.filter(function(it){
          return it.key === d;
        })[0] : null;
        if (!obj) {
          obj = {
            type: t,
            types: Object.fromEntries([[t, 1]])
          };
        }
        if (obj.types.I === 1) {
          obj.types.R = 0.5;
        }
        return [d, obj];
      }));
      return ret;
    }).then(function(it){
      return res(it);
    })['catch'](function(e){
      return rej(e);
    });
  });
};</script><script>(function(it){
  return it.apply({});
})(function(){
  /* 產業樣貌的基本數值: 家數, 就業人數, 產值, 出口值 */
  var cfg, application;
  cfg = {
    pal: {
      colors: ['#d55741', '#e8c05c', '#7febb2', '#577aeb', '#aaaaaa'],
      maps: ['遊戲', '流行音樂', '影視', '出版'].concat([['其它', '樣貌']])
    }
  };
  application = {
    initing: true,
    ldcv: {},
    view: {},
    config: cfg,
    data: null,
    summary: null,
    groups: {
      cur: [],
      edit: [],
      active: null,
      cfg: {
        "show-detail": true,
        enabled: true
      }
    },
    chart: {
      block: 'treemap',
      name: 'treemap'
    },
    year: 108,
    panelToggled: 'overview',
    mode: 'overview',
    years: [],
    list: {
      data: {},
      chart: {},
      subdim: []
    },
    init: function(){
      var regs, scope, this$ = this;
      import$(this, {
        dimension: '產值'
      });
      this.tint = new chart.utils.tint({
        pal: this.config.pal,
        unique: false
      });
      regs = {
        block: function(arg$){
          var name, version;
          name = arg$.name, version = arg$.version;
          return "/assets/block/" + name + "/" + version + "/index.html";
        },
        module: function(arg$){
          var name, version, path;
          name = arg$.name, version = arg$.version, path = arg$.path;
          if (!/^d3/.exec(name)) {
            return "/assets/lib/" + name + "/" + version + "/" + path;
          }
          return "/assets/custom-lib/d3/" + name + ".v" + version + ".min.js";
        }
      };
      scope = new rescope({
        prejs: ['https://polyfill.io/v3/polyfill.min.js?features=ResizeObserver'],
        registry: regs.module
      });
      return scope.init().then(function(){
        this$.manager = new block.manager({
          registry: regs.block,
          moduleRegistry: regs.module,
          rescope: scope
        });
        return this$.manager.init();
      }).then(function(){
        return i18next.init({
          supportedLng: ['en', 'zh-TW'],
          fallbackLng: 'zh-TW'
        });
      }).then(function(){
        return block.i18n.use(i18next);
      }).then(function(){
        return this$.initView();
      }).then(function(){
        return metacsv({
          url: "/assets/data/ci/產業樣貌.csv"
        });
      }).then(function(it){
        return this$.data = it;
      }).then(function(){
        this$.years = Array.from(new Set(this$.data.body.map(function(it){
          return +it["年度"];
        }).filter(function(it){
          return it;
        })));
        this$.years.sort(function(a, b){
          return a - b;
        });
        return this$.data.body.map(function(b, i){
          ['年度', '家數', '就業人數', '產值', '出口值'].map(function(attr){
            return b[attr] = +(b[attr] + "").replace(/,/g, '');
          });
          return b._idx = i;
        });
      }).then(function(){
        return this$.summarizeData();
      }).then(function(){
        return this$.initSheet();
      }).then(function(){
        return this$.initConfig();
      }).then(function(){
        return this$.initGroup();
      }).then(function(){
        return this$.initList();
      }).then(function(){
        return this$.load({
          name: this$.chart.name,
          data: {
            delayRender: true
          }
        });
      }).then(function(){
        return this$.initing = false;
      }).then(function(){
        return this$.view.main.render();
      });
    },
    summarizeData: function(){
      var ret, total, this$ = this;
      ret = this.data.body.filter(function(it){
        return +it["年度"] === this$.year;
      }).filter(function(it){
        return it["產業別"] === '遊戲';
      }).map(function(it){
        return it["就業人數"];
      });
      total = Object.fromEntries(['家數', '就業人數', '產值', '出口值'].map(function(attr){
        var ret, k, v;
        ret = this$.data.body.filter(function(it){
          return +it["年度"] === this$.year;
        }).reduce(function(a, b){
          var ind, v;
          ind = b["產業別"];
          v = parseFloat(b[attr]);
          if (isNaN(v)) {
            v = 0;
          }
          a[ind] = (a[ind] || 0) + v;
          return a;
        }, {});
        ret["總數"] = (function(){
          var ref$, results$ = [];
          for (k in ref$ = ret) {
            v = ref$[k];
            results$.push(v);
          }
          return results$;
        }()).reduce(function(a, b){
          return a + b;
        }, 0);
        return [attr, ret];
      }));
      return this.summary = total;
    },
    bind: function(){
      var data, raw, i$, to$, i, v, ret, gs, binding, ref$, opt, hs, map, this$ = this;
      data = this.data;
      raw = this.data.body.filter(function(it){
        return +it["年度"] === this$.year;
      });
      this.partialData = null;
      if (this.groups.enabled()) {
        if (!this.groups.cfg["show-detail"]) {
          data = datum.group({
            data: this.data,
            cols: ['年度', '產業別', '主分類', '次分類'],
            groupFunc: function(v){
              var gs;
              gs = this$.groups.cur.filter(function(g){
                return g.list.filter(function(u){
                  return !['主分類', '次分類', '產業別'].filter(function(it){
                    return u[it] !== v[it];
                  }).length;
                }).length > 0;
              });
              if (gs.length || !this$.groups.cfg["show-other"]) {
                return gs.map(function(g){
                  return {
                    "年度": v["年度"],
                    "產業別": g ? g.name : '',
                    "主分類": g ? g.name : '',
                    "次分類": g ? g.name : ''
                  };
                });
              } else {
                return {
                  "年度": v["年度"],
                  "產業別": v["產業別"],
                  "主分類": v["主分類"],
                  "次分類": v["次分類"]
                };
              }
            },
            aggregator: {
              "家數": datum.agg.sum,
              "就業人數": datum.agg.sum,
              "產值": datum.agg.sum,
              "出口值": datum.agg.sum,
              "主分類": function(){
                return '-';
              },
              "次分類": function(){
                return '-';
              },
              "年度": datum.agg.first
            }
          });
        } else {
          data = import$({}, this.data);
          data.body = [];
          for (i$ = 0, to$ = this.data.body.length; i$ < to$; ++i$) {
            i = i$;
            v = this.data.body[i];
            ret = import$({}, v);
            gs = this.groups.cur.filter(fn$);
            if (!gs.length) {
              if (this.groups.cfg["show-other"]) {
                data.body.push(ret);
              }
            } else {
              gs.map(fn1$);
            }
          }
        }
        raw = data.body.filter(function(it){
          return +it["年度"] === this$.year;
        });
        this.partialData = {
          head: data.head,
          body: raw
        };
      }
      if (this.chart.name === 'bubble') {
        binding = {
          group: {
            key: '產業別'
          },
          area: {
            key: this.dimension,
            unit: this.data.unit[this.dimension]
          },
          name: {
            key: '次分類'
          }
        };
      } else if ((ref$ = this.chart.name) === 'line' || ref$ === 'bump') {
        if (this.groups.enabled()) {
          raw = datum.pivot({
            data: data,
            col: "次分類",
            joinCols: ['年度']
          });
        } else {
          opt = {
            data: data,
            cols: ['年度', '主分類'],
            aggregator: {
              "產業別": datum.agg.first
            }
          };
          opt.aggregator[this.dimension] = datum.agg.sum;
          raw = datum.group(opt);
          raw = datum.pivot({
            data: raw,
            col: "主分類",
            joinCols: ['年度']
          });
        }
        hs = raw.head.filter(function(it){
          return ~it.indexOf("-" + this$.dimension);
        });
        map = Object.fromEntries(hs.map(function(it){
          return [it, it.split('-')[0]];
        }));
        raw = datum.shrink({
          data: raw,
          cols: hs.concat(['年度'])
        });
        raw = datum.rename({
          data: raw,
          map: map
        });
        raw = raw.body;
        binding = {
          value: hs.map(function(it){
            return {
              key: map[it],
              unit: this$.data.unit[this$.dimension]
            };
          }),
          order: {
            key: "年度",
            unit: '年'
          }
        };
      } else {
        binding = {
          color: {
            key: '產業別'
          },
          area: {
            key: this.dimension,
            unit: this.data.unit[this.dimension]
          },
          category: {
            key: '產業別'
          },
          name: {
            key: '次分類'
          }
        };
      }
      return {
        raw: raw,
        binding: binding
      };
      function fn$(g){
        return g.list.filter(function(u){
          return !['主分類', '次分類', '產業別'].filter(function(it){
            return u[it] !== v[it];
          }).length;
        }).length > 0;
      }
      function fn1$(g){
        var ref$;
        return data.body.push((ref$ = import$({}, ret), ref$["產業別"] = g.name, ref$));
      }
    },
    _load: function(arg$){
      var name, data, root;
      name = arg$.name, data = arg$.data, root = arg$.root;
      return this.manager.get({
        name: name,
        version: "0.0.1"
      }).then(function(it){
        return it.create({
          data: data
        });
      }).then(function(bi){
        return bi.attach({
          root: root
        }).then(function(){
          return bi['interface']();
        });
      });
    },
    reload: function(){
      var ref$;
      if ((ref$ = this.chart.name) === 'treemap' || ref$ === 'bubble') {
        this.chart.obj.config({
          legend: {
            enabled: this.groups.enabled(),
            selectable: true
          }
        });
      }
      this.chart.obj.setRaw(this.bind());
      return this.view.main.render('download');
    },
    load: function(arg$){
      var name, data, cfg, ref$, root, this$ = this;
      name = arg$.name, data = arg$.data;
      this.chart.name = this.chart.block = name;
      cfg = {};
      if (name === 'bump') {
        this.chart.block = name = 'line';
        cfg.bump = true;
        ref$ = cfg.legend || (cfg.legend = {});
        ref$.enabled = true;
        ref$.selectable = true;
      }
      if (name === 'line') {
        (cfg.xaxis || (cfg.xaxis = {})).enabled = true;
        ref$ = cfg.yaxis || (cfg.yaxis = {});
        ref$.enabled = true;
        ref$.boundaryTickOffset = false;
        ref$ = cfg.legend || (cfg.legend = {});
        ref$.enabled = true;
        ref$.selectable = true;
      }
      if (name === 'treemap') {
        (cfg.legend || (cfg.legend = {})).enabled = false;
        (cfg.unit || (cfg.unit = {})).position = 'inner';
      }
      root = this.view.main.get('chart');
      if (this.chart.obj) {
        this.chart.obj.destroy();
      }
      root.textContent = '';
      return this._load({
        name: name,
        data: data,
        root: root
      }).then(function(chart){
        var ref$, b;
        this$.chart.obj = chart;
        chart.config(import$({
          pal: this$.config.pal
        }, cfg));
        if ((ref$ = this$.chart.name) === 'treemap' || ref$ === 'bubble') {
          chart.config({
            legend: {
              enabled: this$.groups.enabled(),
              selectable: true
            }
          });
        }
        chart.setRaw(b = this$.bind());
        chart.on('select', function(d){
          return this$.select(d);
        });
        chart.on('hover', function(d){
          if (this$.selected) {
            return this$.select(d);
          }
        });
        return this$.view.main.render('download');
      });
    },
    toggleCover: function(name){
      this.ldcv[name].toggle();
      if (this.mode === 'overview') {
        this.sheet.data(this.data.sheet);
      } else {
        this.sheet.data(this.list.data.sheet);
      }
      return this.sheet.obj.goto({
        row: 0,
        col: 0
      });
    },
    togglePanel: function(name){
      var k, ref$, v;
      name == null && (name = 'overview');
      this.panelToggled = name;
      if (name === 'overview') {
        this.mode = 'overview';
      } else if (name === 'list') {
        this.mode = 'list';
      }
      for (k in ref$ = this.panel) {
        v = ref$[k];
        v.classList.toggle('active', k === name);
      }
      if (name !== 'detail') {
        this.selected = null;
      }
      this.view.main.render('content');
      this.reconfig();
      return this.regrid();
    },
    select: function(d){
      this.selected = d ? d[0].data : null;
      this.togglePanel(this.selected ? 'detail' : 'overview');
      if (this.selected) {
        return this.view.detail.render();
      }
    },
    initView: function(){
      var view, this$ = this;
      this.view.common = {
        action: {
          click: {
            "toggle-panel": function(arg$){
              var node;
              node = arg$.node;
              return this$.togglePanel(node.getAttribute('data-name'));
            },
            "close-panel": function(arg$){
              var node;
              node = arg$.node;
              return this$.togglePanel(this$.mode);
            },
            "ldcv-popup": function(arg$){
              var node;
              node = arg$.node;
              return this$.toggleCover(node.getAttribute('data-name'));
            }
          }
        }
      };
      this.view.main = view = new ldview({
        root: document.body,
        initRender: false,
        init: {
          ldcv: function(arg$){
            var node;
            node = arg$.node;
            return this$.ldcv[node.getAttribute('data-name')] = new ldCover({
              root: node
            });
          },
          dropdown: function(arg$){
            var node;
            node = arg$.node;
            return new BSN.Dropdown(node);
          },
          hint: function(arg$){
            var node, ldld;
            node = arg$.node;
            ldld = new ldloader({
              root: node
            });
            ldld.toggle(true);
            return setTimeout(function(){
              return ldld.toggle(false);
            }, 10000);
          }
        },
        action: {
          click: import$(import$({}, this.view.common.action.click), {
            "toggle-chart": function(arg$){
              var node;
              node = arg$.node;
              this$.load({
                name: node.getAttribute('data-name'),
                data: {
                  delayRender: true
                }
              });
              return this$.view.main.render('toggle-chart');
            },
            "dimension-tab": function(arg$){
              var node;
              node = arg$.node;
              this$.dimension = node.getAttribute('data-name');
              return view.render();
            },
            "hint-close": function(arg$){
              var node;
              node = arg$.node;
              this$.view.main.get('hint').classList.toggle('d-none', true);
              return this$.view.main.get('hint').classList.toggle('d-flex', false);
            },
            "download": function(arg$){
              var node, type, root, csv, d, href, ba, svgNode, box, svgStyle, svgRaw, svgXml;
              node = arg$.node;
              type = node.getAttribute('data-type');
              root = this$.view.main.get('chart');
              csv = this$.mode === 'list'
                ? this$.list.data.sheet
                : this$.data.sheet;
              if (type === 'csv' && node.getAttribute('data-subtype') === 'partial' && this$.partialData) {
                d = this$.partialData;
                csv = [d.head].concat(d.body.map(function(b){
                  return d.head.map(function(h){
                    return b[h];
                  });
                }));
              }
              href = csv4xls.toArray(csv);
              ba = csv4xls.toHref(csv);
              svgNode = ld$.find(this$.view.main.get(this$.mode === 'list' ? 'list-chart' : 'chart'), 'svg', 0);
              box = svgNode.getBoundingClientRect();
              svgNode = svgNode.cloneNode(true);
              svgNode.setAttribute('xmlns', "http://www.w3.org/2000/svg");
              svgNode.setAttribute("viewbox", "0 0 " + box.width + " " + box.height);
              svgNode.setAttribute("width", box.width + "px");
              svgNode.setAttribute("height", box.height + "px");
              svgStyle = "<style type=\"text/css\">\nsvg { background: #fff }\ntext { font-family: sans-serif; }\n.text-sm { font-size: .8em }\n</style>";
              svgRaw = svgNode.outerHTML.replace('</svg>', svgStyle + "</svg>");
              svgXml = "<?xml version=\"1.0\" encoding=\"utf-8\"?>\n" + svgRaw;
              return smiltool.svgToDataurl(svgRaw, box.width, box.height).then(function(u){
                return smiltool.urlToDataurl(u, box.width, box.height);
              }).then(function(u){
                return smiltool.dataurlToBlob(u);
              }).then(function(png){
                var u, zip;
                switch (type) {
                case 'zip':
                  u = URL.createObjectURL(png);
                  zip = new JSZip();
                  zip.file("result.csv", ba.buffer);
                  zip.file("result.svg", svgXml);
                  zip.file("result.png", png);
                  return zip.generateAsync({
                    type: 'blob'
                  }).then(function(it){
                    return {
                      blob: it,
                      name: "result.zip"
                    };
                  });
                case 'csv':
                  return {
                    blob: csv4xls.toBlob(csv),
                    name: "result.csv"
                  };
                case 'png':
                  return {
                    blob: png,
                    name: "result.png"
                  };
                case 'svg':
                  return {
                    blob: new Blob([svgXml], {
                      type: "image/svg+xml"
                    }),
                    name: "result.svg"
                  };
                }
              }).then(function(arg$){
                var blob, name;
                blob = arg$.blob, name = arg$.name;
                return ldfile.download({
                  blob: blob,
                  name: name
                });
              });
            }
          })
        },
        text: {
          year: function(){
            return this$.year;
          },
          dimension: function(){
            return this$.dimension;
          },
          value: function(arg$){
            var node, name, ret, ref$, key$;
            node = arg$.node;
            name = node.getAttribute('data-name');
            ret = ((ref$ = this$.summary)[key$ = this$.dimension] || (ref$[key$] = {}))[name] || 0;
            return ret < 10000
              ? ret.toFixed(0)
              : ret < 1000000
                ? Math.round(ret / 10000) + "萬"
                : ret < 100000000
                  ? Math.round(ret / 1000000) + "百萬"
                  : Math.round(ret / 100000000) + "億";
          },
          unit: function(arg$){
            var node;
            node = arg$.node;
            return this$.data.unit[this$.dimension];
          },
          "list-chart-comment": function(){
            return this$.list.comment || '';
          }
        },
        handler: {
          "subdim": {
            list: function(){
              if (this$.list.subdim.length <= 1) {
                return [];
              } else {
                return this$.list.subdim;
              }
            },
            view: {
              text: {
                "@": function(arg$){
                  var ctx;
                  ctx = arg$.ctx;
                  return ctx.list.length === 1
                    ? ctx.key
                    : ctx.list.slice(0, 3).map(function(it){
                      return it.key;
                    }).join(',') + " .. 等" + ctx.list.length + "項";
                }
              },
              handler: {
                "@": function(arg$){
                  var ctx, node, active;
                  ctx = arg$.ctx, node = arg$.node;
                  active = this$.list.subdimUsed && this$.list.subdimUsed.key === ctx.key;
                  node.classList.toggle('btn-outline-secondary', !active);
                  return node.classList.toggle('btn-primary', active);
                }
              },
              action: {
                click: {
                  "@": function(arg$){
                    var views, ctx;
                    views = arg$.views, ctx = arg$.ctx;
                    this$.list.subdimUsed = ctx;
                    this$.renderList(this$.list.picked);
                    return views[1].render('subdim');
                  }
                }
              }
            }
          },
          content: function(arg$){
            var node, name, ref$, ref1$;
            node = arg$.node;
            name = node.getAttribute('data-name');
            return node.classList.toggle('d-none', !(ref$ = name === 'list') !== !(ref1$ = this$.mode === 'list') && (ref$ || ref1$));
          },
          hint: function(){},
          sheet: function(){},
          download: function(arg$){
            var node;
            node = arg$.node;
            if (node.getAttribute('data-subtype') !== 'partial') {
              return;
            }
            return node.classList.toggle('disabled', !this$.partialData);
          },
          "cat-color": function(arg$){
            var node;
            node = arg$.node;
            return node.style.background = this$.tint.get(node.getAttribute('data-name'));
          },
          "toggle-chart": function(arg$){
            var node, name;
            node = arg$.node;
            name = node.getAttribute('data-name');
            node.classList.toggle('btn-primary', name === this$.chart.name);
            return node.classList.toggle('btn-text', name !== this$.chart.name);
          },
          "chart": function(){
            return this$.chart.obj.setRaw(this$.bind());
          },
          "dimension-tab": function(arg$){
            var node, flag;
            node = arg$.node;
            flag = this$.dimension === node.getAttribute('data-name');
            node.classList.toggle('btn-primary', flag);
            return node.classList.toggle('text-white', flag);
          },
          "year-item": {
            list: function(){
              return this$.years;
            },
            action: {
              click: function(arg$){
                var node, data;
                node = arg$.node, data = arg$.data;
                this$.year = data;
                this$.summarizeData();
                return this$.view.main.render();
              }
            },
            handler: function(arg$){
              var node, data;
              node = arg$.node, data = arg$.data;
              return node.classList.toggle('active', this$.year === data);
            },
            text: function(arg$){
              var node, data;
              node = arg$.node, data = arg$.data;
              return data;
            }
          },
          loader: debounce(350, function(arg$){
            var node;
            node = arg$.node;
            return node.classList.toggle('running', this$.initing);
          })
        }
      });
      this.panel = Object.fromEntries(this.view.main.getAll('panel').map(function(d, i){
        return [d.getAttribute('data-name'), d];
      }));
      this.view.detail = new ldview({
        root: this.panel.detail,
        action: {
          click: import$({}, this.view.common.action.click)
        },
        init: {
          "detail-chart": function(arg$){
            var node, local;
            node = arg$.node, local = arg$.local;
            return this$._load({
              name: 'line',
              root: node,
              data: {
                delayRender: false
              }
            }).then(function(chart){
              chart.config({
                legend: {
                  enabled: false
                },
                yaxis: {
                  enabled: true
                },
                xaxis: {
                  enabled: true
                }
              });
              chart.resize();
              chart.render();
              return local.chart = chart;
            });
          }
        },
        handler: {
          "detail-chart": function(arg$){
            var views, node, local, selected, raw, binding;
            views = arg$.views, node = arg$.node, local = arg$.local;
            selected = this$.selected;
            if (!selected) {
              return;
            }
            raw = this$.data.body.filter(function(b){
              return !['產業別', '主分類', '次分類'].filter(function(t){
                return b[t] !== selected[t];
              }).length;
            });
            binding = {
              value: [{
                key: this$.dimension,
                unit: this$.data.unit[this$.dimension]
              }],
              order: {
                key: "年度"
              }
            };
            views[0].get('detail-chart-disabled').classList.toggle('d-none', raw.map(function(it){
              return it[this$.dimension];
            }).filter(function(it){
              return !isNaN(it);
            }).length >= 2);
            return local.chart.setRaw({
              raw: raw,
              binding: binding
            });
          }
        },
        text: {
          dimension: function(){
            return this$.dimension;
          },
          cat1: function(){
            if (!this$.selected) {
              return;
            }
            if (this$.selected["次分類"]) {
              return (this$.selected['產業別'] || '') + " / " + (this$.selected['主分類'] || '');
            } else {
              return (this$.selected['產業別'] || '') + "";
            }
          },
          cat2: function(){
            if (!this$.selected) {
              return;
            }
            return this$.selected["次分類"] || this$.selected["主分類"] || '';
          },
          value: function(arg$){
            var node, name, ret;
            node = arg$.node;
            if (!this$.selected) {
              return;
            }
            name = node.getAttribute('data-name');
            ret = this$.selected ? this$.selected[name] : 0;
            return isNaN(ret) ? '(沒有資料)' : ret;
          }
        }
      });
      return this.view.config = new ldview({
        root: this.panel.config,
        action: {
          click: this.view.common.action.click
        }
      });
    },
    regrid: function(){
      if (!this.sheet.obj) {
        return;
      }
      return this.sheet.obj.size(this.mode === 'overview'
        ? {
          col: ['3em', '5em', '8em', '13em', '7em', '7em', '7em', '7em']
        }
        : {
          col: []
        });
    },
    initSheet: function(data){
      var this$ = this;
      this.sheet = {
        sort: {}
      };
      this.view.sheet = new ldview({
        root: this.view.main.get('sheet'),
        handler: {
          sheet: function(){}
        },
        action: {
          click: {
            "@": function(arg$){
              var node, evt, c, idx, dir, data;
              node = arg$.node, evt = arg$.evt;
              if (!(c = ld$.parent(evt.target, '.cell.frozen', node))) {
                return;
              }
              idx = ld$.find(node, '.cell.frozen').indexOf(c);
              dir = this$.sheet.sort[idx] = (this$.sheet.sort[idx] || 1) * -1;
              data = this$.sheet.data();
              data.sort(function(a, b){
                var ref$, na, nb, ret;
                if (a === data[0]) {
                  return -1;
                }
                if (b === data[0]) {
                  return 1;
                }
                ref$ = [a[idx], b[idx]], a = ref$[0], b = ref$[1];
                ref$ = [a, b].map(function(it){
                  if (!(it != null) || it === '') {
                    return it = NaN;
                  } else {
                    return +it;
                  }
                }), na = ref$[0], nb = ref$[1];
                if (!(isNaN(na) || isNaN(nb))) {
                  ref$ = [na, nb], a = ref$[0], b = ref$[1];
                  ret = a < b
                    ? -1
                    : a > b ? 1 : 0;
                  return ret * dir;
                }
                if (isNaN(na) && isNaN(nb)) {
                  ret = a < b
                    ? -1
                    : a > b ? 1 : 0;
                  return ret * dir;
                }
                if (isNaN(na)) {
                  return 1;
                }
                if (isNaN(nb)) {
                  return -1;
                }
              });
              this$.sheet.obj.data(data.filter(function(d, i){
                if (!(i && this$.sheet.keyword)) {
                  return true;
                }
                return ~JSON.stringify(d).indexOf(this$.sheet.keyword);
              }));
              return this$.sheet.obj.renderSelection();
            }
          },
          input: {
            "search": debounce(350, function(arg$){
              var node, keyword, data;
              node = arg$.node;
              this$.sheet.keyword = keyword = node.value || '';
              data = this$.sheet.data();
              return this$.sheet.obj.data(data.filter(function(d, i){
                if (!(i && keyword)) {
                  return true;
                }
                return ~JSON.stringify(d).indexOf(keyword);
              }));
            })
          }
        }
      });
      this.sheet.obj = new sheet({
        root: this.view.sheet.get('sheet'),
        frozen: {
          row: 1
        },
        editing: false,
        size: {
          col: ['3em', '5em', '8em', '13em', '7em', '7em', '7em', '7em']
        },
        'class': {
          col: ['', '', '', '', 'text-right', 'text-right', 'text-right', 'text-right']
        }
      });
      this.sheet.data = function(it){
        if (!(it != null)) {
          return this$.sheet._data;
        }
        this$.sheet._data = it;
        return this$.sheet.obj.data(it);
      };
      return this.sheet.data(this.data.sheet);
    },
    reconfig: function(){
      this.kfg.meta.group.hidden = this.mode !== 'overview';
      this.kfg.main.build();
      return console.log('@plotdb/konfig rebuilt.');
    },
    initConfig: function(){
      var kfg, this$ = this;
      this.kfg = {};
      this.kfg.main = kfg = new konfig({
        root: this.panel.config,
        view: 'default',
        meta: this.kfg.meta = {
          palette: {
            name: '配色',
            type: 'palette',
            palette: {
              colors: ['#d55741', '#e8c05c', '#7febb2', '#577aeb', '#aaaaaa']
            },
            palettes: ldpp.get('all').concat([
              {
                colors: ['#B33425', '#E95838', '#EF683D', '#55575A', '#F3F3F3'],
                tag: ['brand'],
                name: "taicca"
              }, {
                colors: ['#188A64', '#707373', '#EEF1F9'],
                tag: ['concept'],
                name: "lin-yang-couple"
              }
            ])
          },
          fontSize: {
            name: '字體大小',
            type: 'number',
            range: false,
            from: 16,
            min: 10,
            max: 64,
            step: 1
          },
          group: {
            name: '客製分組',
            type: 'popup',
            popup: {
              get: function(){
                return this$.ldcv.group.get();
              },
              data: function(v){
                if (v != null) {
                  return this$.groups.cur = v;
                } else {
                  return {
                    text: '...',
                    data: this$.groups.cur
                  };
                }
              }
            }
          }
          /*
          colormap: name: "配色方式", type: \popup, popup:
            get: ~> @ldcv.colormap.get!
            data: (v) -> 
          color-order:
            name: "色盤的排序方式", type: \choice
            values: <[依色調排序 依亮度排序 隨機排序]>
          cat-color:
            name: "類別的配色方式", type: \choice
            values: <[針對所有類別配色 僅針對選取的類別配色]>
          */
        },
        manager: this.manager,
        useBundle: true,
        typemap: function(name){
          var set;
          set = name === 'number' ? 'bootstrap' : 'default';
          set = 'bootstrap';
          return {
            name: "@plotdb/konfig.widget." + set,
            version: "master",
            path: name
          };
        }
      });
      kfg.on('change', function(cfg){
        var ref$;
        this$.config.pal = (ref$ = import$({}, cfg.palette), ref$.maps = ['遊戲', '流行音樂', '影視', '出版'].concat([['其它', '樣貌']]), ref$);
        this$.tint = new chart.utils.tint({
          pal: this$.config.pal,
          unique: false
        });
        [
          {
            root: this$.view.main.get('chart'),
            chart: this$.chart.obj
          }, {
            root: this$.view.main.get('list-chart'),
            chart: this$.list.chart.obj
          }
        ].map(function(arg$){
          var root, chart;
          root = arg$.root, chart = arg$.chart;
          root.style.fontSize = cfg.fontSize + "px";
          if (chart) {
            chart.config({
              pal: this$.config.pal
            });
            chart.resize();
            return chart.render();
          }
        });
        this$.view.main.render('cat-color');
        if (this$.view.list) {
          return this$.view.list.render(['picked-cat-color', 'data-item']);
        }
      });
      return kfg.init().then(function(){
        return console.log('@plotdb/konfig inited.');
      });
    },
    regroup: function(){},
    initGroup: function(){
      var data, cat0, cats, config, wk, view, this$ = this;
      data = this.data.body;
      cat0 = Array.from(new Set(data.map(function(it){
        return it["產業別"];
      })));
      this.cats = cats = cat0.map(function(c0){
        var data0, cat1;
        data0 = data.filter(function(it){
          return it["產業別"] === c0;
        });
        cat1 = Array.from(new Set(data0.map(function(it){
          return it["主分類"];
        })));
        return cat1.map(function(c1){
          var data1, cat2;
          data1 = data0.filter(function(it){
            return it["主分類"] === c1;
          });
          return cat2 = Array.from(new Set(data1.map(function(it){
            return it["次分類"];
          }))).map(function(c2){
            return {
              "次分類": c2,
              "主分類": c1,
              "產業別": c0,
              "分類名": c1 + " / " + c2
            };
          });
        }).reduce(function(a, b){
          return a.concat(b);
        }, []);
      }).reduce(function(a, b){
        return a.concat(b);
      }, []).map(function(d, i){
        return d.idx = i, d;
      });
      config = this.groups.cfg;
      this.groups.enabled = function(){
        return this$.groups.cfg.enabled && this$.groups.cur.length;
      };
      wk = new WeakMap();
      return this.view.group = view = new ldview({
        root: this.view.main.get('group-scope'),
        action: {
          click: {
            "switch-line": function(arg$){
              var node, n;
              node = arg$.node;
              n = ld$.find(node, '[ld=switch]', 0);
              n = n.getAttribute('data-name');
              config[n] = !config[n];
              return view.render('switch');
            },
            "new-group": function(){
              this$.groups.edit.push(this$.groups.active = {
                name: "新分組",
                list: []
              });
              return view.render();
            },
            "group-set": function(){
              this$.groups.cur = this$.groups.edit.map(function(o){
                return {
                  name: o.name,
                  list: o.list.map(function(it){
                    return it;
                  })
                };
              });
              this$.ldcv.group.set(this$.groups.cur);
              view.render();
              return this$.reload();
            },
            "group-cancel": function(){
              this$.groups.edit = this$.groups.cur.map(function(o){
                return {
                  name: o.name,
                  list: o.list.map(function(it){
                    return it;
                  })
                };
              });
              this$.ldcv.group.cancel();
              return view.render();
            },
            "select-all": function(arg$){
              var views;
              views = arg$.views;
              if (!this$.groups.active) {
                return;
              }
              this$.groups.active.list = cats.map(function(it){
                return it;
              });
              return views[0].render();
            },
            "select-none": function(arg$){
              var views;
              views = arg$.views;
              if (!this$.groups.active) {
                return;
              }
              this$.groups.active.list = [];
              return views[0].render();
            }
          }
        },
        handler: {
          ccat: {
            list: function(){
              return cats;
            },
            key: function(d){
              return d.idx;
            },
            action: {
              mouseover: function(arg$){
                var views, data, evt, list, ref$;
                views = arg$.views, data = arg$.data, evt = arg$.evt;
                if (evt.buttons === 0) {
                  return;
                }
                if (!this$.groups.active) {
                  return;
                }
                list = (ref$ = this$.groups.active).list || (ref$.list = []);
                if (!in$(data, list)) {
                  list.push(data);
                } else {
                  list.splice(list.indexOf(data), 1);
                }
                return views[0].render();
              },
              mousedown: function(arg$){
                var views, data, list, ref$;
                views = arg$.views, data = arg$.data;
                if (!this$.groups.active) {
                  return;
                }
                list = (ref$ = this$.groups.active).list || (ref$.list = []);
                if (!in$(data, list)) {
                  list.push(data);
                } else {
                  list.splice(list.indexOf(data), 1);
                }
                return views[0].render();
              }
            },
            handler: function(arg$){
              var node, data, c, list, ref$;
              node = arg$.node, data = arg$.data;
              c = this$.tint.get(data["產業別"]);
              list = this$.groups.active ? (ref$ = this$.groups.active).list || (ref$.list = []) : null;
              ref$ = node.style;
              ref$.background = c;
              ref$.color = ldcolor.hcl(c).l < 63 ? '#fff' : '#000';
              ref$.opacity = list && ~list.indexOf(data) ? 1 : 0.3;
              node.textContent = data["分類名"];
              return node.setAttribute('data-key', data.idx);
            }
          },
          "switch": function(arg$){
            var node, n;
            node = arg$.node;
            n = node.getAttribute('data-name');
            return node.classList.toggle('on', !!config[n]);
          },
          "custom-group": {
            list: function(){
              return this$.groups.edit;
            },
            view: {
              handler: {
                name: function(arg$){
                  var node, ctx;
                  node = arg$.node, ctx = arg$.ctx;
                  return node.value = ctx.name;
                },
                root: function(arg$){
                  var node, ctx;
                  node = arg$.node, ctx = arg$.ctx;
                  return node.parentNode.classList.toggle('active', this$.groups.active === ctx);
                }
              },
              action: {
                input: {
                  name: function(arg$){
                    var node, ctx;
                    node = arg$.node, ctx = arg$.ctx;
                    return ctx.name = node.value;
                  }
                },
                click: {
                  '@': function(arg$){
                    var views, ctx;
                    views = arg$.views, ctx = arg$.ctx;
                    this$.groups.active = ctx;
                    this$.view.group.render('ccat');
                    return views[1].render('custom-group');
                  },
                  remove: function(arg$){
                    var ctx;
                    ctx = arg$.ctx;
                    if (in$(ctx, this$.groups.edit)) {
                      this$.groups.edit.splice(this$.groups.edit.indexOf(ctx));
                    }
                    return view.render();
                  }
                }
              }
            }
          }
        }
      });
    },
    colormap: function(){},
    initColor: function(){
      var config, view;
      this.config.colormap = config = {
        pal: {
          sel: "all",
          sort: "none"
        }
      };
      return view = new ldview({
        root: this.view.main.get('colormap-scope'),
        action: {
          click: {
            "set-pal": function(arg$){
              var views, node, type, name;
              views = arg$.views, node = arg$.node;
              type = node.getAttribute('data-type');
              name = node.getAttribute('data-name');
              config.pal[type] = name;
              return views[0].render();
            }
          }
        },
        handler: {
          "set-pal": function(arg$){
            var node, type, name;
            node = arg$.node;
            type = node.getAttribute('data-type');
            name = node.getAttribute('data-name');
            return node.classList.toggle('active', config.pal[type] === name);
          }
        }
      });
    },
    renderList: function(ctx){
      var root, this$ = this;
      this.list.picked = ctx;
      this.view.list.render();
      root = this.view.main.get('list-chart');
      return metacsv({
        url: "/assets/data/ci/" + ctx.path
      }).then(function(data){
        var sheet, typeinfo, t, groups, otherHeads, k, v, subdimUsed, chartName, ref$, heads, that;
        this$.list.comment = (data.meta[2] || []).join('\n').trim();
        sheet = data.sheet;
        typeinfo = function(data){
          var list, res$, k, ref$, v, order, codes, str;
          res$ = [];
          for (k in ref$ = data.type) {
            v = ref$[k];
            res$.push((v.key = k, v));
          }
          list = res$;
          order = ['I', 'R', 'N', 'C', 'O', 'T'];
          list.sort(function(a, b){
            a = order.indexOf(a.type);
            b = order.indexOf(b.type);
            if (a < b) {
              return 1;
            } else if (b < a) {
              return -1;
            } else {
              return 0;
            }
          });
          codes = list.map(function(it){
            return it.type;
          });
          str = codes.join('');
          return {
            list: list,
            codes: codes,
            str: str
          };
        };
        t = typeinfo(data);
        groups = {};
        otherHeads = t.list.filter(function(it){
          var ref$;
          return !((ref$ = it.type) === 'I' || ref$ === 'R');
        }).map(function(it){
          return it.key;
        });
        t.list.filter(function(it){
          var ref$;
          return (ref$ = it.type) === 'I' || ref$ === 'R';
        }).map(function(d, i){
          var unit, g, key$;
          unit = data.unit[d.key] || 'n/a';
          g = in$('C', t.codes)
            ? groups[key$ = "force-group-" + i] || (groups[key$] = {})
            : groups[unit] || (groups[unit] = {});
          (g.list || (g.list = [])).push(d);
          g.unit = unit;
          if (!g.key) {
            return g.key = d.key;
          }
        });
        this$.list.subdim = (function(){
          var ref$, results$ = [];
          for (k in ref$ = groups) {
            v = ref$[k];
            results$.push(v);
          }
          return results$;
        }());
        if (this$.list.subdim.length) {
          if (this$.list.subdimUsed && this$.list.subdim.filter(function(it){
            return it.key === this$.list.subdimUsed.key;
          }).length) {
            subdimUsed = this$.list.subdimUsed;
          } else {
            subdimUsed = this$.list.subdimUsed = this$.list.subdim[0];
          }
          data = datum.shrink({
            data: data,
            cols: otherHeads.concat(subdimUsed.list.map(function(it){
              return it.key;
            }))
          });
          t = typeinfo(data);
        }
        chartName = in$('O', t.codes) ? 'line' : 'treemap';
        if (t.list.length === 2 && ((ref$ = t.str) === 'NR' || ref$ === 'RN' || ref$ === 'CR' || ref$ === 'RC')) {
          chartName = 'pie';
        } else if (t.list.length === 2 && ((ref$ = t.str) === 'NI' || ref$ === 'IN' || ref$ === 'CI' || ref$ === 'IC')) {
          chartName = 'bar';
        }
        if (!in$('O', t.codes) && t.codes.filter(function(it){
          return it === 'C' || it === 'N';
        }).length === 1 && t.codes.filter(function(it){
          return it === 'R' || it === 'I';
        }).length === t.codes.length - 1 && t.codes.length > 2) {
          chartName = 'bar';
        }
        if (in$('O', t.codes) && t.codes.filter(function(it){
          return it === 'C';
        }).length >= 2) {
          heads = data.head.filter(function(d, i){
            return data.type[d] !== 'C';
          });
          data = datum.shrink({
            data: data,
            cols: heads
          });
        }
        if (~data.meta[3].indexOf('C') && ~data.meta[3].indexOf('T')) {
          heads = ['T', 'C', 'R', 'I'].map(function(it){
            return data.head[data.meta[3].indexOf(it)];
          }).filter(function(it){
            return it;
          });
          data = datum.shrink({
            data: data,
            cols: heads
          });
          data = datum.pivot({
            col: heads[1],
            joinCols: [heads[0]],
            simpleHead: true,
            data: data
          });
        }
        this$.list.data = data;
        this$.list.data.sheet = sheet;
        if (that = this$.list.chart.name === chartName && this$.list.chart.obj) {
          return that;
        } else {
          if (this$.list.chart.obj) {
            this$.list.chart.obj.destroy();
          }
          root.textContent = '';
          this$.list.chart.name = chartName;
          return this$.manager.get({
            name: chartName,
            version: "0.0.1"
          }).then(function(it){
            return it.create({
              data: {
                delayRender: true
              }
            });
          }).then(function(bi){
            return bi.attach({
              root: root
            }).then(function(){
              return bi['interface']();
            });
          });
        }
      }).then(function(chart){
        var binding, key, v, config;
        this$.view.main.render(['list-chart-comment', 'subdim']);
        this$.list.chart.obj = chart;
        binding = datum.type.bind(this$.list.data, chart.mod.dimension, (function(){
          var ref$, ref1$, results$ = [];
          for (key in ref$ = this.list.data.type) {
            v = ref$[key];
            results$.push((ref1$ = import$({}, v), ref1$.key = key, ref1$));
          }
          return results$;
        }.call(this$)));
        config = {
          pal: this$.config.pal,
          legend: {
            enabled: true,
            selectable: true
          },
          yaxis: {
            enabled: true,
            showCaption: true
          }
        };
        if (this$.list.chart.name === 'bar') {
          config.legend = {
            selectable: false
          };
          config.sort = {
            enabled: true,
            dir: 'desc'
          };
          config.brush = {
            enabled: false
          };
          config.xaxis = {
            textWidth: 1
          };
        }
        chart.config(config);
        return chart.setRaw({
          raw: this$.list.data.body,
          binding: binding
        });
      })['catch'](function(it){
        return console.log(it);
      });
    },
    initList: function(){
      var this$ = this;
      return ld$.fetch('/assets/data/ci/tables.json', {
        method: 'GET'
      }, {
        type: 'json'
      }).then(function(tables){
        var view;
        this$.list.files = tables.filter(function(it){
          return !/TODO/.exec(it[it.length - 1]);
        }).map(function(it){
          return {
            cat: it[0],
            name: it[it.length - 1],
            full: it[0] + " / " + it[it.length - 1],
            path: it.join('/') + '.csv'
          };
        });
        this$.list.picked = this$.list.files[0];
        this$.view.list = view = new ldview({
          root: this$.view.main.get('list-scope'),
          initRender: false,
          action: {
            input: {
              "dataset-search-field": debounce(300, function(arg$){
                var node;
                node = arg$.node;
                this$.list.search = node.value;
                return view.render();
              })
            }
          },
          text: {
            "picked-cat": function(){
              if (!this$.list.picked) {
                return;
              }
              return this$.list.picked.cat;
            },
            "picked-name": function(){
              if (!this$.list.picked) {
                return;
              }
              return this$.list.picked.name;
            }
          },
          handler: {
            "picked-cat-color": function(arg$){
              var node;
              node = arg$.node;
              return node.style.background = this$.tint.get(this$.list.picked ? this$.list.picked.cat : '其它');
            },
            "no-data-item": function(arg$){
              var node, noItem;
              node = arg$.node;
              noItem = this$.list.files.filter(function(it){
                return !this$.list.search || ~it.full.indexOf(this$.list.search);
              }).length;
              return node.classList.toggle('d-none', noItem);
            },
            "data-item": {
              list: function(){
                return this$.list.files;
              },
              view: {
                action: {
                  click: {
                    "@": function(arg$){
                      var ctx;
                      ctx = arg$.ctx;
                      return this$.renderList(ctx);
                    }
                  }
                },
                text: {
                  "dataset-name": function(arg$){
                    var ctx;
                    ctx = arg$.ctx;
                    return ctx.name;
                  }
                },
                handler: {
                  "@": function(arg$){
                    var node, ctx;
                    node = arg$.node, ctx = arg$.ctx;
                    return node.classList.toggle('active', this$.list.picked === ctx);
                  },
                  "dataset-name": function(arg$){
                    var node, ctx, matched;
                    node = arg$.node, ctx = arg$.ctx;
                    node.textContent = ctx.name;
                    matched = !this$.list.search || ~ctx.full.indexOf(this$.list.search);
                    return node.parentNode.parentNode.classList.toggle('d-none', !matched);
                  },
                  "dataset-color": function(arg$){
                    var node, ctx;
                    node = arg$.node, ctx = arg$.ctx;
                    return node.style.background = this$.tint.get(ctx.cat);
                  }
                }
              }
            }
          }
        });
        this$.renderList(this$.list.picked);
        return null;
      });
    }
  };
  return application.init();
});
function import$(obj, src){
  var own = {}.hasOwnProperty;
  for (var key in src) if (own.call(src, key)) obj[key] = src[key];
  return obj;
}
function in$(x, xs){
  var i = -1, l = xs.length >>> 0;
  while (++i < l) if (x === xs[i]) return true;
  return false;
}</script></body></html>