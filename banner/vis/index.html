<!DOCTYPE html><html><head><meta http-equiv="Content-type" content="text/html;charset=UTF-8"><base href="/"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1"><link rel="stylesheet" type="text/css" href="assets/lib/bootstrap/main/css/bootstrap.min.css?v=bceabf5"><link rel="stylesheet" type="text/css" href="assets/lib/@loadingio/bootstrap.ext/main/index.min.css?v=bceabf5"><link rel="stylesheet" type="text/css" href="assets/lib/ldiconfont/main/ldif.css?v=bceabf5"><link rel="stylesheet" type="text/css" href="assets/lib/ldslider/main/ldrs.min.css?v=bceabf5"><link rel="stylesheet" type="text/css" href="assets/lib/ldcover/main/ldcv.min.css?v=bceabf5"><link rel="stylesheet" type="text/css" href="assets/lib/ldloader/main/ldld.min.css?v=bceabf5"><link rel="stylesheet" type="text/css" href="assets/lib/ldbutton/main/ldbtn.min.css?v=bceabf5"><link rel="stylesheet" type="text/css" href="assets/lib/ldpalettepicker/main/index.min.css?v=bceabf5"><link rel="stylesheet" type="text/css" href="assets/lib/@loadingio/loading.css/main/loading.min.css?v=bceabf5"><link rel="stylesheet" type="text/css" href="assets/lib/@loadingio/transition.css/main/transition.min.css?v=bceabf5"><link rel="stylesheet" type="text/css" href="assets/lib/@loadingio/ldcolorpicker/main/ldcp.min.css?v=bceabf5"><link rel="stylesheet" type="text/css" href="assets/lib/@plotdb/sheet/main/index.min.css?v=bceabf5"><link rel="stylesheet" type="text/css" href="assets/lib/clusterize.js/main/clusterize.css?v=bceabf5"><link rel="stylesheet" type="text/css" href="css/panel.css?v=bceabf5"><link rel="stylesheet" type="text/css" href="css/index.css?v=bceabf5"><link rel="stylesheet" type="text/css" href="assets/lib/@plotdb/chart/main/chart.min.css?v=bceabf5"><style type="text/css">body {
  font-size: 12px;
  background: none;
}
</style></head><body><div class="w-100 h-100 d-flex flex-column"><div class="text-center font-weight-bold" ld="title"></div><div class="flex-grow-1" id="root" ld="content"></div><div class="position-absolute" style="top:0;left:0;width:100%;height:100%;background:url(/assets/img/gears.svg) center center no-repeat;z-index:10" ld="loader"></div></div><script>if(/MSIE|Trident/.exec(navigator.userAgent)) { window.location.href = "/err/ie/" };</script><script type="text/javascript" src="https://polyfill.io/v3/polyfill.min.js?features=ResizeObserver"></script><script type="text/javascript" src="/assets/lib/i18next/main/umd/i18next.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/@loadingio/ldquery/main/ldq.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/ldview/main/index.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/@loadingio/debounce.js/main/debounce.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/bootstrap.native/main/bootstrap-native-v4.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/papaparse/main/papaparse.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/csv4xls/main/csv4xls.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/proxise/main/proxise.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/@plotdb/csscope/main/csscope.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/@plotdb/rescope/main/rescope.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/@plotdb/block/main/block.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/@plotdb/konfig/main/konfig.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/@plotdb/konfig/main/konfig.widget.bootstrap.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/ldcolor/main/ldcolor.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/ldcover/main/ldcv.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/ldloader/main/ldld.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/ldslider/main/ldrs.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/@loadingio/ldcolorpicker/main/ldcp.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/ldpalettepicker/main/index.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/ldpalettepicker/main/all.palettes.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/@plotdb/sheet/main/index.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/ldfile/main/index.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/smiltool/main/smiltool.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/jszip/main/jszip.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/clusterize.js/main/clusterize.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/@plotdb/datum/main/index.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/@plotdb/chart/main/chart.min.js?v=bceabf5"></script><script type="text/javascript" src="assets/lib/@plotdb/chart/main/utils/tint.min.js?v=bceabf5"></script><script>var metacsv;
metacsv = function(opt){
  opt == null && (opt = {});
  return new Promise(function(res, rej){
    var p;
    p = opt.url
      ? ld$.fetch(opt.url, {
        method: 'GET'
      }, {
        type: 'text'
      })
      : typeof opt === 'string'
        ? opt
        : opt.raw ? opt.raw : null;
    if (!p) {
      return rej(new Error("invalid argument in metacsv"));
    }
    return p.then(function(raw){
      raw = raw.trim();
      return Papa.parse(raw).data;
    }).then(function(data){
      var head, body, ret, types;
      head = data.slice(6, 7)[0];
      body = data.slice(7).map(function(d){
        return Object.fromEntries(head.map(function(h, i){
          return [h, d[i]];
        }));
      });
      ret = {
        head: head,
        body: body,
        sheet: [head].concat(data.slice(7)),
        unit: Object.fromEntries(data.slice(4, 5)[0].map(function(d, i){
          return [head[i], d];
        })),
        mag: Object.fromEntries(data.slice(5, 6)[0].map(function(d, i){
          return [head[i], d];
        })),
        meta: data.slice(0, 6)
      };
      types = datum.type.get(ret);
      ret.type = Object.fromEntries(ret.head.map(function(d, i){
        var t, obj;
        t = ret.meta[3][i];
        if (t === 'T') {
          t = 'O';
        }
        obj = !t ? types.filter(function(it){
          return it.key === d;
        })[0] : null;
        if (!obj) {
          obj = {
            type: t,
            types: Object.fromEntries([[t, 1]])
          };
        }
        if (obj.types.I === 1) {
          obj.types.R = 0.5;
        }
        return [d, obj];
      }));
      return ret;
    }).then(function(it){
      return res(it);
    })['catch'](function(e){
      return rej(e);
    });
  });
};</script><script>(function(it){
  return it.apply({});
})(function(){
  var cfg, qs, ref$, this$ = this;
  cfg = {
    pal: {
      colors: ['#d55741', '#e8c05c', '#7febb2', '#577aeb', '#aaaaaa'],
      maps: ['遊戲', '流行音樂', '影視', '出版'].concat([['其它', '樣貌']])
    },
    legend: {
      enabled: true,
      position: 'bottom'
    },
    unit: {
      position: 'inner'
    }
  };
  this.view = new ldview({
    initRender: false,
    ctx: this.ctx = {
      title: '108年文創內容產業概況'
    },
    root: document.body,
    text: {
      title: function(arg$){
        var ctx;
        ctx = arg$.ctx;
        if (ctx) {
          return ctx.title;
        } else {
          return '';
        }
      }
    },
    handler: {
      content: function(arg$){
        var node, ctx;
        node = arg$.node, ctx = arg$.ctx;
        if (!ctx.content) {
          return;
        }
        node.innerText = ctx.content;
        return node.classList.add('d-flex', 'align-items-center', 'justify-content-center', 'font-weight-bold', 'text-lg');
      },
      loader: function(arg$){
        var node, ctx;
        node = arg$.node, ctx = arg$.ctx;
        return node.classList.toggle('d-none', !!ctx.inited);
      }
    }
  });
  this.manager = new block.manager({
    registry: function(arg$){
      var name, version;
      name = arg$.name, version = arg$.version;
      return "/assets/block/" + name + "/" + version + "/index.html";
    },
    moduleRegistry: function(arg$){
      var name, version, path;
      name = arg$.name, version = arg$.version, path = arg$.path;
      if (!/^d3/.exec(name)) {
        return "/assets/lib/" + name + "/" + version + "/" + path;
      }
      return "/assets/custom-lib/d3/" + name + ".v" + version + ".min.js";
    }
  });
  qs = Object.fromEntries(window.location.search.substring(1).split('&').map(function(it){
    return it.split('=').map(function(it){
      return decodeURIComponent(it);
    });
  }));
  this.ctx.flavor = +qs.flavor;
  if (this.ctx.flavor !== 1) {
    ref$ = this.ctx;
    ref$.title = '';
    ref$.content = 'Coming Soon';
    ref$.inited = true;
    this.view.render();
    return;
  }
  this.view.render();
  return this.manager.init().then(function(){
    return i18next.init({
      supportedLng: ['en', 'zh-TW'],
      fallbackLng: 'zh-TW'
    });
  }).then(function(){
    return block.i18n.use(i18next);
  }).then(function(){
    return metacsv({
      url: "/assets/data/ci/產業樣貌.csv"
    });
  }).then(function(it){
    return this$.data = it;
  }).then(function(){
    return this$.data.body.map(function(b, i){
      ['年度', '家數', '就業人數', '產值', '出口值'].map(function(attr){
        return b[attr] = +(b[attr] + "").replace(/,/g, '');
      });
      return b._idx = i;
    });
  }).then(function(){
    var root;
    root = document.querySelector('#root');
    return this$.manager.get({
      name: "treemap",
      version: "0.0.1"
    }).then(function(it){
      return it.create({
        data: this.data
      });
    }).then(function(bi){
      return bi.attach({
        root: root
      }).then(function(){
        return bi['interface']();
      });
    }).then(function(chart){
      var raw, binding;
      chart.config(cfg);
      raw = this$.data.body.filter(function(it){
        return +it["年度"] === 108;
      });
      binding = {
        color: {
          key: '產業別'
        },
        area: {
          key: '產值',
          unit: this$.data.unit['產值']
        },
        category: {
          key: '產業別'
        },
        name: {
          key: '次分類'
        }
      };
      return chart.setRaw({
        raw: raw,
        binding: binding
      });
    });
  }).then(function(){
    this$.ctx.inited = true;
    return this$.view.render();
  });
});</script></body></html>