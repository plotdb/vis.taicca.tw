<!DOCTYPE html><html><head><meta http-equiv="Content-type" content="text/html;charset=UTF-8"><base href=".."><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1"><!-- Global site tag (gtag.js) - Google Analytics--><script async src="https://www.googletagmanager.com/gtag/js?id=G-HXVX4JRNGZ"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-HXVX4JRNGZ');</script><link rel="stylesheet" type="text/css" href="/assets/lib/bootstrap/main/dist/css/bootstrap.min.css"><link rel="stylesheet" type="text/css" href="/assets/lib/@loadingio/bootstrap.ext/main/index.min.css"><link rel="stylesheet" type="text/css" href="/assets/lib/ldiconfont/main/index.min.css"><link rel="stylesheet" type="text/css" href="/assets/lib/ldslider/main/index.min.css"><link rel="stylesheet" type="text/css" href="/assets/lib/ldcover/main/index.min.css"><link rel="stylesheet" type="text/css" href="/assets/lib/ldloader/main/index.min.css"><link rel="stylesheet" type="text/css" href="/assets/lib/ldbutton/main/index.min.css"><link rel="stylesheet" type="text/css" href="/assets/lib/ldpalettepicker/main/index.min.css"><link rel="stylesheet" type="text/css" href="/assets/lib/@loadingio/loading.css/main/lite.min.css"><link rel="stylesheet" type="text/css" href="/assets/lib/@loadingio/transition.css/main/transition.min.css"><link rel="stylesheet" type="text/css" href="/assets/lib/@loadingio/ldcolorpicker/main/index.min.css"><link rel="stylesheet" type="text/css" href="/assets/lib/@plotdb/sheet/main/index.min.css"><link rel="stylesheet" type="text/css" href="/assets/lib/@plotdb/chart/main/index.min.css"><link rel="stylesheet" type="text/css" href="css/panel.css"><link rel="stylesheet" type="text/css" href="css/index.css"><title>主題產業數據儀表板</title><style type="text/css">.header{display:flex;align-items:center}.header .entry{opacity:.5;cursor:pointer}.header .entry.active{opacity:1;color:#fff}#root{height:100%;font-size:14px}.dashboard{position:absolute;top:0;left:0;z-index:10;display:grid;padding:1em;gap:1em;width:100%;height:100%;perspective:1000px}.pnl.widget{padding-top:.5em;opacity:1;transform:rotate3d(0,1,0,0);transition:transform .35s ease-in-out,opacity .35s ease-in-out;z-index:1;position:relative}.pnl.widget.highlight{color:#f5faff}.pnl.widget.highlight.color{text-shadow:0 1px 1px rgba(0,0,0,0.3)}.pnl.widget.highlight.color-film{background:#b53d27}.pnl.widget.highlight.color-revenue{background:#dfa921}.pnl.widget.highlight.color-ticket{background:#31df46}.pnl.inactive{z-index:0;opacity:0}.dashboard.hide{z-index:1;pointer-events:none}.dashboard.hide .pnl.widget{transform:rotate3d(0,1,0,360deg);opacity:0}.dashboard .pnl.widget.hide{transform:rotate3d(0,1,0,360deg);pointer-events:none;opacity:0}.dashboard.hide[data-name=tw] .pnl.widget{transform:rotate3d(0,1,0,-360deg)}.rank-list-item{border:1px solid transparent;border-radius:.25em;margin:0 0 .5em;transition:all .15s ease-in-out}.rank-list-item:hover{margin:-0.25em 0 .75em;box-shadow:0 3px 3px 1px rgba(0,0,0,0.2)}.hint{display:inline-block;font-size:12px;color:#fff}[data-name=title]{grid-column:1/-1;grid-row:1}@media(max-width:1200px){body{font-size:14px}}@media(max-width:1024px){body{overflow:scroll}.dashboard{position:static;grid-template-columns:1fr !important;grid-template-rows:auto}.dashboard .pnl{grid-area:auto !important;height:75vw}.header .unclickable{display:none}#root{height:auto}.dashboard.hide{display:none}}@media(max-width:800px){.header{flex-direction:column;text-align:center}.header>div{margin-bottom:.5em}}</style></head><body><div class="w-100 ld ld-over-inverse running" id="root" ld="loader"><div class="ld" style="width:100%;height:100%;top:0;left:0;"><img style="left:0;right:0;margin:-2.5em auto 0;width:5em;height:5em;" src="/assets/img/loader.svg"><div style="width:max-content;left:0;right:0;margin:2.5em auto 0;text-align:center;"><div class="text-sm">程式載入中<br>請稍候 ...</div></div></div><div class="h-100 d-flex flex-column" ld="dash"><div style="padding:1em 1em 0"><div class="pnl" data-name="title"><div class="header"><div class="mr-5"><div class="text-hl">主題產業數據儀表板</div><div class="text-sm text-white"><a class="text-white" href="https://taicca.tw" rel="noopener noreferrer">&#x00ab; 文化內容策進院</a><span>&nbsp;/ 策略研究處</span></div></div><div class="text-lg text-hl mr-4 entry active" ld="category switch" data-cat="movie" data-target="movie-tw">每週電影票房資訊</div><div class="text-lg text-hl mr-4 entry" ld="category switch" data-cat="book" data-target="book-comic">每季聯合圖書館藏資訊</div><div class="flex-grow-1"></div><div ld="ctrl" data-name="book"><div class="d-flex" ld="ctrl-inner" data-name="book-comic"><div class="dropdown"><div class="btn btn-light dropdown-toggle d-flex align-items-center" data-toggle="dropdown"><div>時段：</div><div class="mx-2" style="line-height:1em;white-space:pre" ld="date-range">近半年</div></div><div class="dropdown-menu dropdown-menu-right shadow-sm"><div class="dropdown-item" ld="date-preset" data-name="all">全部時段</div><div class="dropdown-item" ld="date-preset" data-name="1q">最近一季</div><div class="dropdown-item" ld="date-preset" data-name="1y">最近一年</div><div class="dropdown-divider"></div><div class="dropdown-header">時段起點</div><div class="dropdown-item"><select class="form-control" ld="date-picker" data-type="start" style="width:9em"><option ld-each="date"></option></select></div><div class="dropdown-header">時段終點</div><div class="dropdown-item"><select class="form-control" ld="date-picker" data-type="end" style="width:9em"><option ld-each="date"></option></select></div></div></div><div class="dropdown"><div class="btn btn-light dropdown-toggle d-flex align-items-center ml-2" data-toggle="dropdown">下載</div><div class="dropdown-menu dropdown-menu-right"><div class="dropdown-header">全部資料</div><div class="dropdown-item" ld="download" data-name="all">全時段</div><div class="dropdown-item" ld="download" data-name="part">選定時段</div><div class="dropdown-divider"></div><div class="dropdown-header">漫畫 / 小說</div><div class="dropdown-item" ld="download" data-name="all-comic">全時段</div><div class="dropdown-item" ld="download" data-name="part-comic">選定時段</div></div></div></div></div><div class="d-none" ld="ctrl" data-name="movie"><div class="d-flex" ld="ctrl-inner" data-name="movie-tw"><div class="btn btn-light mr-2 text-nowrap" ld="show-dialog" data-name="rank">整體排名</div><div class="btn btn-light mr-2 text-nowrap" ld="show-dialog" data-name="sheet">表格檢視</div><div class="dropdown"><div class="btn btn-light dropdown-toggle d-flex align-items-center" data-toggle="dropdown"><div>時段：</div><div class="mx-2" style="line-height:1em;white-space:pre" ld="date-range">近半年</div></div><div class="dropdown-menu dropdown-menu-right shadow-sm"><div class="dropdown-item" ld="date-preset" data-name="all">全部時段</div><div class="dropdown-item" ld="date-preset" data-name="1m">最近一個月</div><div class="dropdown-item" ld="date-preset" data-name="6m">最近半年</div><div class="dropdown-divider"></div><div class="dropdown-header">時段起點</div><div class="dropdown-item"><select class="form-control" ld="date-picker" data-type="start" style="width:9em"><option ld-each="date"></option></select></div><div class="dropdown-header">時段終點</div><div class="dropdown-item"><select class="form-control" ld="date-picker" data-type="end" style="width:9em"><option ld-each="date"></option></select></div></div></div><div class="dropdown"><div class="btn btn-light dropdown-toggle d-flex align-items-center ml-2" data-toggle="dropdown">下載</div><div class="dropdown-menu dropdown-menu-right"><div class="dropdown-header">原始資料</div><div class="dropdown-item" ld="download" data-name="all">全時段</div><div class="dropdown-item" ld="download" data-name="part">選定時段</div><div class="dropdown-divider"></div><div class="dropdown-header">篩選後之資料</div><div class="dropdown-item" ld="download" data-name="part-filter-tw">僅國片</div><div class="dropdown-item" ld="download" data-name="part-filter">國片及外片</div><div class="dropdown-header">註: 篩選資料中, 各部電影僅保留最終一筆數據</div></div></div></div></div></div></div></div><div class="position-relative" style="flex:1 0 500px"><div class="dashboard hide" ld="dashboard" data-name="book-all"><div class="pnl widget" ld-each="panel" data-name="book-all"><div class="d-flex"><div class="title mb-0 flex-grow-1 clickable" ld="popup"><span ld="title"></span> <i class="i-magnify"></i></div><div class="clickable" ld="toggle"></div><div class="flex-grow-1"></div><div class="clickable d-flex g-2"><div ld-each="alt"></div></div></div><div class="chart" ld="chart"></div></div><div class="pnl widget d-flex flex-column align-items-center justify-content-center clickable trigger" ld="switch" data-target="book-comic"><div>點擊此處了解</div><div class="text-lg font-weight-bold text-center d-flex align-items-center justify-content-center"><div class="text-center mr-3"><div>漫畫/小說類</div><div>書籍館藏狀況</div></div><div><i class="i-chevron-right"></i></div></div></div></div><div class="dashboard hide" ld="dashboard" data-name="book-comic"><div class="pnl widget" ld-each="panel" data-name="book-comic"><div class="d-flex"><div class="title mb-0 flex-grow-1 clickable" ld="popup"><span ld="title"></span> <i class="i-magnify"></i></div><div class="clickable" ld="toggle"></div><div class="flex-grow-1"></div><div class="clickable d-flex g-2"><div ld-each="alt"></div></div></div><div class="chart" ld="chart"></div></div><div class="pnl widget d-flex flex-column align-items-center justify-content-center clickable trigger" style="grid-area:1/7/span 1/span 1" ld="switch" data-target="book-all"><div>點擊此處了解</div><div class="text-lg font-weight-bold">所有書籍館藏狀況 <i class="i-chevron-right"></i></div></div></div><div class="dashboard hide" ld="dashboard" data-name="movie-tw"><div class="pnl widget" ld-each="panel" data-name="movie-tw"><div class="d-flex"><div class="title mb-0 flex-grow-1 clickable" ld="popup"><span ld="title"></span> <i class="i-magnify"></i></div><div class="clickable" ld="toggle"></div><div class="flex-grow-1"></div><div class="clickable d-flex g-2"><div ld-each="alt"></div></div></div><div class="chart" ld="chart"></div></div><div class="pnl widget d-flex flex-column align-items-center justify-content-center clickable trigger" ld="switch" data-target="movie-all"><div>點擊此處了解</div><div class="text-lg font-weight-bold">外片+國片銷售狀況 <i class="i-chevron-right"></i></div></div></div><div class="dashboard hide" ld="dashboard" data-name="movie-all"><div class="pnl widget" ld-each="panel" data-name="movie-all"><div class="d-flex"><div class="title mb-0 flex-grow-1 clickable" ld="popup"><span ld="title"></span> <i class="i-magnify"></i></div><div class="clickable" ld="toggle"></div><div class="flex-grow-1"></div><div class="clickable d-flex g-2"><div ld-each="alt"></div></div></div><div class="chart" ld="chart"></div></div><div class="pnl widget d-flex flex-column align-items-center justify-content-center clickable trigger" ld="switch" data-target="movie-tw"><div>點擊此處了解</div><div class="text-lg font-weight-bold">台灣電影銷售狀況 <i class="i-chevron-right"></i></div></div></div></div></div><div class="position-fixed" style="right:1em;bottom:1em;font-size:12px;padding:.25em .5em;background:#222;color:#ccc;z-index:10;border-radius:3px;box-shadow:0 2px 4px rgba(0,0,0,.3)"><span class="mr-1">資料來源:</span><a href="https://www.tfi.org.tw/BoxOfficeBulletin/weekly" target="_blank" rel="noopener noreferrer">國影中心</a><span class="mx-1">/</span><a href="https://data.gov.tw/dataset/7502" target="_blank" rel="noopener noreferrer">NBINet</a></div></div><div class="p-4 text-white footer text-center"><div class="my-4"><a class="d-block mb-4 mx-auto" href="https://taicca.tw" rel="noopener noreferrer"><img src="/assets/img/logo/footer.svg" alt="taicca logo" width="285px" height="29px" style="max-width:90%;width:450px;height:auto"></a><div>105402 台北市松山區民生東路三段158號5樓 <a href="https://goo.gl/maps/KiMW8eZCXnnwVYB99" rel="noopener noreferrer"><i class="i-location"></i></a></div><div>5F, No. 158, Sec 3, Minsheng E. Rd., Songshan Dist., Taipei City 105402, Taiwan </div><div>TEL (02) 2745-8186 FAX (02) 2749-2436</div><div class="mt-4 font-weight-bold mb-2">聯繫我們</div><div><a href="https://taicca.tw/page/contact" rel="noopener noreferrer"><i class="i-mail"></i></a><a class="mx-4" href="https://www.facebook.com/taicca.tw" rel="noopener noreferrer"><i class="i-fb"></i></a><a href="https://twitter.com/TAICCA_Official" rel="noopener noreferrer"><i class="i-twt"></i></a></div></div></div><div class="ldcv scroll" ld-scope="" ld="ldcv-sheet ldcv" data-name="sheet"><div class="base w-1024" style="height:80%;min-height:90%;"><div class="inner card"><div class="card-body p-0"><div class="p-2 d-flex"><div class="flex-grow-1"><input class="form-control form-control-sm" ld="search" placeholder="關鍵字搜尋 ..."></div><div class="ml-2"><div class="btn btn-sm btn-outline-secondary d-flex align-items-center" data-ldcv-set="">關閉表格 <i class="i-close"></i></div></div></div><div ld="content"></div></div></div></div></div><div class="ldcv scroll" ld="ldcv" data-name="magnify"><div class="base w-1024 rwd" style="height:80%"><div class="inner card" style="background:#000"><div class="card-header border-bottom border-dark d-flex"><div class="flex-grow-1" ld="magnify-title"></div><div class="clickable" data-ldcv-set=""><i class="i-close"></i></div></div><div class="card-body" ld="magnify"></div></div></div></div><div class="ldcv scroll text-dark" ld-scope="" ld="ldcv-rank ldcv" data-name="rank"><div class="base w-1024"><div class="inner card"><div class="card-body"><h3>電影票房總排名</h3><p>指定時間範圍內，國內外電影依總票房排名結果</p><hr><div class="mb-2 d-flex align-items-center justify-content-start"><div class="px-2 py-1 mr-2 text-right rounded" style="width:3em">排名</div><div class="px-2 py-1 mr-2 text-center rounded" style="width:6em">國別</div><div class="px-2 py-1 mr-2 text-center" style="width:8em">總票房 <small>(新臺幣)</small></div><div class="px-2 py-1 flex-grow-1">片名</div></div><div class="d-flex align-items-center justify-content-start rank-list-item py-1 px-1" ld-each="rank"><div class="px-2 py-1 mr-2 text-right bg-white" ld="rank" style="width:3em"></div><div class="px-2 py-1 text-white mr-2 text-center rounded" ld="country" style="width:6em"></div><div class="px-2 py-1 mr-2 text-right bg-light" style="width:8em"><span ld="revenue"></span><span>元</span></div><div class="px-2 py-1 bg-light flex-grow-1" ld="name"></div></div></div></div></div></div><style type="text/css">.dashboard[data-name=movie-single] .pnl.widget .title .i-magnify{display:none}</style><div class="ldcv scroll" ld-scope="" ld="ldcv-movie-single ldcv" data-name="movie-single"><div class="base w-1024" style="height:80%"><div class="inner card" style="background:#000"><div class="card-body position-relative"><div class="dashboard hide" ld="dashboard" data-name="movie-single"><div class="pnl widget" ld-each="panel" data-name="movie-single"><div class="d-flex"><div class="title mb-0 flex-grow-1 clickable" ld="popup"><span ld="title"></span> <i class="i-magnify"></i></div><div class="clickable" ld="toggle"></div><div class="flex-grow-1"></div><div class="clickable d-flex g-2"><div ld-each="alt"></div></div></div><div class="chart" ld="chart"></div></div><div class="pnl widget" style="overflow-y:scroll;display:block;grid-area:1 / 1 / span 1 / span 4"><div><span class="mr-4" style="display:inline-block;width:7em">電影中文片名</span> <span ld="name">電影名稱</span></div><div><span class="mr-4" style="display:inline-block;width:7em">上映日期</span> <span ld="date">上映日期</span></div><div><span class="mr-4" style="display:inline-block;width:7em">申請人</span> <span ld="applicant">申請人</span></div><div><span class="mt-2 mb-1 mr-4" style="display:inline-block;width:7em">出品人</span><div class="d-flex flex-wrap g-2"><div class="rounded bg-dark px-2 py-1" ld-each="publisher"></div></div></div></div></div><div class="position-absolute z-float clickable p-2 bg-dark rounded shadow" data-ldcv-set="" style="top:1em;right:1em"><i class="i-close"></i></div></div></div></div></div><script>if(/MSIE|Trident/.exec(navigator.userAgent)) { window.location.href = "/err/ie/" };</script><script type="text/javascript" src="https://polyfill.io/v3/polyfill.min.js?features=ResizeObserver" defer></script><script type="text/javascript" src="/assets/lib/i18next/main/dist/umd/i18next.min.js" defer></script><script type="text/javascript" src="/assets/lib/@loadingio/ldquery/main/index.min.js" defer></script><script type="text/javascript" src="/assets/lib/ldview/main/index.min.js" defer></script><script type="text/javascript" src="/assets/lib/lderror/main/index.min.js" defer></script><script type="text/javascript" src="/assets/lib/@loadingio/debounce.js/main/index.min.js" defer></script><script type="text/javascript" src="/assets/lib/bootstrap.native/main/dist/bootstrap-native-v4.min.js" defer></script><script type="text/javascript" src="/assets/lib/papaparse/main/papaparse.min.js" defer></script><script type="text/javascript" src="/assets/lib/csv4xls/main/index.min.js" defer></script><script type="text/javascript" src="/assets/lib/proxise/main/index.min.js" defer></script><script type="text/javascript" src="/assets/lib/@plotdb/semver/main/index.min.js" defer></script><script type="text/javascript" src="/assets/lib/@plotdb/csscope/main/index.min.js" defer></script><script type="text/javascript" src="/assets/lib/@plotdb/rescope/main/index.min.js" defer></script><script type="text/javascript" src="/assets/lib/@plotdb/block/main/index.min.js" defer></script><script type="text/javascript" src="/assets/lib/@plotdb/konfig/main/index.min.js" defer></script><script type="text/javascript" src="/assets/lib/@plotdb/konfig/main/konfig.widget.bootstrap.js" defer></script><script type="text/javascript" src="/assets/lib/ldcolor/main/index.min.js" defer></script><script type="text/javascript" src="/assets/lib/ldcover/main/index.min.js" defer></script><script type="text/javascript" src="/assets/lib/ldloader/main/index.min.js" defer></script><script type="text/javascript" src="/assets/lib/ldslider/main/index.min.js" defer></script><script type="text/javascript" src="/assets/lib/@loadingio/ldcolorpicker/main/index.min.js" defer></script><script type="text/javascript" src="/assets/lib/ldpalettepicker/main/index.min.js" defer></script><script type="text/javascript" src="/assets/lib/ldpalettepicker/main/all.palettes.js" defer></script><script type="text/javascript" src="/assets/lib/@plotdb/sheet/main/index.min.js" defer></script><script type="text/javascript" src="/assets/lib/ldfile/main/index.min.js" defer></script><script type="text/javascript" src="/assets/lib/smiltool/main/smiltool.min.js" defer></script><script type="text/javascript" src="/assets/lib/jszip/main/dist/jszip.min.js" defer></script><script type="text/javascript" src="/assets/lib/@loadingio/vscroll/main/index.min.js" defer></script><script type="text/javascript" src="/assets/lib/@plotdb/datum/main/index.min.js" defer></script><script type="text/javascript" src="/assets/lib/@plotdb/chart/main/index.min.js" defer></script><script type="text/javascript" src="/assets/lib/@plotdb/chart/main/utils/tint.min.js" defer></script><script type="text/javascript" src="/assets/lib/@plotdb/chart/main/utils/config.min.js" defer></script><script type="text/javascript" src="https://d3js.org/d3.v4.js" defer></script><script type="text/javascript" src="https://d3js.org/d3-array.v2.min.js" defer></script><script type="module">var app = {};var dashboard,ref$;dashboard=function(t){var r=this;t==null&&(t={});this._dashboard={};this._active=null;this._root=t.root;this._mgr=t.manager;this._ps=[];this._evhd={};this._idx=1;this.init=proxise.once(function(){return r._init()});return this};ref$=import$(dashboard.prototype,Object.create(Object.prototype));ref$.on=function(t,e){var n=this;return(Array.isArray(t)?t:[t]).map(function(t){var r;return((r=n._evhd)[t]||(r[t]=[])).push(e)})};ref$.fire=function(t){var r,e,n,i,a,o,s,u=[];e=[];for(n=1,i=arguments.length;n<i;++n){e.push(arguments[n])}r=e;for(n=0,o=(a=this._evhd[t]||[]).length;n<o;++n){s=a[n];u.push(s.apply(this,r))}return u};ref$._waitee=function(t){return this._ps.push(t)};ref$._waiter=function(){var t=this;return Promise.all(this._ps).then(function(){return t._ps.splice(0)})};ref$.renderChart=function(t){var r,e,n,i,a,o;r=t.chart,e=t.panel,n=t.dashboard,i=t.meta;a=i.obj({data:n._data,filter:e.filter,cfg:e.cfg});o=Array.isArray(a.config)?a.config:[a.config];r.config.apply(r,o);return r.setRaw(a.data)};ref$.prepareChart=function(t){var r,e,n,i,a,o=this;r=t.root,e=t.panel,n=t.dashboard;if(!e.chartdef){return}if(this._active!==n.name){return}i=e.chartdef();a=Promise.resolve().then(function(){if(e.block){return o.renderChart({chart:e.block["interface"],dashboard:n,panel:e,meta:i})}return o._mgr.from(import$({version:"0.0.1"},i.def),{root:r,data:{delayRender:true}}).then(function(t){var r;r=t["interface"];r.on("select",function(t){return n.select({panel:e,data:t})});r.on("filter",function(t){e.filter=t;return n.filter().then(function(){return o.render()})});o.renderChart({chart:r,dashboard:n,panel:e,meta:i});return e.block=t})});return this._waitee(a)};ref$.addDashboard=function(t,r){var e=this;this._dashboard[t]=r;if(r.panels[0]&&r.panels[0].list){r.panels.map(function(t){return t.list.map(function(t){if(!(t.id!=null)){return t.id=Math.random().toString(36).substring(2)+"/"+e._idx++}})})}else if(Array.isArray(r.panels)){r.panels.map(function(t){if(!(t.id!=null)){return t.id=e._idx++}})}return r.name=t};ref$.board=function(t){return this._dashboard[t||this._active]};ref$.active=function(){return this._active};ref$.filter=function(){var t=this;return this._dashboard[this._active].filter().then(function(){return t.render()})};ref$.select=function(t){t==null&&(t={});if(this._dashboard[this._active].select){return this._dashboard[this._active].select(t)}};ref$.toggle=function(r){var e,n=this;if(!(e=this._dashboard[r])){throw lderror(404)}return Promise.resolve().then(function(){var t;if(t=e._data){return t}return e.data()}).then(function(t){e._data=t;n._active=r;n.render();return n.fire("toggle",{name:r})})};ref$.render=function(){return this.view.render()};ref$.isPanelActive=function(t){var r,e;r=t.panel;e=this.board();if(!(e.setup!=null)){return true}else{return in$(r.id,(e.setups||{})[e.setup]||[])}};ref$._init=function(){var o=this;return Promise.resolve().then(function(){var t;t={};t.panel={action:{click:{popup:function(t){var r,e,n;r=t.node,e=t.ctx,n=t.ctxs;return o.fire("popup",{root:r,panel:e,dashboard:n[0]})}}},handler:{"@":function(t){var r,e,n,i,a;r=t.node,e=t.ctx,n=t.views;i=r.style;i.gridColumn=e.col[0]+" / span "+e.col[1];i.gridRow=e.row[0]+" / span "+e.row[1];if(e["class"]){e["class"].map(function(t){return r.classList.toggle(t,true)})}a=o.isPanelActive({panel:e});if(!a){return r.classList.toggle("hide",true)}else{return debounce(660).then(function(){return r.classList.toggle("hide",false)})}},title:function(t){var r,e;r=t.node,e=t.ctx;return r.innerText=e.title||e.name||e.id},chart:function(t){var r,e,n;r=t.node,e=t.ctx,n=t.ctxs;if(!o.isPanelActive({panel:e})){return}return o.prepareChart({root:r,panel:e,dashboard:n[0]})},alt:{list:function(t){var r;r=t.ctx;return r.alt||[]},key:function(t){return t.name},view:{text:{"@":function(t){var r;r=t.ctx;return r.name}},action:{click:{"@":function(t){var r,e,n;r=t.ctx,e=t.ctxs,n=t.views;if(r.setup){e[1].setup=r.setup}else if(r.cfg){e[0].cfg=r.cfg}return n[2].render()}}}}}}};t.dashboard={ctx:function(t){var r;r=t.node;return o._dashboard[r.getAttribute("data-name")]||{panels:[],grid:{col:[],row:[]}}},handler:{"@":function(t){var e,n,r,i,a;e=t.node,n=t.ctx,r=t.views;i=n.grid;a=e.style;a.gridTemplateColumns=i.col.join(" ");a.gridTemplateRows=i.row.join(" ");return debounce(350).then(function(){return o._waiter()}).then(function(){var t,r;t=e.classList.contains("hide");r=n.name!==o._active;if(t===r&&r){return}e.classList.toggle("hide",r);return debounce(350).then(function(){return o.fire("toggle.done")})})},panel:{list:function(t){var r;r=t.ctx;return r.panels||[]},key:function(t){return t.id||t.name},view:t.panel}}};return o.view=new ldview({root:o._root,initRender:false,action:{click:{switch:function(t){var r,e;r=t.node;if(e=r.getAttribute("data-target")){return o.toggle(e)}}}},handler:{dashboard:t.dashboard}})})};function import$(t,r){var e={}.hasOwnProperty;for(var n in r)if(e.call(r,n))t[n]=r[n];return t}function in$(t,r){var e=-1,n=r.length>>>0;while(++e<n)if(t===r[e])return true;return false}(function() {(function(e){return e.apply(app)})(function(){var l=this;this.inited=false;this.loading=false;this.config={palette:{colors:["#d55741","#e8c05c","#6ee97d","#7fb2eb","#577aeb","#b376ee"]}};this.ldcv={};this.magnify={};this.view=new ldview({initRender:false,root:document.body,action:{click:{"show-dialog":function(e){var t,n;t=e.node;n=t.getAttribute("data-name");if(n==="sheet"){l.mb.board().sheet().then(function(e){l.sheet.ctrl.data(l.sheet.data=e.data);l.sheet.head=e.data[0];return l.subview.sheet.render()})}else if(n==="rank"){l.subview.rank.render()}return l.ldcv[n].toggle()}}},init:{ldcv:function(e){var t;t=e.node;return l.ldcv[t.getAttribute("data-name")]=new ldcover({root:t,resident:true})}},handler:{loader:function(e){var t;t=e.node;return t.classList.toggle("running",!l.inited||l.loading)},category:function(e){var t;t=e.node;return t.classList.toggle("active",(l.mb.active()||"").startsWith(t.getAttribute("data-cat")))},ctrl:function(e){var t;t=e.node;return t.classList.toggle("d-none",!(l.mb.active()||"").startsWith(t.getAttribute("data-name")))},"ctrl-inner":{ctx:function(e){var t,n,r;t=e.node;n=t.getAttribute("data-name");if(!(l.mb&&(r=l.mb.board(n)))){return{dates:{list:[]}}}return r.ctrl()},action:{change:{"date-picker":function(e){var t,n,r,i,a;t=e.node,n=e.ctx,r=e.views;i=n.dates;a=t.getAttribute("data-type");i.picked[a]=t.value;r[0].render("date-range");return l.mb.filter()}},click:{download:function(e){var t,n,r;t=e.node,n=e.ctx;r=t.getAttribute("data-name");return l.mb.board().csv({type:r}).then(function(e){return ldfile.download({blob:csv4xls.toBlob(e),name:"result.csv"})})},"date-picker":function(e){var t;t=e.evt;return t.stopPropagation()},"date-preset":function(e){var t,n,r,i,a,o,s,d;t=e.node,n=e.ctx,r=e.views;i=n.dates;a=t.getAttribute("data-name");switch(a){case"all":o=i.picked;o.start=i.list[0];o.end=(s=i.list)[s.length-1];break;case"1m":d=Date.now()-864e5*31;i.picked.start=i.list.filter(function(e){return new Date(e).getTime()>=d})[0]||(o=i.list)[o.length-1];i.picked.end=(o=i.list)[o.length-1];break;case"6m":d=Date.now()-864e5*182;i.picked.start=i.list.filter(function(e){return new Date(e).getTime()>=d})[0]||(o=i.list)[o.length-1];i.picked.end=(o=i.list)[o.length-1];break;case"1q":i.picked.start=(o=i.list)[o.length-1];i.picked.end=(o=i.list)[o.length-1];break;case"1y":i.picked.start=(o=i.list)[o.length-4];i.picked.end=(o=i.list)[o.length-1]}r[0].render("date-picker","date-range","date");return l.mb.filter()}}},handler:{"date-range":function(e){var t,n,r,i,a;t=e.node,n=e.ctx;r=n.dates;if(r.picked.start===r.list[0]&&r.picked.end===(i=r.list)[i.length-1]){if(/book/.exec(l.mb.active())){a=[n.dates.list[0],(i=n.dates.list)[i.length-1]];t.textContent="由 "+a[0]+"\n至 "+a[1];return t.classList.add("text-sm")}else{t.textContent="全部";return t.classList.remove("text-sm")}}else{t.textContent="由 "+r.picked.start+"\n至 "+r.picked.end;return t.classList.add("text-sm")}},date:{list:function(e){var t;t=e.ctx;return t.dates.list||[]},handler:function(e){var t,n,r,i,a;t=e.node,n=e.data,r=e.ctx;t.textContent=n;t.setAttribute("value",n);i=t.parentNode.getAttribute("data-type");a=(r.dates.picked||{})[i]===n;if(a){return t.setAttribute("selected",true)}else{return t.removeAttribute("selected")}}}}}}});this.subview={sheet:new ldview({initRender:false,root:this.view.get("ldcv-sheet"),action:{input:{search:debounce(350,function(e){var t,n;t=e.node;l.sheet.keyword=n=t.value||"";return l.sheet.ctrl.data(l.sheet.data.filter(function(e,t){if(!(t&&n)){return true}return~JSON.stringify(e).indexOf(n)}))})},click:{content:function(e){var t,n,r,i,a,o;t=e.node,n=e.evt;if(!(r=ld$.parent(n.target,".cell",t))){return}if(!(i=ld$.find(r,"i",0))){return}a=+i.getAttribute("data-idx");o=l.sheet.sort[a]=(l.sheet.sort[a]||-1)*-1;l.sheet.data.sort(function(e,t){var n;if(typeof e[a]==="object"){return-1}else if(typeof t[a]==="object"){return 1}n=e[a]<t[a]?-1:e[a]>t[a]?1:0;return n*o});l.sheet.head.map(function(e,t){if(e.node){return ld$.find(e.node,"i",0).setAttribute("class","")}});i.classList.add(o>0?"i-dart-down":"i-dart-up");return l.sheet.ctrl.data(l.sheet.data.filter(function(e,t){if(!(t&&l.sheet.keyword)){return true}return~JSON.stringify(e).indexOf(l.sheet.keyword)}))}}}}),rank:new ldview({initRender:false,root:this.view.get("ldcv-rank"),handler:{rank:{list:function(e){var t,n;t=e.node;if(!(n=l.mb.board("movie-all").data({async:false}))){return[]}return n.all.movie.all},view:{handler:{rank:function(e){var t,n,r;t=e.node,n=e.ctx,r=e.idx;return t.textContent=n.rank||1},name:function(e){var t,n;t=e.node,n=e.ctx;return t.textContent=n["中文片名"].substring(0,30)},country:function(e){var t,n,r;t=e.node,n=e.ctx;r=n["國別地區"];t.textContent=r.length>1?"多國":r[0];t.classList.toggle("bg-primary",in$("中華民國",r));return t.classList.toggle("bg-secondary",!in$("中華民國",r))},revenue:function(e){var t,n;t=e.node,n=e.ctx;return t.textContent=n["累計銷售金額"]}}}}}})};this.regs={module:function(e){var t,n,r,i;t=e.name,n=e.version,r=e.path,i=e.type;return i==="block"?"/assets/block/"+t+"/"+n+"/index.html":!/^d3/.exec(t)?"/assets/lib/"+t+"/"+n+"/"+(r||"index.min.js"):"/assets/lib/"+t+"/main/"+r}};this.scope=new rescope({prejs:["https://polyfill.io/v3/polyfill.min.js?features=ResizeObserver"],registry:this.regs.module});this.manager=new block.manager({registry:this.regs.module,rescope:this.scope});this.mb=new dashboard({root:this.view.get("dash"),manager:this.manager});this.mbMovie=new dashboard({root:this.view.get("ldcv-movie-single"),manager:this.manager});this.mb.on("toggle",function(e){var t;t=e.name;l.loading=true;return l.view.render("ctrl","category","loader","ctrl-inner")});this.mb.on("toggle.done",function(){l.loading=false;return l.view.render("loader")});this.mb.on("popup",function(e){var t,n,r,i,a,o;t=e.panel,n=e.dashboard;if(!(typeof t.chartdef==="function")){return}r=l.view.get("magnify");i=l.view.get("magnify-title");i.innerText=t.title||t.name||t.id;if(l.magnify.block){l.magnify.block["interface"].destroy()}r.innerHTML="";a=t.chartdef();return o=Promise.resolve().then(function(){return l.ldcv.magnify.toggle(true)}).then(function(){return l.manager.from(import$({version:"0.0.1"},a.def),{root:r,data:{delayRender:true}})}).then(function(e){l.mb.renderChart({chart:e["interface"],panel:t,dashboard:n,meta:a});return l.magnify.block=e})["catch"](function(e){console.log(e);return l.magnify.block=null})});this.sheet={keyword:"",data:[],sort:[],head:[],ctrl:new sheet({root:this.subview.sheet.get("content"),data:[],frozen:{row:1},size:{col:[]},editing:false})};return this.init=function(){var e=this;return this.scope.init().then(function(){return i18next.init({supportedLng:["en","zh-TW"],fallbackLng:"zh-TW"})}).then(function(){return block.i18n.use(i18next)}).then(function(){return e.manager.init()}).then(function(){return e.mb.init()}).then(function(){e.inited=true;e.loading=true;e.view.render("loader");e.mb.toggle("movie-tw");return debounce(350)}).then(function(){return e.mb._waiter()}).then(function(){e.loading=false;return e.view.render()})}});function in$(e,t){var n=-1,r=t.length>>>0;while(++n<r)if(e===t[n])return true;return false}function import$(e,t){var n={}.hasOwnProperty;for(var r in t)if(n.call(t,r))e[r]=t[r];return e}})();
(function() {(function(e){return e.apply(app)})(function(){var o,c,f,n,t,m;(app.category||(app.category={})).book=o={dates:{picked:{},list:[]}};o.cm2=c={10:"哲學",11:"思想",12:"中國哲學",13:"東方哲學",14:"西洋哲學",15:"邏輯",16:"形上學",17:"心理學",18:"美學",19:"倫理學",20:"宗教",21:"比較宗教學",22:"佛教",23:"道教",24:"基督教",25:"回教",26:"猶太教",27:"其他宗教",28:"神話",29:"術數；迷信",30:"科學",31:"數學",32:"天文學",33:"物理學",34:"化學",35:"地球科學；地質學",36:"生物科學",37:"植物學",38:"動物學",39:"人類學",40:"應用科學",41:"醫藥",42:"家政",43:"農業",44:"工程學",45:"礦冶",46:"化學工程",47:"製造",48:"商業",49:"商學",50:"社會科學",51:"統計學",52:"教育",53:"禮俗禮儀",54:"社會學",55:"經濟學",56:"財政學",57:"政治學",58:"法律",59:"軍事",60:"史地",61:"中>國史地",62:"中國斷代史",63:"中國各代文化史",64:"中國外交史",65:"中國史料",66:"中國地理總志",67:"中國地方志",68:"中國地理類志",69:"中國遊記",70:"世界史地",71:"世界史地",72:"海洋志",73:"亞洲史地",74:"西洋/歐洲史地",75:"美洲史地",76:"非洲史地",77:"大洋洲史地",78:"傳記",79:"古物考古學",80:"語言學",81:"文學",82:"中國文學",83:"中國文學總集",84:"中國文學別集",85:"中國各種文學",86:"東方文學",87:"西洋文學",88:"俄國文學",89:">新聞學",90:"藝術",91:"音樂",92:"建築藝術",93:"雕塑",94:"書畫",95:"攝影",96:"應用美術",97:"技藝",98:">戲劇",99:"遊藝及休閒活動","00":"特藏","01":"目錄學","02":"圖書館","03":"國學","04":"類書","05":"期刊","06":"會社","07":"論叢","08":"普通叢書","09":"經學"};o.cm=f={0:"總類",1:"哲學",2:"宗教",3:"自然科學",4:"應用科學",5:"社會科學",6:"中國史地",7:"世界史地",8:"語文",9:"藝術","":"其它"};o.csv=function(e){var a;a=e.type;return n.data().then(function(e){var n,t,r;if(/part/.exec(a)){return/comic/.exec(a)?e.comic:e.all}n=e.raw;t=n.data.map(function(e){return{year:n.table.year[e[0]]||"",pub:n.table.pub[e[1]]||"",idx:e[2],words:e[3].map(function(e){return n.table.words[e]||""}),county:n.table.county[e[4]]||"其它",q:n.table.q[e[5]]||""}});return r=t.filter(function(e){if(/^947[45]/.exec(e.idx)||/^889/.exec(e.idx)||/^8..57/.exec(e.idx)){true}else{false}return/comic/.exec(a)?r:t})}).then(function(e){var n,t;n=["出版年","出版商","索書號","關鍵字","出版地","收錄季"];t=e.map(function(n){return["year","pub","idx","words","county","q"].map(function(e){if(Array.isArray(n[e])){return n[e].join(",")}else{return n[e]}})});return[n].concat(t)})};o.filter=function(e){var n,t,r,a,u,i;n=e.raw;t=n.data.map(function(e){return{year:n.table.year[e[0]]||"",pub:n.table.pub[e[1]]||"",idx:e[2],words:e[3].map(function(e){return n.table.words[e]||""}),county:n.table.county[e[4]]||"其它",q:n.table.q[e[5]]||""}});r=o.dates.picked.start||o.dates.list[0];a=o.dates.picked.end||(u=o.dates.list)[u.length-1];t=t.filter(function(e){return e.q>=r&&e.q<=a});i=t.filter(function(e){if(/^947[45]/.exec(e.idx)||/^889/.exec(e.idx)||/^8..57/.exec(e.idx)){return true}else{return false}});return{all:t,comic:i}};o.sheet=function(){return n.data().then(function(e){var n,r,t;n={};r={county:"縣市",year:"年份",words:"主題文字",pub:"出版商"};t=["county","year","words","pub"];n.head=t.map(function(e,n){var t;t=document.createElement("div");t.classList.add("w-100","h-100","d-flex","justify-content-between","align-items-center");t.innerHTML="<div>"+r[e]+'</div><div class="text-sm mx-1"><i class="" data-idx="'+n+'"></div>';return{type:"dom",node:t}});n.data=[n.head].concat(e.all.map(function(n){return t.map(function(e){if(Array.isArray(n[e])){return n[e].join("\n")}else{return n[e]}})}));return n})};(app.fetch||(app.fetch={})).book=function(){var e;if(e=app.fetch.book._data){return Promise.resolve(import$(e,o.filter(e)))}return ld$.fetch("/assets/data/nbi/min.json",{method:"GET"},{type:"json"}).then(function(e){var n,t,r;o.dates.list.splice.apply(o.dates.list,[0,0].concat(e.table.q));o.dates.list.sort(function(e,n){if(e<n){return-1}else if(e>n){return 1}else{return 0}});n=o.dates.picked;n.start=o.dates.list[0];n.end=(t=o.dates.list)[t.length-1];r={raw:e};import$(r,o.filter(r));return app.fetch.book._data=r})};this.mb.addDashboard("book-all",n={csv:o.csv,ctrl:function(){return{dates:o.dates}},filter:app.fetch.book,sheet:o.sheet,data:app.fetch.book,grid:{col:["1fr","1fr","1fr","2fr","1fr","2fr"],row:["2fr","2fr","2fr","2fr"]},panels:[{row:[1,1],col:[1,1],name:"書籍總數",class:["highlight","color","color-film"]},{row:[1,1],col:[2,1],name:"出版商總數",class:["highlight","color","color-revenue"]},{row:[2,4],col:[6,1],name:"出版商佔比",title:"館藏量前一百名之出版商佔比"},{row:[1,2],col:[3,3],name:"歷年出版商排名",title:"歷年出版商排名(依整體館藏量排序)",alt:[{name:"數值",cfg:"line"},{name:"排名",cfg:"bump"}]},{row:[3,2],col:[3,3],name:"分類歷年走勢",alt:[{name:"數值",cfg:"line"},{name:"排名",cfg:"bump"}]},{row:[2,3],col:[1,2],name:"主題文字雲"}]});t={};m=this.config;t["書籍總數"]=function(){return{def:{name:"number"},obj:function(e){var n;n=e.data;return{data:{raw:[{val:n.all.length,name:"書本數",unit:"種"}],binding:{name:{key:"name"},value:{key:"val",unit:"種"}}},config:[m]}}}};t["出版商總數"]=function(){return{def:{name:"number"},obj:function(e){var n,t;n=e.data;t=Array.from(new Set(n.all.map(function(e){return e.pub}))).length;return{data:{raw:[{val:t,name:"出版商數",unit:"間"}],binding:{name:{key:"name"},value:{key:"val",unit:"間"}}},config:[m]}}}};t["圖書分類佔比"]=function(){return{def:{name:"treemap"},obj:function(e){var n,t,r,a,u,i;n=e.data;t={};n.all.map(function(e){var n;n=e.idx.substring(0,2)+"";return t[n]=(t[n]||0)+1});r=function(){var e,n=[];for(a in e=t){u=e[a];n.push({k:a,v:u})}return n}().map(function(e){var n,t;n=(t={c:f[e.k.substring(0,1)]},t.k=e.k,t.v=e.v,t);n.k=c[n.k]||"其它";return n});i={legend:{enabled:true,selectable:false}};return{data:{raw:r,binding:{area:{key:"v"},name:{key:"k"},category:{key:"c"}}},config:[i,m]}}}};t["歷年出版商排名"]=function(){return{def:{name:"line"},obj:function(e){var n,t,r,a,u,i,o,c,f,l,d;n=e.data,t=e.cfg;r={};n.all.map(function(e){var n;return(r[n=e.year]||(r[n]={}))[e.pub]=((r[n=e.year]||(r[n]={}))[e.pub]||0)+1});a={};for(u in r){i=r[u];c=[];for(f in i){l=i[f];c.push({k:f,v:l})}o=c;o.sort(s);o.splice(0,5).map(p)}c=[];for(f in a){c.push({k:f,v:l})}a=c;a.sort(function(e,n){return n.v-e.v});a=a.splice(0,8);a=a.map(function(e){return e.k});o=n.raw.table.year.map(function(n){var t;t={y:n};a.map(function(e){return t[e]=(r[n]||(r[n]={}))[e]||0});return t});d={mode:t==="bump"?"bump":"line",legend:{enabled:true,selectable:true}};return{data:{raw:o,binding:{order:{key:"y",name:"年份"},value:a.map(function(e){return{key:e,name:e}})}},config:[d,m]};function s(e,n){return n.v-e.v}function p(e){var n;if(!e.k||e.k==="其它"){return}n=e.k.substring(0,4);return a[n]=(a[n]||0)+e.v}}}};t["分類歷年走勢"]=function(){return{def:{name:"line"},obj:function(e){var n,t,r,a,u,i,o;n=e.data,t=e.cfg;r={};n.all.map(function(e){var n,t;n=e.idx.substring(0,1);return(r[t=e.year]||(r[t]={}))[n]=((r[t=e.year]||(r[t]={}))[n]||0)+1});a=n.raw.table.year.map(function(n){var t;t={y:n};[0,1,2,3,4,5,6,7,8,9].map(function(e){return t[f[e]]=(r[n]||{})[e]});t[f[""]]=(r[n]||{})[""];return t});u={mode:t==="bump"?"bump":"line",stack:false,legend:{enabled:true,selectable:true}};return{data:{raw:a,binding:{order:{key:"y",name:"年份"},value:function(){var e,n=[];for(i in e=f){o=e[i];n.push(o)}return n}().map(function(e){return{key:e,name:e}})}},config:[u,m]}}}};t["出版商佔比"]=function(){return{def:{name:"percent-list"},obj:function(e){var n,t,r,a,u,i,o;n=e.data;t={};n.all.map(function(e){return t[e.pub]=(t[e.pub]||0)+1});r=function(){var e,n=[];for(a in e=t){u=e[a];n.push({k:a,v:u})}return n}().filter(function(e){return e.k&&e.k!=="其它"});r.sort(function(e,n){return n.v-e.v});i=r.splice(0,100);o={line:"#fff",collapse:{enabled:true,method:"count",threshold:15}};return{data:{raw:i,binding:{name:{key:"k"},value:{key:"v"}}},config:[o,m]}}}};t["主題文字雲"]=function(){return{def:{name:"wordcloud"},obj:function(e){var n,t,r,a,u,i,o;n=e.data;t={};n.all.map(function(e){return e.words.map(function(e){return t[e]=(t[e]||0)+1})});a=[];for(u in t){i=t[u];a.push({k:u,v:i})}r=a;r.sort(function(e,n){return n.v-e.v});r=r.slice(0,100);r.map(function(e){return e.v=Math.sqrt(e.v)});o={font:{size:32},color:{random:true}};return{data:{raw:r,binding:{text:{key:"k"},value:{key:"v"}}},config:[o,m]}}}};return n.panels.map(function(e){return e.chartdef=t[e.name]})});function import$(e,n){var t={}.hasOwnProperty;for(var r in n)if(t.call(n,r))e[r]=n[r];return e}})();
(function() {(function(n){return n.apply(app)})(function(){var n,e,d,i,r,t,a,o,u,c,f,m,s;n=(app.category||(app.category={})).book;e=app.category.book,d=e.cm2,i=e.cm;r={default:[{row:[1,1],col:[1,1],name:"書籍總數",class:["highlight","color","color-film"],title:"漫畫/小說書籍總數"},{row:[1,1],col:[2,1],name:"出版商總數",class:["highlight","color","color-revenue"],title:"漫畫/小說出版商總數"},{row:[2,4],col:[7,1],name:"出版商佔比",title:"館藏量前100名出版商佔比"},{row:[1,2],col:[3,4],name:"歷年出版商排名",title:"歷年出版商排名(依整體館藏量排序)",alt:[{name:"數值",cfg:"line"},{name:"排名",cfg:"bump"}]},{row:[2,3],col:[1,2],name:"主題文字雲"}],trend:[{row:[3,2],col:[3,4],name:"分類走勢",alt:[{name:"數值",cfg:"line"},{name:"排名",cfg:"bump"},{name:"佔比",setup:"detail"}]}],ratio:[{row:[3,2],col:[3,2],name:"出版商地理分布"},{row:[3,2],col:[5,2],name:"分類佔比",alt:[{name:"走勢",setup:"default"}]}]};for(t in r){a=r[t];for(o=0,u=a.length;o<u;++o){c=o;a[c].id="book/comic/"+t+"/"+c}}this.mb.addDashboard("book-comic",f={csv:n.csv,ctrl:function(){return{dates:n.dates}},data:app.fetch.book,filter:app.fetch.book,sheet:n.sheet,grid:{col:["1fr","1fr","1fr","1fr","1fr","1fr","2fr"],row:["2fr","2fr","2fr","2fr"]},panels:r["default"].concat(r.trend,r.ratio),setup:"default",setups:{default:r["default"].concat(r.trend).map(function(n){return n.id}),detail:r["default"].concat(r.ratio).map(function(n){return n.id})}});m={};s=this.config;m["書籍總數"]=function(){return{def:{name:"number"},obj:function(n){var e;e=n.data;return{data:{raw:[{val:e.comic.length,name:"書本數",unit:"種"}],binding:{name:{key:"name"},value:{key:"val",unit:"種"}}},config:[s]}}}};m["出版商總數"]=function(){return{def:{name:"number"},obj:function(n){var e,r;e=n.data;r=Array.from(new Set(e.comic.map(function(n){return n.pub}))).length;return{data:{raw:[{val:r,name:"出版商數",unit:"間"}],binding:{name:{key:"name"},value:{key:"val",unit:"間"}}},config:[s]}}}};m["出版商地理分布"]=function(){return{def:{name:"taiwan-map"},obj:function(n){var e,r,t,a,o,u,i;e=n.data;r={};e.comic.map(function(n){return r[n.county]=(r[n.county]||0)+1});a=[];for(o in r){u=r[o];a.push({k:o,v:u})}t=a;i={legend:{format:"~d",exp:.62}};return{data:{raw:t,binding:{name:{key:"k"},color:{key:"v"}}},config:[i,s]}}}};m["歷年出版商排名"]=function(){return{def:{name:"line"},obj:function(n){var e,r,t,a,o,u,i,c,f,m,l;e=n.data,r=n.cfg;t={};e.comic.map(function(n){var e;return(t[e=n.year]||(t[e]={}))[n.pub]=((t[e=n.year]||(t[e]={}))[n.pub]||0)+1});a={};for(o in t){u=t[o];c=[];for(f in u){m=u[f];c.push({k:f,v:m})}i=c;i.sort(d);i.splice(0,5).map(p)}c=[];for(f in a){c.push({k:f,v:m})}a=c;a.sort(function(n,e){return e.v-n.v});a=a.splice(0,8);a=a.map(function(n){return n.k});i=e.raw.table.year.map(function(e){var r;r={y:e};a.map(function(n){return r[n]=(t[e]||(t[e]={}))[n]||0});return r});l={mode:r==="bump"?"bump":"line",legend:{enabled:true,selectable:true}};return{data:{raw:i,binding:{order:{key:"y",name:"年份"},value:a.map(function(n){return{key:n,name:n}})}},config:[l,s]};function d(n,e){return e.v-n.v}function p(n){var e;if(!n.k||n.k==="其它"){return}e=n.k.substring(0,4);return a[e]=(a[e]||0)+n.v}}}};m["出版商佔比"]=function(){return{def:{name:"percent-list"},obj:function(n){var e,r,t,a,o,u,i;e=n.data;r={};e.comic.map(function(n){var e;if(!((e=n.pub)==="其它"||e==="")){return r[n.pub]=(r[n.pub]||0)+1}});a=[];for(o in r){u=r[o];a.push({k:o,v:u})}t=a;t.sort(function(n,e){return e.v-n.v});t=t.splice(0,100);i={line:"#fff",collapse:{enabled:true,method:"count",threshold:15}};return{data:{raw:t,binding:{name:{key:"k"},value:{key:"v"}}},config:[i,s]}}}};m["主題文字雲"]=function(){return{def:{name:"wordcloud"},obj:function(n){var e,r,t,a,o,u,i;e=n.data;r={};e.comic.map(function(n){return n.words.map(function(n){return r[n]=(r[n]||0)+1})});a=[];for(o in r){u=r[o];a.push({k:o,v:u})}t=a;t.sort(function(n,e){return e.v-n.v});t.map(function(n){return n.v=Math.sqrt(n.v)});i={font:{size:32},color:{random:true}};return{data:{raw:t,binding:{text:{key:"k"},value:{key:"v"}}},config:[i,s]}}}};m["分類走勢"]=function(){return{def:{name:"line"},obj:function(n){var e,r,t,a,o,u,i,c,f,m,l;e=n.data,r=n.cfg;t={};e.comic.map(function(n){var e,r;e=n.idx.substring(0,2);return(t[r=n.year]||(t[r]={}))[e]=((t[r=n.year]||(t[r]={}))[e]||0)+1});a=new Set;for(o in t){u=t[o];for(i in u){a.add(i)}}c=Array.from(a);f=c.map(function(n){return d[n]});m=e.raw.table.year.map(function(e){var r;r={y:e};c.map(function(n){return r[d[n]]=(t[e]||{})[n]});return r});l={mode:r==="bump"?"bump":"line",stack:false,legend:{enabled:true,selectable:true}};return{data:{raw:m,binding:{order:{key:"y",name:"年份"},value:f.map(function(n){return{key:n,name:n}})}},config:[l,s]}}}};m["分類佔比"]=function(){return{def:{name:"treemap"},obj:function(n){var e,r,t,a,o,u;e=n.data;r={};e.comic.map(function(n){var e;e=n.idx.substring(0,2)+"";return r[e]=(r[e]||0)+1});t=function(){var n,e=[];for(a in n=r){o=n[a];e.push({k:a,v:o})}return e}().map(function(n){var e,r;e=(r={c:i[n.k.substring(0,1)]},r.k=n.k,r.v=n.v,r);e.k=d[e.k]||"其它";return e});u={legend:{enabled:false,selectable:false,position:"bottom"}};return{data:{raw:t,binding:{area:{key:"v"},name:{key:"k"},category:{key:"c"}}},config:[u,s]}}}};return f.panels.map(function(n){return n.chartdef=m[n.name]})});})();
(function() {(function(e){return e.apply(app)})(function(){var x,j,e,o,l,t,s,n=this;(app.category||(app.category={})).movie=x={dates:{picked:{},list:[]}};j=function(e){var t,n;e==null&&(e=[]);e=e.map(function(e){return new Date(e).getTime()});e.sort(function(e,t){if(e<t){return-1}else if(e>t){return 1}else{return 0}});t=e.length;n=1;while(n<t){if(e[n]-e[n-1]>86400*8*1e3){e.splice(n,0,e[n-1]+86400*7*1e3);continue}else{n++}}e=e.map(function(e,t){var n,r;e=new Date(e);n=e.getYear()+1900;r=(e.getMonth()+1+"").padStart(2,"0");e=(e.getDate()+"").padStart(2,"0");return n+"/"+r+"/"+e});return e};x.csv=function(e){var r,t,a,i,n;r=e.type;t=x.dates;a=t.picked.start||t.list[0];i=t.picked.end||(n=t.list)[n.length-1];return l.data().then(function(e){var t,n;t=e.raw.head;if(r==="part"){n=e.raw.body.filter(function(e){var t,n,r;t=[e["起計日"],e["迄計日"]],n=t[0],r=t[1];return n>=a&&n<=i&&r>=a&&r<=i})}else if(r==="part-filter-tw"){n=e.part.movie.tw}else if(r==="part-filter"){n=e.part.movie.all}else{n=e.raw.body}e=n.map(function(n){return t.map(function(e){var t;t=n[e];return t=Array.isArray(t)?t.join(","):!(t!=null)?"":t+""})});e=e.map(function(e){var t;t=e.slice(0,4);t[1]=t[1].replace(/^(..)/,"$1/");t[3]=t[3].replace(/^(..)/,"$1/");return[t[0]+"/"+t[1],t[2]+"/"+t[3]].concat(e.slice(4))});e=[["起計日","迄計日"].concat(t.slice(4))].concat(e);return e})};x.sheet=function(){return l.data().then(function(e){var t,n,r;t={};n=["國別地區","中文片名","上映日期","上映院數","累計銷售票數","累計銷售金額","申請人","出品"];t.head=r=n.map(function(e,t){var n;n=document.createElement("div");n.classList.add("w-100","h-100","d-flex","justify-content-between","align-items-center");n.innerHTML="<div>"+e+'</div><div class="text-sm mx-1"><i class="" data-idx="'+t+'"></div>';return{type:"dom",node:n}});t.sort=n.map(function(){return-1});t.data=[r].concat(e.all.movie.all.map(function(t){return n.map(function(e){if(Array.isArray(t[e])){return t[e].join("\n")}else{return t[e]}})}));return t})};e=function(){return l.data().then(function(e){var t;t=Object.fromEntries(l.panels.map(function(e){return[e.name,e.filter]}));o.call(e.all,e.raw);return o.call(e.part,e.raw,t)})};x.parse=o=function(e,t){var n,r,a,i,l,o,u,s,c,d,f,h,m,p,v,b,w,g=this;t==null&&(t={});n=e.head,r=e.body;this.movie={all:[],byCountry:{},continentmap:{},raw:{}};a={};i=x.dates.picked.start||x.dates.list[0];l=x.dates.picked.end||(o=x.dates.list)[o.length-1];r=r.filter(function(e){var t,n,r,a,i;t=[e["起計日"],e["迄計日"]],n=t[0],r=t[1];a=x.dates.picked.start||x.dates.list[0];i=x.dates.picked.end||(t=x.dates.list)[t.length-1];return n>=a&&n<=i&&r>=a&&r<=i});r.map(function(e){var t;t=e["中文片名"];if(!a[t]||+a[t]["累計銷售金額"]<+e["累計銷售金額"]){return a[t]=e}});for(u in a){s=a[u];a[u]=JSON.parse(JSON.stringify(s))}r.map(function(e){var t;t=e["中文片名"];if(a[t]&&+a[t]["上映院數"]<+e["上映院數"]){return a[t]["上映院數"]=+e["上映院數"]}});this.movie.all=function(){var e,t=[];for(u in e=a){s=e[u];t.push(s)}return t}();this.movie.tw=this.movie.all.filter(function(e){return in$("中華民國",e["國別地區"])});this.body=r;if(t){c=[["revenue","國片累計銷售金額分布","累計銷售金額","tw"],["ticket","國片累計銷售票數分布","累計銷售票數","tw"],["theatre","國片上映院數分布","上映院數","tw"],["revenue","電影累計銷售金額分布","累計銷售金額","all"],["ticket","電影累計銷售票數分布","累計銷售票數","all"],["theatre","電影上映院數分布","上映院數","all"]];for(d=0,f=c.length;d<f;++d){h=c[d];if(!((m=t[h[1]])&&m.name)){continue}m=m.name.value.map(k);this.movie[h[3]]=this.movie[h[3]].filter(y)}if(t["出品人比例"]){p=t["出品人比例"].name||{type:"exclude",value:[]};if(p.type!=="exclude"){console.error("expected filter type for 出品人比例 should be `exclude`")}p=p.value||[];this.movie.tw=this.movie.tw.filter(function(e){return e["出品"].filter(function(e){return!in$(e,p)}).length})}}this.movie.all.map(function(r){return(r["國別地區"]||[]).map(function(e,t){var n;((n=g.movie.byCountry)[e]||(n[e]=[])).push(r);return g.movie.continentmap[e]=r["洲別"][t]})});this.bins={tw:{},all:{}};this.binned={tw:{},all:{}};v={revenue:[0,1e3,5e3,1e4,1e5,1e6,1e7,1e8,1e9,1e11],ticket:[0,100,500,1e3,5e3,1e4,5e4,1e5,5e5,1e6],theatre:[0,5,10,15,20,30,50,70,90]};this.binThresholds={tw:v,all:v};this.bins.all.revenue=d3.bin().thresholds(this.binThresholds.all.revenue);this.bins.all.ticket=d3.bin().thresholds(this.binThresholds.all.ticket);this.bins.all.theatre=d3.bin().thresholds(this.binThresholds.all.theatre);this.bins.tw.revenue=d3.bin().thresholds(this.binThresholds.tw.revenue);this.bins.tw.ticket=d3.bin().thresholds(this.binThresholds.tw.ticket);this.bins.tw.theatre=d3.bin().thresholds(this.binThresholds.tw.theatre);this.binned.all.revenue=this.bins.all.revenue(this.movie.all.map(function(e){return e["累計銷售金額"]}));this.binned.all.ticket=this.bins.all.ticket(this.movie.all.map(function(e){return e["累計銷售票數"]}));this.binned.all.theatre=this.bins.all.theatre(this.movie.all.map(function(e){return e["上映院數"]}));this.binned.tw.revenue=this.bins.tw.revenue(this.movie.tw.map(function(e){return e["累計銷售金額"]}));this.binned.tw.ticket=this.bins.tw.ticket(this.movie.tw.map(function(e){return e["累計銷售票數"]}));this.binned.tw.theatre=this.bins.tw.theatre(this.movie.tw.map(function(e){return e["上映院數"]}));this.movie.all.sort(function(e,t){return t["累計銷售金額"]-e["累計銷售金額"]});this.movie.all.map(function(e,t){return e.rank=t+1});this.total={all:{revenue:this.movie.all.reduce(function(e,t){return e+t["累計銷售金額"]},0),ticket:this.movie.all.reduce(function(e,t){return e+t["累計銷售票數"]},0)},tw:{revenue:this.movie.tw.reduce(function(e,t){return e+t["累計銷售金額"]},0),ticket:this.movie.tw.reduce(function(e,t){return e+t["累計銷售票數"]},0)}};b=n.slice(5);b=b.filter(function(e){return!(e==="銷售票數"||e==="銷售金額")});w={tw:{},all:{}};["all","tw"].map(function(t){return g.movie[t].map(function(e){return w[t][e["中文片名"]]=true})});this.movie.all.map(function(){return w.all});this.date={revenue:{}};r.map(function(e){var t,n,r;t=e["迄計日"];n=e["銷售金額"];r=g.date.revenue[t]||(g.date.revenue[t]={});r.date=t;if(w.all[e["中文片名"]]){r.all=(r.all||0)+n}if(w.tw[e["中文片名"]]){if(e["來源"]==="國內"){r.tw=(r.tw||0)+n}}if(e["來源"]!=="國內"){return r.other=(r.other||0)+n}});return j(function(){var e=[];for(u in this.date.revenue){e.push(u)}return e}.call(this)).map(function(e){if(g.date.revenue[e]){return}return g.date.revenue[e]={date:e,all:0,tw:0,other:0}});function k(e){var t,n,r,a,i;t=g.binThresholds[h[3]][h[0]];if(!~(n=t.indexOf(+e))){for(r=0,a=t.length;r<a;++r){i=r;if(t[i]<+e){continue}n=i;break}if(!~n){n=t.length}}return[t[n-1],+e]}function y(e){var t;t=e[h[2]];return m.filter(function(e){return t>=e[0]&&t<=e[1]}).length}};(app.fetch||(app.fetch={})).movie=function(e){var t;e==null&&(e={});if(e.async!=null&&!e.async){return app.fetch.movie._data}if(t=app.fetch.movie._data){return Promise.resolve(t)}return ld$.fetch("/assets/data/tfi/all.json",{method:"GET"},{type:"json"}).then(function(e){var t,n,r,a,i,l;t=e.head;n=e.body.map(function(n){return Object.fromEntries(t.map(function(e,t){return[e,n[t]]}))});r={all:{},part:{},raw:a={name:"電影票房資訊",head:t,body:n}};n.map(function(e){e["起計日"]=e["src-year"]+"/"+e["src-date"].substring(0,2)+"/"+e["src-date"].substring(2);e["迄計日"]=e["des-year"]+"/"+e["des-date"].substring(0,2)+"/"+e["des-date"].substring(2);e["來源"]=in$("中華民國",e["國別地區"])?"國內":"國外";e["中文片名"]=e["中文片名"].replace(/ /g,"");return e["申請人"]=e["申請人"].replace(/ /g,"")});x.dates.list=Array.from(new Set(n.map(function(e){return e["迄計日"]})));x.dates.list=j(x.dates.list);x.dates.picked.end=(i=x.dates.list)[i.length-1];l=new Date(x.dates.picked.end).getTime()-864e5*182;x.dates.picked.start=x.dates.list.filter(function(e){return new Date(e).getTime()>=l})[0]||(i=x.dates.list)[i.length-1];o.call(r.all,a);o.call(r.part,a);return app.fetch.movie._data=r})};this.mb.addDashboard("movie-tw",l={csv:x.csv,ctrl:function(){return{dates:x.dates}},sheet:x.sheet,select:function(e){n.ldcv["movie-single"].toggle();x.selected=e;return n.mbMovie.init().then(function(){var e;e=n.mbMovie.board("movie-single");e._data=null;return n.mbMovie.toggle("movie-single")})},filter:e,data:app.fetch.movie,grid:{col:["1fr","1fr","1fr","2fr","1fr","2fr"],row:["2fr","2fr","2fr","2fr"]},panels:[{row:[1,1],col:[1,1],name:"國片總上映數",class:["highlight","color","color-film"]},{row:[1,1],col:[2,1],name:"國片票房總金額",class:["highlight","color","color-revenue"]},{row:[1,1],col:[3,1],name:"國片總售票數",class:["highlight","color","color-ticket"]},{row:[1,1],col:[4,2],name:"國片當週銷售走勢"},{row:[2,1],col:[5,2],name:"國片與外片逐週銷售比例"},{row:[3,2],col:[5,2],name:"出品人比例"},{row:[2,3],col:[3,2],name:"國片銷售排行與票房佔比",title:"國片銷售排行與票房佔比(依累計票房)"},{row:[2,1],col:[1,2],name:"國片累計銷售金額分布"},{row:[3,1],col:[1,2],name:"國片累計銷售票數分布"},{row:[4,1],col:[1,2],name:"國片上映院數分布"}]});t={};s=import$({},this.config);s.xaxis={enabled:true,caption:{show:false},baseline:{show:true},tick:{inner:8,color:"currentColor"},label:{format:".2~s"}};s.yaxis={enabled:true,caption:{show:false},baseline:{show:true},tick:{inner:8,color:"currentColor",boundaryOffset:false,count:3},label:{format:".2~s"}};t["國片銷售排行與票房佔比"]=function(){return{def:{name:"percent-list"},obj:function(e){var t,n;t=e.data;n={line:"#fff",collapse:{enabled:true,method:"count",threshold:15}};return{data:{raw:t.part.movie.tw,binding:{name:{key:"中文片名"},value:{key:"累計銷售金額"}}},config:[n,s]}}}};t["國片累計銷售金額分布"]=function(){return{def:{name:"bar"},obj:function(e){var n,t,r,a,i;n=e.data,t=e.filter;r=n.all.binned.tw.revenue.map(function(t){var e;e=n.part.binned.tw.revenue.filter(function(e){return e.x0>=t.x0&&e.x0<t.x1})[0]||[];return{excluded:t.length-e.length,picked:e.length,name:t.x1+""}});a=s.palette.colors[0];i={yaxis:{enabled:true,label:{format:".2~s",color:"currentColor"},tick:{count:3,inner:8,color:"currentColor"},baseline:{show:true}},dancing:false,legend:{enabled:false},palette:{colors:[ldcolor.darker(a,5),a]}};return{data:{raw:r,binding:{size:[{key:"picked",name:"銷售金額"},{key:"excluded",name:"銷售金額"}],name:{key:"name",filter:(t||{}).name}}},config:[i,s]}}}};t["國片累計銷售票數分布"]=function(e){return{def:{name:"bar"},obj:function(e){var n,t,r,a;n=e.data;t=n.all.binned.tw.ticket.map(function(t){var e;e=n.part.binned.tw.ticket.filter(function(e){return e.x0>=t.x0&&e.x0<t.x1})[0]||[];return{excluded:t.length-e.length,picked:e.length,name:t.x1+"",start:t.x1,end:t.x2}});r=s.palette.colors[1];a={dancing:false,legend:{enabled:false},palette:{colors:[ldcolor.darker(r,5),r]}};return{data:{raw:t,binding:{size:[{key:"picked",name:"銷售票數"},{key:"excluded",name:"銷售票數"}],name:{key:"name"}}},config:[a,s]}}}};t["國片上映院數分布"]=function(){return{def:{name:"bar"},obj:function(e){var n,t,r,a;n=e.data;t=n.all.binned.tw.theatre.map(function(t){var e;e=n.part.binned.tw.theatre.filter(function(e){return e.x0>=t.x0&&e.x0<t.x1})[0]||[];return{excluded:t.length-e.length,picked:e.length,name:t.x1+""}});r=s.palette.colors[2];a={dancing:false,legend:{enabled:false},palette:{colors:[ldcolor.darker(r,5),r]}};return{data:{raw:t,binding:{size:[{key:"picked",name:"上映院數"},{key:"excluded",name:"上映院數"}],name:{key:"name"}}},config:[a,s]}}}};t["出品人比例"]=function(){return{def:{name:"bar-list"},obj:function(e){var t,n,r,a;t=e.data;n={};t.part.movie.tw.map(function(e){return(e["出品"]||[]).map(function(e){return n[e]=(n[e]||0)+1})});return{data:{raw:function(){var e,t=[];for(r in e=n){a=e[r];t.push({"出品人":r,"數量":a})}return t}(),binding:{name:{key:"出品人"},size:{key:"數量",unit:"部"}}},config:[s]}}}};t["國片總上映數"]=function(){return{def:{name:"number"},obj:function(e){var t;t=e.data;return{data:{raw:[{value:t.part.movie.tw.length,number:"國片總上映數"}],binding:{value:{key:"value",unit:"部"},name:{key:"name"}}},config:[s]}}}};t["國片票房總金額"]=function(){return{def:{name:"number"},obj:function(e){var t;t=e.data;return{data:{raw:[{value:Math.round(t.part.total.tw.revenue/1e6),number:"累計銷售金額"}],binding:{value:{key:"value",unit:"百萬新臺幣"},name:{key:"name"}}},config:[s]}}}};t["國片總售票數"]=function(){return{def:{name:"number"},obj:function(e){var t;t=e.data;return{data:{raw:[{value:Math.round(t.part.total.tw.ticket/1e6),number:"總銷售票數"}],binding:{value:{key:"value",unit:"百萬張"},name:{key:"name"}}},config:[s]}}}};t["國片當週銷售走勢"]=function(){return{def:{name:"line"},obj:function(e){var t,n,r,a,i,l,o;t=e.data;n={dot:{size:1.5},legend:{enabled:false}};a=[];for(i in l=t.part.date.revenue){o=l[i];a.push(o)}r=a;r.sort(function(e,t){if(e.date>t.date){return 1}else if(e.date<t.date){return-1}else{return 0}});r.map(function(e){var t;t=e.date.split("/");return e.dateText=t[0]+"\n"+t[1]+"/"+t[2]});return{data:{raw:r,binding:{value:[{key:"tw",name:"票房",unit:"元"}],order:{key:"dateText",name:"日期"}}},config:[n,s]}}}};t["國片與外片逐週銷售比例"]=function(){return{def:{name:"bar"},obj:function(e){var t,n,r,a,i,l,o,u;t=e.data;n=s.palette.colors[0];r={percent:true,yaxis:{enabled:false},brush:{enabled:false},palette:{colors:[n,ldcolor.web(ldcolor.complement(n))]}};i=[];for(l in o=t.part.date.revenue){u=o[l];i.push(u)}a=i;a.sort(function(e,t){if(e.date>t.date){return 1}else if(e.date<t.date){return-1}else{return 0}});a.map(function(e,t){var n;e.idx=t;n=e.date.split("/");return e.dateText=n[0]+"\n"+n[1]+"/"+n[2]});return{data:{raw:a,binding:{size:[{key:"tw",name:"國內"},{key:"other",name:"國外"}],name:{key:"dateText",name:"日期"}}},config:[r,s]}}}};return l.panels.map(function(e){return e.chartdef=t[e.name]})});function in$(e,t){var n=-1,r=t.length>>>0;while(++n<r)if(e===t[n])return true;return false}function import$(e,t){var n={}.hasOwnProperty;for(var r in t)if(n.call(t,r))e[r]=t[r];return e}})();
(function() {(function(n){return n.apply(app)})(function(){var d,a,n,e,l;d=(app.category||(app.category={})).movie;a=new ldview({initRender:false,root:this.view.get("ldcv-movie-single"),text:{name:function(n){var e;e=n.ctx;return e.info["中文片名"]},date:function(n){var e;e=n.ctx;return e.info["上映日期"]},applicant:function(n){var e;e=n.ctx;return e.info["申請人"]}},handler:{publisher:{list:function(n){var e;e=n.ctx;return e.info["出品"]},key:function(n){return n},view:{text:{"@":function(n){var e;e=n.ctx;return e}}}}}});this.mbMovie.addDashboard("movie-single",n={csv:function(){return[]},ctrl:function(){return{dates:{}}},data:function(n){return app.fetch.movie(n).then(function(n){var e,t;e=n.part.body.filter(function(n){return n["中文片名"]===d.selected.data[0].data["中文片名"]});t={list:e,info:d.selected.data[0].data};a.ctx(t);a.render();return t})},grid:{col:["1fr","1fr","1fr","4fr"],row:["1fr","1fr"]},panels:[{row:[2,1],col:[1,1],name:"累計票房金額"},{row:[2,1],col:[2,1],name:"累計售票數"},{row:[2,1],col:[3,1],name:"期間最高上映院數"},{row:[2,1],col:[4,1],name:"逐週銷售走勢"}]});e={};l=import$({},this.config);e["累計票房金額"]=function(){return{def:{name:"number"},obj:function(n){var e,t;e=n.data;t=Math.round(Math.max.apply(Math,e.list.map(function(n){return n["累計銷售金額"]/1e3})));return{data:{raw:[{value:t,number:"銷售金額"}],binding:{value:{key:"value",unit:"千新臺幣"},name:{key:"name"}}},config:[l]}}}};e["累計售票數"]=function(){return{def:{name:"number"},obj:function(n){var e,t;e=n.data;t=Math.round(Math.max.apply(Math,e.list.map(function(n){return n["累計銷售票數"]})));return{data:{raw:[{value:t,number:"銷售票數"}],binding:{value:{key:"value",unit:"張"},name:{key:"name"}}},config:[l]}}}};e["期間最高上映院數"]=function(){return{def:{name:"number"},obj:function(n){var e,t;e=n.data;t=Math.round(Math.max.apply(Math,e.list.map(function(n){return n["上映院數"]})));return{data:{raw:[{value:t,number:"上映院數"}],binding:{value:{key:"value",unit:"間"},name:{key:"name"}}},config:[l]}}}};e["逐週銷售走勢"]=function(){return{def:{name:"line"},obj:function(n){var e,t,a,r,i,u,o,f,c;e=n.data;t={dot:{size:1.5},legend:{enabled:false}};a=d.dates;r=a.picked.start||a.list[0];i=a.picked.end||(u=a.list)[u.length-1];o=d.dates.list.filter(function(n){return n>=r&&n<=i});f={};e.list.map(function(n){var e,t,a;e=n["迄計日"];t=n["銷售金額"];a=f[e]||(f[e]={});a.date=e;return a.value=t});c=o.map(function(n){return f[n]||{date:n,value:0}});c.sort(function(n,e){if(n.date>e.date){return 1}else if(n.date<e.date){return-1}else{return 0}});c.map(function(n){var e;e=n.date.split("/");return n.dateText=e[0]+"\n"+e[1]+"/"+e[2]});return{data:{raw:c,binding:{value:[{key:"value",name:"票房",unit:"元"}],order:{key:"dateText",name:"日期"}}},config:[t,l]}}}};return n.panels.map(function(n){return n.chartdef=e[n.name]})});function import$(n,e){var t={}.hasOwnProperty;for(var a in e)if(t.call(e,a))n[a]=e[a];return n}})();
(function() {(function(e){return e.apply(app)})(function(){var a,e,r,n,l;a=(app.category||(app.category={})).movie;e=function(){return r.data().then(function(e){var n;n=Object.fromEntries(r.panels.map(function(e){return[e.id||e.name,e.filter]}));a.parse.call(e.all,e.raw);return a.parse.call(e.part,e.raw,n)})};this.mb.addDashboard("movie-all",r={csv:a.csv,sheet:a.sheet,filter:e,data:app.fetch.movie,grid:{col:["1fr","1fr","1fr","2fr","1fr","2fr"],row:["2fr","1fr","1fr","1fr","1fr","1fr","1fr"]},panels:[{row:[1,1],col:[1,1],name:"電影總上映數",class:["highlight","color","color-film"]},{row:[1,1],col:[2,1],name:"電影票房總金額",class:["highlight","color","color-revenue"]},{row:[1,1],col:[3,1],name:"電影總售票數",class:["highlight","color","color-ticket"]},{row:[1,1],col:[4,2],name:"電影當週銷售走勢"},{row:[2,2],col:[1,2],name:"電影累計銷售金額分布"},{row:[4,2],col:[1,2],name:"電影累計銷售票數分布"},{row:[6,2],col:[1,2],name:"電影上映院數分布"},{row:[2,6],col:[3,2],name:"上映電影之來源國家比較"},{row:[2,3],col:[5,2],name:"上映之各國電影數量"},{row:[5,3],col:[5,2],name:"各國銷售金額合計"}]});n={};l=import$({},this.config);l.xaxis={enabled:true,caption:{show:false},baseline:{show:true},tick:{inner:8,color:"currentColor"}};l.yaxis={enabled:true,caption:{show:false},baseline:{show:true},tick:{inner:8,color:"currentColor",count:3,boundaryOffset:false},label:{format:d3.format(".2s")}};n["電影總上映數"]=function(){return{def:{name:"number"},obj:function(e){var n;n=e.data;return{config:l,data:{raw:[{value:n.part.movie.all.length,number:"電影總上映數"}],binding:{value:{key:"value",unit:"部"},name:{key:"name"}}}}}}};n["電影票房總金額"]=function(){return{def:{name:"number"},obj:function(e){var n;n=e.data;return{config:l,data:{raw:[{value:Math.round(n.part.total.all.revenue/1e6),number:"累計銷售金額"}],binding:{value:{key:"value",unit:"百萬新臺幣"},name:{key:"name"}}}}}}};n["電影總售票數"]=function(){return{def:{name:"number"},obj:function(e){var n;n=e.data;return{config:l,data:{raw:[{value:Math.round(n.part.total.all.ticket/1e6),number:"總銷售票數"}],binding:{value:{key:"value",unit:"百萬張"},name:{key:"name"}}}}}}};n["電影當週銷售走勢"]=function(){return{def:{name:"line"},obj:function(e){var n,a,r,t,o,l;n=e.data;r=[];for(t in o=n.part.date.revenue){l=o[t];r.push(l)}a=r;a.sort(function(e,n){if(e.date>n.date){return 1}else if(e.date<n.date){return-1}else{return 0}});a.map(function(e){var n;n=e.date.split("/");return e.dateText=n[0]+"\n"+n[1]+"/"+n[2]});return{config:{dot:{size:1.5},legend:{enabled:false}},data:{raw:a,binding:{value:[{key:"all",name:"票房",unit:"元"}],order:{key:"dateText",name:"日期"}}}}}}};n["電影累計銷售金額分布"]=function(){return{def:{name:"bar"},obj:function(e){var a,n,r,t;a=e.data;n=a.all.binned.all.revenue.map(function(n){var e;e=a.part.binned.all.revenue.filter(function(e){return e.x0>=n.x0&&e.x0<n.x1})[0]||[];return{excluded:n.length-e.length,picked:e.length,name:n.x1+""}});r=l.palette.colors[0];t={dancing:false,legend:{enabled:false},palette:{colors:[ldcolor.darker(r,5),r]}};return{data:{raw:n,binding:{size:[{key:"picked",name:"銷售金額"},{key:"excluded",name:"銷售金額"}],name:{key:"name"}}},config:[t,l]}}}};n["電影累計銷售票數分布"]=function(){return{def:{name:"bar"},obj:function(e){var a,n,r,t;a=e.data;n=a.all.binned.all.ticket.map(function(n){var e;e=a.part.binned.all.ticket.filter(function(e){return e.x0>=n.x0&&e.x0<n.x1})[0]||[];return{excluded:n.length-e.length,picked:e.length,name:n.x1+""}});r=l.palette.colors[1];t={dancing:false,legend:{enabled:false},palette:{colors:[ldcolor.darker(r,5),r]}};return{data:{raw:n,binding:{size:[{key:"picked",name:"銷售票數"},{key:"excluded",name:"銷售票數"}],name:{key:"name"}}},config:[t,l]}}}};n["電影上映院數分布"]=function(){return{def:{name:"bar"},obj:function(e){var a,n,r,t;a=e.data;n=a.all.binned.all.theatre.map(function(n){var e;e=a.part.binned.all.theatre.filter(function(e){return e.x0>=n.x0&&e.x0<n.x1})[0]||[];return{excluded:n.length-e.length,picked:e.length,name:n.x1+""}});r=l.palette.colors[2];t={dancing:false,legend:{enabled:false},palette:{colors:[ldcolor.darker(r,5),r]}};return{data:{raw:n,binding:{size:[{key:"picked",name:"上映院數"},{key:"excluded",name:"上映院數"}],name:{key:"name"}}},config:[t,l]}}}};n["上映之各國電影數量"]=function(){return{def:{name:"worldmap"},obj:function(e){var a,n,r,t;a=e.data;n={palette:{colors:["#444","#e8c05c","#6ee97d","#577aeb"]},legendFormat:".0~s",dimEmpty:true};return{data:{raw:function(){var e,n=[];for(r in e=a.part.movie.byCountry){t=e[r];n.push({name:r,value:t.length})}return n}(),binding:{color:{key:"value",unit:"部"},name:{key:"name"}}},config:[n,l]}}}};n["上映電影之來源國家比較"]=function(){return{def:{name:"bubble"},obj:function(e){var a,n,r,t;a=e.data;n={legend:{enabled:false}};return{data:{raw:function(){var e,n=[];for(r in e=a.part.movie.byCountry){t=e[r];n.push({name:r,value:t.length})}return n}(),binding:{name:{key:"name"},area:[{key:"value",unit:"部"}],color:{key:"name"}}},config:[n,l]}}}};n["各國銷售金額合計"]=function(){return{def:{name:"treemap"},obj:function(e){var r,n,t,o;r=e.data;n={legend:{enabled:true,selectable:false}};return{data:{raw:function(){var e,n=[];for(t in e=r.part.movie.byCountry){o=e[t];n.push({name:t,value:o.reduce(a,0),category:r.part.movie.continentmap[t]})}return n;function a(e,n){return e+n["累計銷售金額"]/1e6}}(),binding:{name:{key:"name"},area:{key:"value",unit:"百萬新臺幣"},category:{key:"category"}}},config:[n,l]}}}};return r.panels.map(function(e){return e.chartdef=n[e.name]})});function import$(e,n){var a={}.hasOwnProperty;for(var r in n)if(a.call(n,r))e[r]=n[r];return e}})();
app.init();</script></body></html>