{"version":3,"file":"gridjs-selection.development.js","sources":["../src/rowSelection/store.ts","../src/rowSelection/actions.ts","../src/rowSelection/rowSelection.tsx"],"sourcesContent":["import { BaseStore } from 'gridjs';\nimport { RowSelectionActionsType } from './actions';\n\nexport type RowSelectionStoreState = {\n  rowIds: string[];\n};\n\nexport class RowSelectionStore extends BaseStore<\n  RowSelectionStoreState,\n  RowSelectionActionsType\n> {\n  getInitialState(): RowSelectionStoreState {\n    return { rowIds: [] };\n  }\n\n  handle(type, payload): void {\n    if (type === 'CHECK') {\n      const { ROW_ID } = payload;\n      this.check(ROW_ID);\n    }\n\n    if (type === 'UNCHECK') {\n      const { ROW_ID } = payload;\n      this.uncheck(ROW_ID);\n    }\n  }\n\n  private check(rowId: string): void {\n    // rowId already exists\n    if (this.state.rowIds.indexOf(rowId) > -1) return;\n\n    this.setState({\n      rowIds: [rowId, ...this.state.rowIds],\n    });\n  }\n\n  private uncheck(rowId: string): void {\n    const index = this.state.rowIds.indexOf(rowId);\n\n    // rowId doesn't exist\n    if (index === -1) return;\n\n    const cloned = [...this.state.rowIds];\n    cloned.splice(index, 1);\n\n    this.setState({\n      rowIds: cloned,\n    });\n  }\n}\n","import { BaseActions } from 'gridjs';\n\nexport interface RowSelectionActionsType {\n  CHECK: {\n    ROW_ID: string;\n  };\n\n  UNCHECK: {\n    ROW_ID: string;\n  };\n}\n\nexport class RowSelectionActions extends BaseActions<RowSelectionActionsType> {\n  check(rowId: string): void {\n    this.dispatch('CHECK', {\n      ROW_ID: rowId,\n    });\n  }\n\n  uncheck(rowId: string): void {\n    this.dispatch('UNCHECK', {\n      ROW_ID: rowId,\n    });\n  }\n}\n","import { h } from 'gridjs';\nimport { RowSelectionStore, RowSelectionStoreState } from './store';\nimport { RowSelectionActions } from './actions';\nimport { className } from 'gridjs';\nimport { Row } from 'gridjs';\nimport { PluginBaseComponent, PluginBaseProps } from 'gridjs';\nimport { Cell } from 'gridjs';\n\ninterface RowSelectionState {\n  isChecked: boolean;\n}\n\ninterface RowSelectionProps {\n  // row identifier\n  id: (row: Row) => string;\n  // it's optional because thead doesn't have a row\n  row?: Row;\n  cell?: Cell;\n  store?: RowSelectionStore;\n  selectedClassName?: string;\n  checkboxClassName?: string;\n}\n\nexport class RowSelection extends PluginBaseComponent<\n  RowSelectionProps & PluginBaseProps<RowSelection>,\n  RowSelectionState\n> {\n  private readonly actions: RowSelectionActions;\n  private readonly store: RowSelectionStore;\n  private readonly storeUpdatedFn: (...args) => void;\n\n  private isDataCell = (props): boolean => props.row !== undefined;\n  private getParentTR = (): Element =>\n    this.base &&\n    this.base.parentElement &&\n    (this.base.parentElement.parentElement as Element);\n\n  static defaultProps = {\n    selectedClassName: className('tr', 'selected'),\n    checkboxClassName: className('checkbox'),\n  };\n\n  constructor(\n    props: RowSelectionProps & PluginBaseProps<RowSelection>,\n    context,\n  ) {\n    super(props, context);\n\n    this.state = {\n      isChecked: false,\n    };\n\n    // store/dispatcher is required only if we are rendering a TD (not a TH)\n    if (this.isDataCell(props)) {\n      // create a new store if a global store doesn't exist\n      if (!props.store) {\n        const store = new RowSelectionStore(this.config.dispatcher);\n        this.store = store;\n\n        // to reuse for other checkboxes\n        props.plugin.props.store = store;\n      } else {\n        // restore the existing store\n        this.store = props.store;\n      }\n\n      this.actions = new RowSelectionActions(this.config.dispatcher);\n      this.storeUpdatedFn = this.storeUpdated.bind(this);\n      this.store.on('updated', this.storeUpdatedFn);\n\n      // also mark this checkbox as checked if cell.data is true\n      if (props.cell.data) {\n        this.check();\n      }\n    }\n  }\n\n  componentWillUnmount(): void {\n    this.store.off('updated', this.storeUpdatedFn);\n  }\n\n  componentDidMount(): void {\n    if (this.store) this.storeUpdated(this.store.state);\n  }\n\n  private storeUpdated(state: RowSelectionStoreState): void {\n    const parent = this.getParentTR();\n\n    if (!parent) return;\n\n    const isChecked = state.rowIds.indexOf(this.props.id(this.props.row)) > -1;\n\n    this.setState({\n      isChecked: isChecked,\n    });\n\n    if (isChecked) {\n      parent.classList.add(this.props.selectedClassName);\n    } else {\n      parent.classList.remove(this.props.selectedClassName);\n    }\n  }\n\n  private check(): void {\n    this.actions.check(this.props.id(this.props.row));\n    this.props.cell.update(true);\n  }\n\n  private uncheck(): void {\n    this.actions.uncheck(this.props.id(this.props.row));\n    this.props.cell.update(false);\n  }\n\n  private toggle(): void {\n    if (this.state.isChecked) {\n      this.uncheck();\n    } else {\n      this.check();\n    }\n  }\n\n  render() {\n    if (this.isDataCell(this.props)) {\n      return (\n        <input\n          type={'checkbox'}\n          checked={this.state.isChecked}\n          onChange={() => this.toggle()}\n          className={this.props.checkboxClassName}\n        />\n      );\n    }\n\n    return null;\n  }\n}\n"],"names":["BaseStore","BaseActions","h","className","PluginBaseComponent"],"mappings":"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"}