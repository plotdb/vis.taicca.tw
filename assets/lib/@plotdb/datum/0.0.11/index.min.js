!function(){var k;function w(n,t){for(var r=-1,e=t.length>>>0;++r<e;)if(n===t[r])return!0;return!1}function C(n,t){var r,e={}.hasOwnProperty;for(r in t)e.call(t,r)&&(n[r]=t[r]);return n}k={_sep:"-",format:function(n){return!n||!Array.isArray(n)||n[0]&&!Array.isArray(n[0])?"db":"sheet"},asSheet:function(r){var t;return"sheet"===this.format(r)?r:[(r=Array.isArray(r)?{head:function(){var n=[];for(t in r[0])n.push(t);return n}(),body:r}:r).head].concat(r.body.map(function(t){return r.head.map(function(n){return t[n]})}))},asDb:function(t,n){var r;return null==n&&(n="unnamed"),"sheet"===this.format(t)?{name:n,head:t[0],body:t.slice(1).map(function(r){return Object.fromEntries(t[0].map(function(n,t){return[n,r[t]]}))})}:Array.isArray(t)?{name:n,head:function(){var n=[];for(r in t[0])n.push(r);return n}(),body:t}:(t.name||(t.name="unnamed"),t)},concat:function(n){var r,t,e,u,i;for(n=n.map(function(n){return data.asDb(n)}),r=n[0].head,t=[],e=0,u=n.length;e<u;++e)i=e,t=t.concat(n[i].body.map(a));return{name:n[0].name,head:r,body:t};function a(t){return Object.fromEntries(r.map(function(n){return[n,t[n]]}))}},_joinAll:function(r){var e,n,a,t,u,i,o,f,c,s,p,l,m,d,h,y,b,v,g,O,S,N,j;for(null==r&&(r={}),e=this._sep,n=r.ds,a=r.joinCols,n=n.map(function(n){return k.asDb(n)}),t=n.map(function(n){return n.head}),u=n.map(function(n){return n.body}),i=n.map(function(n){return{unit:n.unit,mag:n.mag,type:n.type}}),f=(o=n.map(function(n,t){return n.name||t+1+""})).map(function(n){return n.split(e)}),c=-1,p=f[s=0].length;s<p;++s){for(l=s,m=1,d=f.length;m<d;++m)if(f[m][l]!==f[0][l]){c=l;break}if(0<=c)break}for(y in o=c<0?n.map(function(n,t){return t+1+""}):f.map(function(n){return n.slice(c).join(e)}),h={},t.map(function(n){return n.map(function(n){return h[n]=(h[n]||0)+1})}),a=a||function(){var n=[];for(y in t)n.push(y);return n}().filter(function(n){return t[n]===t.length}),b=function(n,t){return r.simpleHead?n:1<h[t]?n+""+e+t:t},v=t.map(function(n,t){return Object.fromEntries(n.map(function(n){return[n,w(n,a)?n:b(o[t],n)]}))}),g=t.map(function(n,t){return n.filter(function(n){return!w(n,a)}).map(function(n){return b(o[t],n)})}),g=[a].concat(g).reduce(function(n,t){return n.concat(t)},[]),O={},u.map(function(n,i){return n.map(function(t){var n,r,e={},u=JSON.stringify(Object.fromEntries(a.map(function(n){return[n,t[n]]})));for(n in t)r=t[n],e[v[i][n]]=r;return(O[u]||(O[u]=[])).push(e)})}),S=[],O)N=O[y],S.push(N.reduce(A,{}));return j={mag:{},unit:{},type:{}},i.map(function(i,a){return["mag","unit","type"].map(function(n){var t,r,e,u=[];if(i[n]){for(t in r=i[n])e=r[t],u.push(j[n][v[a][t]]=e);return u}})}),C({name:n[0].name||"unnamed",head:g,body:S},j);function A(n,t){return C(n,t)}},join:function(n){var e,u,r,i,a,t,o,f,c,s,p,l,m,d,h,y=(n=null==n?{}:n).d1,b=n.d2,v=n.joinCols;if(n.ds)return this._joinAll(n);for(e=n.simpleHead?function(n,t){return n}:function(n,t){return n+""+r+t},u=v,r=this._sep,y=(n=[y,b].map(function(n){return k.asDb(n)}))[0],b=n[1],n=[y.head,b.head],i=n[0],a=n[1],v=(n=[y.body,b.body])[0],t=n[1],n=[y.name||"1",b.name||"2"],o=n[0],f=n[1],c=o.split(r),s=f.split(r),p=0,l=c.length;p<l&&c[m=p]===s[m];++p);return n=[c.slice(m).join(r),s.slice(m).join(r)],o=n[0],f=n[1],u=u||i.filter(function(n){return~a.indexOf(n)}),d=[u.map(function(n){return[n,n]}).concat(i.filter(function(n){return!w(n,u)}).map(function(n){return[n,w(n,a)?e(o,n):n]})),a.filter(function(n){return!w(n,u)}).map(function(n){return[n,w(n,i)?e(f,n):n]})],h={},["mag","unit","type"].map(function(t){if(h[t]={},y[t]&&d[0].map(function(n){return h[t][n[1]]=y[t][n[0]]}),b[t])return d[1].map(function(n){return h[t][n[1]]=b[t][n[0]]})}),d=d[0].concat(d[1]).map(function(n){return n[1]}),v=v.map(function(r){var n=t.filter(function(t){return!u.filter(function(n){return t[n]!==r[n]}).length});return(n=!n.length?[{}]:n).map(function(t){return Object.fromEntries(u.map(function(n){return[n,r[n]]}).concat(i.filter(function(n){return!w(n,u)}).map(function(n){return[w(n,a)?e(o,n):n,r[n]]}),a.filter(function(n){return!w(n,u)}).map(function(n){return[w(n,i)?e(f,n):n,t[n]]})))})}).reduce(function(n,t){return n.concat(t)},[]),C({name:y.name||"unnamed",head:d,body:v},h)},split:function(n){var t,r,e,u,i,a,o=n.data,f=n.col;if(o=this.asDb(o),!~(n=(t=[].concat(o.head)).indexOf(f)))return o;for(i in t.splice(n,1),r={},["mag","unit","type"].map(function(n){var t;return r[n]=C({},o[n]),n=(t=r[n])[f],delete t[f],n}),e={},o.body.filter(function(n){var t;return(e[t=n[f]]||(e[t]=[])).push(n)}),u=[],e)a=e[i],u.push(C({name:(o.name||"unnamed")+""+this._sep+i,head:t,body:a},JSON.parse(JSON.stringify(r))));return u},pivot:function(n){var t=this,r=(n=null==n?{}:n).data,e=n.col,u=n.joinCols;return null==(n=n.simpleHead)&&(n=!1),r=(r=this.split({data:r,col:e})).map(function(n){return t.shrink({data:n,cols:n.head.filter(function(n){return n!==e})})}),this.join({ds:r,joinCols:u,simpleHead:n})},unpivot:function(n){var t,u,i=(n=null==n?{}:n).data,a=n.cols,o=n.name,f=n.order;return o=o||"item",null==f&&(f=0),t=this._sep,i=this.asDb(i),u=i.head.filter(function(n){return!w(n,a)}).map(function(n){return n.split(t)}),n=Array.from(new Set(u.map(function(n){return n[f]}))).map(function(r){var n=a.map(function(n){return[n,n]}),e=u.filter(function(n){return n[f]===r}).map(function(n){return[n.join(t),n.filter(function(n,t){return t!==f}).join(t)]});return{name:i.name,head:a.concat([o],e.map(function(n){return n[1]})),body:i.body.map(function(t){return Object.fromEntries([[o,r]].concat(n.concat(e).map(function(n){return[n[1],t[n[0]]]})))})}}),this.concat(n)},group:function(n){var u,a,t,r,i=(n=null==n?{}:n).data,o=n.cols,f=n.aggregator,c=n.groupFunc;for(r in f=f||{},o=Array.isArray(o)?o:[o],i=this.asDb(i),u=i.head.filter(function(n){return!w(n,o)&&null!==f[n]}),n=Array.from(new Set(i.body.map(function(t){return JSON.stringify(Object.fromEntries(o.map(function(n){return[n,t[n]]})))}))),a={},n.map(function(t){var n,r,e,u,i=JSON.parse(t);if("function"==typeof c)n=c(i);else for(e in r=c||{},n={},i)u=i[e],n[e]="function"==typeof r[e]?r[e](u):u;return(Array.isArray(n)?n:[n]).map(function(n){return n=JSON.stringify(n),a[n]||(a[n]=new Set),a[n].add(t)})}),t=[],a)t.push(r);return n=t.map(function(t){var r,e=Array.from(a[t]);return t=JSON.parse(t),e=e.map(function(r){return r=JSON.parse(r),i.body.filter(function(t){return 0===o.filter(function(n){return t[n]!==r[n]}).length})}).reduce(function(n,t){return n.concat(t)},[]),r=Object.fromEntries(u.map(function(t){var n=e.map(function(n){return n[t]}),n=f[t]?f[t](n):n.length;return[t,n]})),o.map(function(n){return r[n]=t[n]}),r}),{head:o.concat(u),body:n,name:i.name}},agg:{average:function(n){return n.reduce(function(n,t){return n+(isNaN(+t)?0:+t)},0)/(n.length||1)},sum:function(n){return n.reduce(function(n,t){return n+(isNaN(+t)?0:+t)},0)},count:function(n){return n.length},first:function(n){return n[0]||""}},shrink:function(n){var r=n.data,t=n.cols;return(r=this.asDb(r)).head=r.head.filter(function(n){return w(n,t)}),r.body=r.body.map(function(t){return Object.fromEntries(r.head.map(function(n){return[n,t[n]]}))}),["unit","mag","type"].filter(function(n){return r[n]}).map(function(t){return r[t]=Object.fromEntries(r.head.map(function(n){return[n,r[t][n]]}))}),r},rename:function(n){var e=n.data,u=n.map;return(e=this.asDb(e)).body=e.body.map(function(r){return Object.fromEntries(e.head.map(function(n){var t;return[(t=u[n])?t:n,r[n]]}))}),["unit","mag","type"].filter(function(n){return e[n]}).map(function(t){return e[t]=Object.fromEntries(e.head.map(function(n){return[u[n]||n,e[t][n]]}))}),e.head=e.head.map(function(n){var t;return(t=u[n])?t:n}),e}},"undefined"!=typeof module&&null!==module?module.exports=k:"undefined"!=typeof window&&null!==window&&(window.datum=k),k.type={R:function(n){var t=(t=(n=null==n?{}:n).data.filter(function(n){return!(!n||""===(n+"").trim())})).filter(function(n){return!isNaN(parseFloat(n))}).length/t.length;return t=(n=k.type.O(n))===t||.9<n?.99*n:t},O:function(n){var t,r,e,u,i,a,o;for((t=[].concat((n=null==n?{}:n).data)).sort(function(n,t){return t-n}),r={},e=1,u=t.length;e<u;++e)i=e,isNaN(t[i])||isNaN(t[i-1])?r[t[i]>t[i-1]?t[i]+":"+t[i-1]:t[i-1]+":"+t[i]]=!0:a=t[i]-t[i-1],r[a]=!0;return 1/(function(){var n=[];for(o in r)n.push(o);return n}().filter(function(n){return"0"!==n}).length||2)},N:function(n){var t=1-k.type.R(n=null==n?{}:n);return t=.85<(n=k.type.C(n))?.99*n:t},C:function(n){var t;return null==n&&(n={}),t=(t=0<(t=1-(0<(t=Array.from(new Set(n.data)).length-2)?t:0)/(t=n.data.length)-1/t)?t:0)<1?t:1,k.type.R(n)&&(t*=.9),t},get:function(n){for(var t,r,e,n=k.asDb(n),u=n.head,i=n.body,a=[],o=0,f=u.length;o<f;++o)t=u[o],r=i.map(c),(e=["R","O","N","C"].map(s)).sort(p),a.push({key:t,types:Object.fromEntries(e),type:e[0][0]});return a;function c(n){return n[t]}function s(n){return[n,k.type[n]({data:r})]}function p(n,t){return t[1]-n[1]}},bind:function(r,e,n){var t,u,i,a,o,f,c,s,p,l,m,d,h,y;for(null==r&&(r=[]),null==e&&(e={}),n=n||k.type.get(r),(t=function(){var n,t=[];for(u in n=e)i=n[u],t.push({k:u,v:i});return t}().filter(function(n){return!n.v.passive})).sort(function(n,t){var r=(n.v.priority||100)-(t.v.priority||100);return 0!=r?r:(t=[n.v.type||"R",t.v.type||"R"].map(function(e){return Math.min.apply(Math,function(){for(var n=[],t=0,r=e.length;t<r;++t)n.push(t);return n}().map(function(n){return"CONRI".indexOf(e[n])}))}))[0]-t[1]}),a=0,o=t.length;a<o;++a)for((f=t[a]).bind=null,s=0,p=(c=f.v.type||"RINOC").length;s<p;++s){for(l=c[s],n.sort(b),m=0,d=n.length;m<d;++m)if(!(null==(h=n[m]).types[l]||h.types[l]<.5||h.used||"C"===l&&.5<h.types.R)){f.bind=f.v.multiple?[h]:h,h.used=!0;break}if(f.bind)break}for(a=0,o=t.length;a<o;++a)if((f=t[a]).v.multiple)for(s=0,p=(c=f.v.type||"RNOC").length;s<p;++s)for(l=c[s],n.sort(v),m=0,d=n.length;m<d;++m)null==(h=n[m]).types[l]||h.types[l]<.5||h.used||"C"===l&&.5<h.types.R||((f.bind||(f.bind=[])).push(h),h.used=!0);for(y={},a=0,o=t.length;a<o;++a)(f=t[a]).bind&&(y[f.k]=f.bind,(Array.isArray(f.bind)?f.bind:[f.bind]).map(g));return y;function b(n,t){var r=(t.types[l]||0)-(n.types[l]||0);return t.types[l]===n.types[l]&&"R"===l?(n.types.O||0)-(t.types.O||0):r}function v(n,t){var r=(t.types[l]||0)-(n.types[l]||0);return t.types[l]===n.types[l]&&"R"===l?(n.types.O||0)-(t.types.O||0):r}function g(n){var t;return r.unit&&(n.unit=r.unit[n.key]||""),t=n.used,delete n.used,t}}},k.sample={context:{},C:["books","business","education","entertainment","finance","food","games","health","lifestyle","medical","music","navigation","news","photography","productivity","social","network","sports","travel","utilities","weather"],N:["The Perfect Storm","Philadelphia Story","Planet of the Apes","Patton","Pocahontas","Pinoccio","Quills","Raiders of the Lost Ark","Romeo and Juliet","Snow White","Shine","Some Like It Hot","Stardust","Startrek","The Seven Year Itch","The Sound of Music","Sabrina","Sixth Sense","The Silence of the Lambs","Stargate","Sunset Boulevard","Superman"],generate:function(n){var u,t,r,e,i,a,o,f,c,s,p,l,m=n.count,d=n.binding,h=[{raw:[],binding:{}},0,m||10],y=h[0],b=h[1];for(t in m=h[2],u=u||{},d)r=d[t],e=(Array.isArray(r)?r:[r]).map(v),Array.isArray(r)?y.binding[t]=e.map(g):y.binding[t]={key:(h=u[e[0]]).key,name:h.name};for(i=Math.round(100*Math.random()),a=0;a<m;++a){for(t in o=a,f={},u)r=u[t],c=r.hint,s=function(){var n,t;switch(c.type){case"R":return p=c.range||[0,100],l=Math.random()*(p[1]-p[0])+p[0],p[1]-p[0]<1?l:Math.round(l);case"N":return k.sample.N[o%k.sample.N.length];case"C":return l=(n=null!=c.count?c.count:4<(n=Math.round(m/10))?n:4)<(t=k.sample.C.length)?n:t,k.sample.C[(c.random?Math.floor(Math.random()*m):o)%l];case"O":return Math.floor(o/(null!=c.repeat?c.repeat:1))+(null!=c.offset?c.offset:i);default:return"..."}}(),f[r.key]=s;y.raw.push(f)}return y;function v(n,t){var r=n.key||"field-"+b,e=n.name||r;return u[b]={key:r,name:e,hint:n},(b+=1)-1}function g(n){return{key:(n=u[n]).key,name:n.name}}}}}.call(this);
