(function(){function n(n,t){for(var r=-1,e=t.length>>>0;++r<e;)if(n===t[r])return!0;return!1}function t(n,t){var r={}.hasOwnProperty;for(var e in t)r.call(t,e)&&(n[e]=t[e]);return n}var r;r={_sep:"-",format:function(n){return!n||!Array.isArray(n)||n[0]&&!Array.isArray(n[0])?"db":"sheet"},asSheet:function(n){var t;return"sheet"===this.format(n)?n:(Array.isArray(n)&&(n={head:function(){var r=[];for(t in n[0])r.push(t);return r}(),body:n}),[n.head].concat(n.body.map(function(t){return n.head.map(function(n){return t[n]})})))},asDb:function(n,t){var r;return null==t&&(t="unnamed"),"sheet"===this.format(n)?{name:t,head:n[0],body:n.slice(1).map(function(t){return Object.fromEntries(n[0].map(function(n,r){return[n,t[r]]}))})}:Array.isArray(n)?{name:t,head:function(){var t=[];for(r in n[0])t.push(r);return t}(),body:n}:(n.name||(n.name="unnamed"),n)},concat:function(n){var t,r,e,u,a;for(n=n.map(function(n){return data.asDb(n)}),t=n[0].head,r=[],e=0,u=n.length;e<u;++e)a=e,r=r.concat(n[a].body.map(function(n){return Object.fromEntries(t.map(function(t){return[t,n[t]]}))}));return{name:n[0].name,head:t,body:r}},_joinAll:function(e){var u,a,i,o,f,c,s,p,l,m,d,h,y,b,v,g,O,S,N,j,A,k,w,C,R;for(null==e&&(e={}),u=this._sep,a=e.ds,i=e.joinCols,a=a.map(function(n){return r.asDb(n)}),o=a.map(function(n){return n.head}),f=a.map(function(n){return n.body}),c=a.map(function(n){return{unit:n.unit,mag:n.mag,type:n.type}}),p=(s=a.map(function(n,t){return n.name||t+1+""})).map(function(n){return n.split(u)}),l=-1,m=0,d=p[0].length;m<d;++m){for(h=m,y=1,b=p.length;y<b;++y)if(v=y,p[v][h]!==p[0][h]){l=h;break}if(l>=0)break}s=l<0?a.map(function(n,t){return t+1+""}):p.map(function(n){return n.slice(l).join(u)}),g={},o.map(function(n){return n.map(function(n){return g[n]=(g[n]||0)+1})}),i||(i=function(){var n=[];for(O in o)n.push(O);return n}().filter(function(n){return o[n]===o.length})),S=function(n,t){return e.simpleHead?n:g[t]>1?n+""+u+t:t},N=o.map(function(t,r){return Object.fromEntries(t.map(function(t){return[t,n(t,i)?t:S(s[r],t)]}))}),j=o.map(function(t,r){return t.filter(function(t){return!n(t,i)}).map(function(n){return S(s[r],n)})}),A=[i].concat(j).reduce(function(n,t){return n.concat(t)},[]),k={},f.map(function(n,t){return n.map(function(n){var r,e,u,a;r={},e=JSON.stringify(Object.fromEntries(i.map(function(t){return[t,n[t]]})));for(u in n)a=n[u],r[N[t][u]]=a;return(k[e]||(k[e]=[])).push(r)})}),w=[];for(O in k)C=k[O],w.push(C.reduce(function(n,r){return t(n,r)},{}));return R={mag:{},unit:{},type:{}},c.map(function(n,t){return["mag","unit","type"].map(function(r){var e,u,a,i=[];if(n[r]){for(e in u=n[r])a=u[e],i.push(R[r][N[t][e]]=a);return i}})}),t({name:a[0].name||"unnamed",head:A,body:w},R)},join:function(e){var u,a,i,o,f,c,s,p,l,m,d,h,y,b,v,g,O,S,N,j,A,k;if(null==e&&(e={}),u=e.d1,a=e.d2,i=e.joinCols,e.ds)return this._joinAll(e);for(o=e.simpleHead?function(n,t){return n}:function(n,t){return n+""+c+t},f=i,c=this._sep,s=[u,a].map(function(n){return r.asDb(n)}),u=s[0],a=s[1],s=[u.head,a.head],p=s[0],l=s[1],m=(s=[u.body,a.body])[0],d=s[1],s=[u.name||"1",a.name||"2"],h=s[0],y=s[1],b=h.split(c),v=y.split(c),g=0,O=b.length;g<O&&(S=g,b[S]===v[S]);++g);return s=[b.slice(S).join(c),v.slice(S).join(c)],h=s[0],y=s[1],f||(f=p.filter(function(n){return~l.indexOf(n)})),N=[f.map(function(n){return[n,n]}).concat(p.filter(function(t){return!n(t,f)}).map(function(t){return[t,n(t,l)?o(h,t):t]})),l.filter(function(t){return!n(t,f)}).map(function(t){return[t,n(t,p)?o(y,t):t]})],j={},["mag","unit","type"].map(function(n){if(j[n]={},u[n]&&N[0].map(function(t){return j[n][t[1]]=u[n][t[0]]}),a[n])return N[1].map(function(t){return j[n][t[1]]=a[n][t[0]]})}),N=N[0].concat(N[1]).map(function(n){return n[1]}),A=m.map(function(t){var r;return(r=d.filter(function(n){return!f.filter(function(r){return n[r]!==t[r]}).length})).length||(r=[{}]),r.map(function(r){return Object.fromEntries(f.map(function(n){return[n,t[n]]}).concat(p.filter(function(t){return!n(t,f)}).map(function(r){return[n(r,l)?o(h,r):r,t[r]]}),l.filter(function(t){return!n(t,f)}).map(function(t){return[n(t,p)?o(y,t):t,r[t]]})))})}),k=A.reduce(function(n,t){return n.concat(t)},[]),t({name:u.name||"unnamed",head:N,body:k},j)},split:function(n){var r,e,u,a,i,o,f,c,s;if(r=n.data,e=n.col,r=this.asDb(r),u=[].concat(r.head),!~(a=u.indexOf(e)))return r;u.splice(a,1),i={},["mag","unit","type"].map(function(n){var u,a;return i[n]=t({},r[n]),a=(u=i[n])[e],delete u[e],a}),o={},r.body.filter(function(n){var t;return(o[t=n[e]]||(o[t]=[])).push(n)}),f=[];for(c in o)s=o[c],f.push(t({name:(r.name||"unnamed")+""+this._sep+c,head:u,body:s},JSON.parse(JSON.stringify(i))));return f},pivot:function(n){var t,r,e,u,a,i=this;return null==n&&(n={}),t=n.data,r=n.col,e=n.joinCols,null==(u=n.simpleHead)&&(u=!1),a=this.split({data:t,col:r}),a=a.map(function(n){return i.shrink({data:n,cols:n.head.filter(function(n){return n!==r})})}),this.join({ds:a,joinCols:e,simpleHead:u})},unpivot:function(t){var r,e,u,a,i,o,f,c;return null==t&&(t={}),r=t.data,e=t.cols,u=t.name,a=t.order,u||(u="item"),null==a&&(a=0),i=this._sep,r=this.asDb(r),o=r.head.filter(function(t){return!n(t,e)}).map(function(n){return n.split(i)}),f=Array.from(new Set(o.map(function(n){return n[a]}))),c=f.map(function(n){var t,f;return t=e.map(function(n){return[n,n]}),f=o.filter(function(t){return t[a]===n}).map(function(n){return[n.join(i),n.filter(function(n,t){return t!==a}).join(i)]}),{name:r.name,head:e.concat([u],f.map(function(n){return n[1]})),body:r.body.map(function(r){return Object.fromEntries([[u,n]].concat(t.concat(f).map(function(n){return[n[1],r[n[0]]]})))})}}),this.concat(c)},group:function(t){var r,e,u,a,i,o,f,c,s,p,l;null==t&&(t={}),r=t.data,e=t.cols,u=t.aggregator,a=t.groupFunc,u||(u={}),e=Array.isArray(e)?e:[e],r=this.asDb(r),i=r.head.filter(function(t){return!n(t,e)&&null!==u[t]}),o=Array.from(new Set(r.body.map(function(n){return JSON.stringify(Object.fromEntries(e.map(function(t){return[t,n[t]]})))}))),f={},o.map(function(n){var t,r,e,u,i;if(t=JSON.parse(n),"function"==typeof a)r=a(t);else{e=a||{},r={};for(u in t)i=t[u],r[u]="function"==typeof e[u]?e[u](i):i}return(Array.isArray(r)?r:[r]).map(function(t){return t=JSON.stringify(t),f[t]||(f[t]=new Set),f[t].add(n)})}),s=[];for(p in f)s.push(p);return c=s,l=c.map(function(n){var t,a;return t=Array.from(f[n]),n=JSON.parse(n),t=t.map(function(n){return n=JSON.parse(n),r.body.filter(function(t){return 0===e.filter(function(r){return t[r]!==n[r]}).length})}).reduce(function(n,t){return n.concat(t)},[]),a=Object.fromEntries(i.map(function(n){var r,e;return r=t.map(function(t){return t[n]}),e=u[n]?u[n](r):r.length,[n,e]})),e.map(function(t){return a[t]=n[t]}),a}),{head:e.concat(i),body:l,name:r.name}},agg:{average:function(n){return n.reduce(function(n,t){return n+(isNaN(+t)?0:+t)},0)/(n.length||1)},sum:function(n){return n.reduce(function(n,t){return n+(isNaN(+t)?0:+t)},0)},count:function(n){return n.length},first:function(n){return n[0]||""}},shrink:function(t){var r,e;return r=t.data,e=t.cols,r=this.asDb(r),r.head=r.head.filter(function(t){return n(t,e)}),r.body=r.body.map(function(n){return Object.fromEntries(r.head.map(function(t){return[t,n[t]]}))}),["unit","mag","type"].filter(function(n){return r[n]}).map(function(n){return r[n]=Object.fromEntries(r.head.map(function(t){return[t,r[n][t]]}))}),r},rename:function(n){var t,r;return t=n.data,r=n.map,t=this.asDb(t),t.body=t.body.map(function(n){return Object.fromEntries(t.head.map(function(t){var e;return[(e=r[t])?e:t,n[t]]}))}),["unit","mag","type"].filter(function(n){return t[n]}).map(function(n){return t[n]=Object.fromEntries(t.head.map(function(e){return[r[e]||e,t[n][e]]}))}),t.head=t.head.map(function(n){var t;return(t=r[n])?t:n}),t}},"undefined"!=typeof module&&null!==module?module.exports=r:"undefined"!=typeof window&&null!==window&&(window.datum=r),r.type={R:function(n){var t,e,u,a;return null==n&&(n={}),t=n.data.filter(function(n){return!(!n||""===(n+"").trim())}),e=t.filter(function(n){return!isNaN(parseFloat(n))}).length,u=e/t.length,((a=r.type.O(n))===u||a>.9)&&(u=.99*a),u},O:function(n){var t,r,e,u,a,i,o;for(null==n&&(n={}),(t=[].concat(n.data)).sort(function(n,t){return t-n}),r={},e=1,u=t.length;e<u;++e)a=e,isNaN(t[a])||isNaN(t[a-1])?r[t[a]>t[a-1]?t[a]+":"+t[a-1]:t[a-1]+":"+t[a]]=!0:i=t[a]-t[a-1],r[i]=!0;return 1/(function(){var n=[];for(o in r)n.push(o);return n}().filter(function(n){return"0"!==n}).length||2)},N:function(n){var t,e;return null==n&&(n={}),t=1-r.type.R(n),(e=r.type.C(n))>.85&&(t=.99*e),t},C:function(n){var t,e,u,a,i,o;return null==n&&(n={}),t=Array.from(new Set(n.data)).length,e=n.data.length,u=(a=(i=1-((o=t-2)>0?o:0)/e-1/e)>0?i:0)<1?a:1,r.type.R(n)&&(u*=.9),u},get:function(n){var t,e,u,a,i,o,f,c,s;for(e=(t=r.asDb(n)).head,u=t.body,a=[],i=0,o=e.length;i<o;++i)f=e[i],c=u.map(function(n){return n[f]}),(s=["R","O","N","C"].map(function(n){return[n,r.type[n]({data:c})]})).sort(function(n,t){return t[1]-n[1]}),a.push({key:f,types:Object.fromEntries(s),type:s[0][0]});return a},bind:function(n,t,e){var u,a,i,o,f,c,s,p,l,m,d,h,y,b,v;for(null==n&&(n=[]),null==t&&(t={}),e||(e=r.type.get(n)),(u=function(){var n,r=[];for(a in n=t)i=n[a],r.push({k:a,v:i});return r}().filter(function(n){return!n.v.passive})).sort(function(n,t){var r,e,u,a;return 0!=(r=(n.v.priority||100)-(t.v.priority||100))?r:(e=[n.v.type||"R",t.v.type||"R"].map(function(n){return Math.min.apply(Math,function(){var t,r,e=[];for(t=0,r=n.length;t<r;++t)e.push(t);return e}().map(function(t){return"CONRI".indexOf(n[t])}))}),u=e[0],a=e[1],u-a)}),o=0,f=u.length;o<f;++o)for((c=u[o]).bind=null,p=0,l=(s=c.v.type||"RINOC").length;p<l;++p){for(d=s[m=p],e.sort(function(n,t){var r;return r=(t.types[d]||0)-(n.types[d]||0),t.types[d]===n.types[d]&&"R"===d?(n.types.O||0)-(t.types.O||0):r}),h=0,y=e.length;h<y;++h)if(m=h,!(null==(b=e[m]).types[d]||b.types[d]<.5||b.used||"C"===d&&b.types.R>.5)){c.bind=c.v.multiple?[b]:b,b.used=!0;break}if(c.bind)break}for(o=0,f=u.length;o<f;++o)if((c=u[o]).v.multiple)for(p=0,l=(s=c.v.type||"RNOC").length;p<l;++p)for(d=s[m=p],e.sort(function(n,t){var r;return r=(t[d]||0)-(n[d]||0),t[d]===n[d]&&"R"===d?(n.O||0)-(t.O||0):r}),h=0,y=e.length;h<y;++h)(b=e[m=h]).types[d]<.5||b.used||"C"===d&&b.types.R>.5||(c.bind.push(b),b.used=!0);for(v={},o=0,f=u.length;o<f;++o)(c=u[o]).bind&&(v[c.k]=c.bind,(Array.isArray(c.bind)?c.bind:[c.bind]).map(function(t){var r;return n.unit&&(t.unit=n.unit[t.key]||""),r=t.used,delete t.used,r}));return v}},r.sample={context:{},C:["books","business","education","entertainment","finance","food","games","health","lifestyle","medical","music","navigation","news","photography","productivity","social","network","sports","travel","utilities","weather"],N:["The Perfect Storm","Philadelphia Story","Planet of the Apes","Patton","Pocahontas","Pinoccio","Quills","Raiders of the Lost Ark","Romeo and Juliet","Snow White","Shine","Some Like It Hot","Stardust","Startrek","The Seven Year Itch","The Sound of Music","Sabrina","Sixth Sense","The Silence of the Lambs","Stargate","Sunset Boulevard","Superman"],generate:function(n){var t,e,u,a,i,o,f,c,s,p,l,m,d,h,y,b,v,g;t=n.count,e=n.binding,a=(u=[{raw:[],binding:{}},0,t||10])[0],i=u[1],t=u[2],o||(o={});for(f in e)c=e[f],s=(Array.isArray(c)?c:[c]).map(function(n,t){var r,e;return r=n.key||"field-"+i,e=n.name||r,o[i]={key:r,name:e,hint:n},(i+=1)-1}),Array.isArray(c)?a.binding[f]=s.map(function(n){var t;return{key:(t=o[n]).key,name:t.name}}):a.binding[f]={key:(u=o[s[0]]).key,name:u.name};for(p=Math.round(100*Math.random()),l=0;l<t;++l){m=l,d={};for(f in o)c=o[f],h=c.hint,y=function(){var n,e;switch(h.type){case"R":return b=h.range||[0,100],v=Math.random()*(b[1]-b[0])+b[0],b[1]-b[0]<1?v:Math.round(v);case"N":return r.sample.N[m%r.sample.N.length];case"C":return g=(n=null!=h.count?h.count:(n=Math.round(t/10))>4?n:4)<(e=r.sample.C.length)?n:e,r.sample.C[(h.random?Math.floor(Math.random()*t):m)%g];case"O":return Math.floor(m/(null!=h.repeat?h.repeat:1))+(null!=h.offset?h.offset:p);default:return"..."}}(),d[c.key]=y;a.raw.push(d)}return a}}}).call(this);
