!function(){var t;function p(t,e){var n,r={}.hasOwnProperty;for(n in e)r.call(e,n)&&(t[n]=e[n]);return t}(t=function(t){var e=this;return this.root="string"==typeof(t=null==t?{}:t).root?document.querySelector(t.root):t.root,this.opt=t,this.evtHandler={},this.useBundle=null==t.useBundle||t.useBundle,this.view=t.view,this.autotab=t.autotab||!1,this._ctrlobj={},this._ctrllist=[],this._tabobj={},this._tablist=[],this._meta=t.meta||{},this._tab=t.tab||{},this._val={},this.typemap=t.typemap||null,this.mgr=this.mgrChain=new block.manager({registry:function(t){var e=t.name,n=t.version,t=t.path;throw new Error("@plotdb/konfig: "+e+"@"+n+"/"+t+" is not supported")}}),t.manager&&(this.mgr=t.manager,this.mgr.chain(this.mgrChain)),this.init=proxise.once(function(){return e._init()},function(){return e._val}),this._updateDebounced=debounce(150,function(){return e._update()}),this.doDebounce=!(null!=t.debounce)||t.debounce,this.update=function(){return e.doDebounce?e._updateDebounced():e._update()},this}).views={simple:function(){var t=this;return new ldview({root:this.root,initRender:!1,handler:{ctrl:{list:function(){return t._ctrllist.filter(function(t){return!t.meta.hidden})},key:function(t){return t.key},init:function(t){var e=t.node,t=t.data;return e.appendChild(t.root)}}}})},default:function(){var n=this;return new ldview({root:this.root,initRender:!1,handler:{tab:{list:function(){return n._tablist.sort(function(t,e){return e.tab.order-t.tab.order}),n._tablist},key:function(t){return t.key},view:{text:{name:function(t){return t.ctx.tab.id}},handler:{ctrl:{list:function(t){var e=t.ctx;return n._ctrllist.filter(function(t){return t.meta.tab===e.tab.id&&!t.meta.hidden})},key:function(t){return t.key},init:function(t){var e=t.node,t=t.data;return e.appendChild(t.root)},handler:function(t){t.node;return t.data.itf.render()}}}}}}})},recurse:function(){var t,n=this,e=ld$.find(this.root,"[ld=template]",0);return e.parentNode.removeChild(e),e.removeAttribute("ld-scope"),new ldview(p(t={},{ctx:{tab:{id:null}},template:e,root:this.root,initRender:!1,text:{name:function(t){t=t.ctx;return t.tab?(t.tab.name||"")+"":""}},handler:{tab:{list:function(t){var e=t.ctx,t=n._tablist.filter(function(t){return!(t.tab.parent.id||e.tab.id)||t.tab.parent&&e.tab&&t.tab.parent.id===e.tab.id});return t.sort(function(t,e){return e.tab.order-t.tab.order}),t},key:function(t){return t.key},view:t},ctrl:{list:function(t){var e=t.ctx;return n._ctrllist.filter(function(t){return!!e.tab&&(t.meta.tab===e.tab.id&&!t.meta.hidden)})},key:function(t){return t.key},init:function(t){var e=t.node,t=t.data;return e.appendChild(t.root)},handler:function(t){var e=t.node,t=t.data;return e.style.flex="1 1 "+16*(t.meta.weight||1)+"%",t.itf.render()}}}}))}},t.prototype=p(Object.create(Object.prototype),{on:function(t,e){var n;return((n=this.evtHandler)[t]||(n[t]=[])).push(e)},fire:function(t){for(var e,n,r,i,o=[],a=[],u=1,l=arguments.length;u<l;++u)a.push(arguments[u]);for(e=a,u=0,r=(n=this.evtHandler[t]||[]).length;u<r;++u)i=n[u],o.push(i.apply(this,e));return o},render:function(){if(this.view)return this._view||("string"==typeof this.view?this._view=t.views[this.view].apply(this):this._view=this.view),this._view.render()},meta:function(t){var e=t.meta,t=t.tab;return null!=e&&(this._meta=e),null!=t&&(this._tab=t),this.build(!0)},get:function(){return JSON.parse(JSON.stringify(this._val))},set:function(t){return this._val=JSON.parse(JSON.stringify(t)),this.render()},_update:function(){return this.fire("change",this._val)},_init:function(){var e=this;return this.mgr.init().then(function(){return e.useBundle&&t.bundle||[]}).then(function(t){return e.mgr.set(t.map(function(t){return new block.class((t.manager=e.mgr,t))}))}).then(function(){return e.build()}).then(function(){return e._val})},_prepareTab:function(t){var e;return this._tabobj[t.id]?((e=this._tabobj[t.id]).tab=t,e):(e=document.createElement("div"),this._tablist.push(e={root:e,tab:t,key:Math.random().toString(36).substring(2)}),this._tabobj[t.id]=e)},_prepareCtrl:function(n,e,r){var t,i,o,a,u=this,l=n.id;return r[l]?Promise.resolve():(o=n.block?(t=(o={name:(o=n.block).name,version:o.version,path:o.path}).name,i=o.version,o.path):this.typemap&&(a=this.typemap(n.type))?(t=a.name,i=a.version,a.path):(t=(o=[n.type,"master",""])[0],i=o[1],o[2]),this.mgr.get({name:t,version:i,path:o}).then(function(t){return t.create({data:n})}).then(function(t){var e=document.createElement("div");return null==n.tab&&(n.tab="default"),u._tabobj[n.tab]||u._prepareTab({id:n.tab,name:n.tab,depth:0,parent:{}}),u._ctrllist.push(r[l]={block:t,meta:n,root:e,key:Math.random().toString(36).substring(2)}),t.attach({root:e}).then(function(){return t.interface()}).then(function(t){return r[l].itf=t})}).then(function(t){return e[l]=t.get(),t.on("change",function(t){return e[l]=t,u.update()})}).then(function(){return r[l]}))},build:function(t){var e=this;return this._buildTab(t=null==t?!1:t),this._buildCtrl(t).then(function(){return e.render()}).then(function(){return e.update()})},_buildCtrl:function(t){var d=this,c=[],s=function(t,e,n,r){var i,o,a,u,l=[];if(null==e&&(e={}),null==n&&(n={}),t&&"object"==typeof t&&(i=t.child||t,!(o=t.child?t.tab:null)&&d.autotab&&r&&(o=r),i)){for(a in i)(u=i[a]).type?(p((u.id=a,u),o&&!u.tab?{tab:o}:{}),c.push(d._prepareCtrl(u,e,n))):l.push(s(u,e[a]||(e[a]={}),n[a]||(n[a]={}),a));return l}};return(t=null==t?!1:t)&&this._ctrllist&&this._ctrllist.map(function(t){var e=t.block,t=t.root;if(e.destroy&&e.destroy(),t.parentNode)return t.parentNode.removeChild(t)}),!t&&this._val||(this._val={}),!t&&this._ctrlobj||(this._ctrlobj={}),!t&&this._ctrllist||(this._ctrllist=[]),s(this._meta,this._val,this._ctrlobj,null),Promise.all(c)},_buildTab:function(t){var s,f=this;if(null==t&&(t=!1),"ctrl"!==this.renderMode)return t&&this._tablist&&this._tablist.map(function(t){t=t.root;if(t.parentNode)return t.parentNode.removeChild(t)}),!t&&this._tablist||(this._tablist=[]),!t&&this._tab||(this._tab={}),t&&(this._tabobj={}),(s=function(n,t,e){var r,i,o,a,u,l,d,c=[];if(null==t&&(t=0),null==e&&(e={}),n&&(Array.isArray(n)||"object"==typeof n)){for(a=0,u=(r=Array.isArray(n)?n:function(){var t,e=[];for(i in t=n)o=t[i],e.push({id:i,v:o});return e}().map(function(t,e){var n=t.id,t=t.v;return t.id=n,t})).length;a<u;++a)p(((d=r[l=a]).depth=t,d.parent=e,d),o.name?{}:{name:d.id}),p(d,null==o.order?{order:l}:{}),f._prepareTab(d),c.push(s(d.child,(d.depth||0)+1,d));return c}})(this._tab)}}),"undefined"!=typeof module&&null!==module?module.exports=t:"undefined"!=typeof window&&null!==window&&(window.konfig=t),t.bundle=(t.bundle||[]).concat([{name:"@plotdb/konfig.widget.default",version:"master",path:"base",code:'<div><div class="d-flex"><div class="flex-grow-1 d-flex align-items-center"><div ld="name"></div><div ld="hint">?</div></div><plug name="ctrl"></plug></div><plug name="config"></plug><style type="text/css">[ld=hint]{margin-left:.5em;width:1.2em;height:1.2em;border-radius:50%;background:rgba(0,0,0,0.1);font-size:10px;line-height:1.1em;text-align:center;cursor:pointer}</style><script type="@plotdb/block">(function(n){return n()})(function(){var n;n={pkg:{dependencies:[{name:"ldview",version:"main",path:"index.min.js"},{name:"@loadingio/debounce.js",version:"main",path:"debounce.min.js"},{name:"ldcover",version:"main",path:"index.min.js"},{name:"ldcover",version:"main",path:"index.min.css"}]},init:function(n){var t,e,r,i,o,a,u=this;t=n.root,e=n.context,r=n.data,i=n.pubsub,o=n.t;this.data={};i.on("init",function(n){var t;n==null&&(n={});u.itf=t={evtHandler:{},get:n.get||function(){},set:n.set||function(){},render:function(){a.render();if(n.render){return n.render()}},on:function(n,e){var r=this;return(Array.isArray(n)?n:[n]).map(function(n){var t;return((t=r.evtHandler)[n]||(t[n]=[])).push(e)})},fire:function(n){var t,e,r,i,o,a,u,c=[];e=[];for(r=1,i=arguments.length;r<i;++r){e.push(arguments[r])}t=e;for(r=0,a=(o=this.evtHandler[n]||[]).length;r<a;++r){u=o[r];c.push(u.apply(this,t))}return c}};return a.render("hint")});i.on("event",function(n){var t,e,r,i;e=[];for(r=1,i=arguments.length;r<i;++r){e.push(arguments[r])}t=e;return u.itf.fire.apply(u.itf,[n].concat(t))});return a=new ldview({root:t,text:{name:function(){return o(r.name||r.id||"")}},handler:{hint:function(n){var t;t=n.node;return t.classList.toggle("d-none",!r.hint)}},action:{click:{hint:function(){return alert(o(r.hint||"no hint"))}}}})},interface:function(){return this.itf}};return n});<\/script></div>'},{name:"@plotdb/konfig.widget.default",version:"master",path:"boolean",code:'<div><script type="@plotdb/block">(function(t){return t()})(function(){var t;t={pkg:{extend:{name:"@plotdb/konfig.widget.default",version:"master",path:"base"},dependencies:[]},init:function(t){var e,n,r,i,a,s,o;e=t.root,n=t.context,r=t.pubsub,i=t.data;a=n.ldview;s={state:i["default"]||false};r.fire("init",{get:function(){return s.state},set:function(t){return s.state=!!t}});return o=new a({root:e,action:{click:{switch:function(){s.state=!s.state;o.render("switch");return r.fire("event","change",s.state)}}},handler:{switch:function(t){var e;e=t.node;return e.classList.toggle("on",s.state)}}})}};return t});<\/script></div>'},{name:"@plotdb/konfig.widget.default",version:"master",path:"button",code:'<div><script type="@plotdb/block">(function(t){return t()})(function(){var t;t={pkg:{extend:{name:"@plotdb/konfig.widget.default",version:"master",path:"base"},dependencies:[],i18n:{"zh-TW":{config:"設定"}}},init:function(t){var n,e,r,i,a,o,u,c,d;n=t.root,e=t.context,r=t.data,i=t.pubsub,a=t.t;o=e.ldview,u=e.ldcolor;c={data:r["default"]};i.fire("init",{get:function(){return c.data},set:function(t){return c.data=t}});return d=new o({root:n,action:{click:{button:function(){return Promise.resolve(r.cb(c.data)).then(function(t){if(c.data===t){return}return i.fire("event","change",c.data=t)})}}},text:{button:function(){return r.text||"..."}}})}};return t});<\/script></div>'},{name:"@plotdb/konfig.widget.default",version:"master",path:"choice",code:'<div><script type="@plotdb/block">(function(e){return e()})(function(){var e;e={pkg:{extend:{name:"@plotdb/konfig.widget.default",version:"master",path:"base"},dependencies:[]},init:function(e){var t,n,r,u,i,a,o;t=e.root,n=e.context,r=e.data,u=e.pubsub;i=r;a=n.ldview;u.fire("init",{get:function(){return o.get("select").value},set:function(e){return o.get("select").value=e}});return o=new a({root:t,action:{change:{select:function(e){var t;t=e.node;return u.fire("event","change",t.value)}}},handler:{option:{list:function(){return i.values},key:function(e){return e},init:function(e){var t,n;t=e.node,n=e.data;if(i["default"]===n){return t.setAttribute("selected","selected")}},handler:function(e){var t,n;t=e.node,n=e.data;t.setAttribute("value",n);return t.textContent=n}}}})}};return e});<\/script></div>'},{name:"@plotdb/konfig.widget.default",version:"master",path:"color",code:'<div><script type="@plotdb/block">(function(e){return e()})(function(){var e;e={pkg:{extend:{name:"@plotdb/konfig.widget.default",version:"master",path:"base"},dependencies:[{name:"ldcolor",version:"main",path:"ldcolor.min.js",async:false},{name:"@loadingio/ldcolorpicker",version:"main",path:"ldcp.min.js"},{name:"@loadingio/ldcolorpicker",version:"main",path:"ldcp.min.css",global:true}]},init:function(e){var o,t,n,r,c,l,a,i,d=this;o=e.root,t=e.context,n=e.pubsub,r=e.data;c=t.ldview,l=t.ldcolor,a=t.ldcolorpicker;n.fire("init",{get:function(){if(d.ldcp){return l.web(d.ldcp.getColor())}},set:function(e){return d.ldcp.set(e)}});this.ldcp=new a(o,{className:"round shadow-sm round flat compact-palette no-button no-empty-color vertical",palette:(r["default"]?[r["default"]]:[]).concat(r.palette||["#cc0505","#f5b70f","#9bcc31","#089ccc"]),context:r.context||"random",exclusive:r.exclusive!=null?r.exclusive:true});i=new c({ctx:{color:l.web(this.ldcp.getColor())},root:o,handler:{color:function(e){var o,t;o=e.node,t=e.ctx;if(o.nodeName.toLowerCase()==="input"){return o.value=t.color}else{return o.style.backgroundColor=t.color}}}});return this.ldcp.on("change",function(e){var o;o=l.web(e);n.fire("event","change",o);i.setCtx({color:o});return i.render()})}};return e});<\/script></div>'},{name:"@plotdb/konfig.widget.default",version:"master",path:"font",code:'<div><script type="@plotdb/block">(function(n){return n()})(function(){var n;n={pkg:{extend:{name:"@plotdb/konfig.widget.default",version:"master",path:"base"},dependencies:[{name:"@plotdb/load",version:"main",path:"index.min.js"},{name:"@plotdb/choose",version:"main",path:"index.min.js"},{name:"@plotdb/choose",version:"main",path:"index.min.css",global:true}]},init:function(n){var t,e,o,i,r,a,u,c,f;t=n.root,e=n.context,o=n.data,i=n.pubsub;r=e.ldview,a=e.ldcover,u=e.ChooseFont;c={font:{}};i.fire("init",{get:function(){return c.font},set:function(n){return c.fontview.get("input").value=n||""}});return f=new r({root:t,init:{ldcv:function(n){var t;t=n.node;return c.ldcv=new a({root:t})},inner:function(n){var t;t=n.node;c.cf=new u({root:t,metaUrl:"/assets/lib/choosefont.js/main/fontinfo/meta.json",base:"https://plotdb.github.io/xl-fontset/alpha"});return c.cf.init().then(function(){return c.cf.on("choose",function(n){return c.ldcv.set(n)})})}},action:{click:{button:function(){return c.ldcv.get().then(function(n){if(!n){return}return c.font=n})}}},text:{"font-name":function(){return c.font.name||"Font"}}})}};return n});<\/script></div>'},{name:"@plotdb/konfig.widget.default",version:"master",path:"number",code:'<div><script type="@plotdb/block">(function(e){return e()})(function(){var e;e={pkg:{extend:{name:"@plotdb/konfig.widget.default",version:"master",path:"base"},dependencies:[{name:"ldslider",version:"main",path:"ldrs.min.css"},{name:"ldslider",version:"main",path:"ldrs.min.js"}]},init:function(e){var n,t,r,i,o,l,u,a;n=e.root,t=e.context,r=e.data,i=e.pubsub;o=t.ldview,l=t.ldslider;u={};i.fire("init",{get:function(){return u.ldrs.get()},set:function(e){return u.ldrs.set(e)},render:function(){return u.ldrs.update()}});if(r.from!=null){console.warn("[@plotdb/konfig] ctrl should use `default` for default value.\\nplease update your config to comply with it.")}if(r["default"]!=null){if(typeof r["default"]==="object"){import$(r,r["default"])}else if(typeof r["default"]==="number"){r.from=r["default"]}}return a=new o({root:n,action:{click:{switch:function(){return u.ldrs.edit()}}},init:{ldrs:function(e){var n;n=e.node;u.ldrs=new l(import$({root:n},Object.fromEntries(["min","max","step","from","to","exp","limitMax","range","label"].map(function(e){return[e,r[e]]}).filter(function(e){return e[1]!=null}))));return u.ldrs.on("change",function(e){return i.fire("event","change",e)})}}})}};return e});function import$(e,n){var t={}.hasOwnProperty;for(var r in n)if(t.call(n,r))e[r]=n[r];return e}<\/script></div>'},{name:"@plotdb/konfig.widget.default",version:"master",path:"palette",code:'<div><script type="@plotdb/block">(function(e){return e()})(function(){var e;e={pkg:{extend:{name:"@plotdb/konfig.widget.default",version:"master",path:"base"},dependencies:[{name:"ldcolor",version:"main",path:"ldcolor.min.js",async:false},{name:"ldslider",version:"main",path:"ldrs.min.js",async:false},{name:"ldslider",version:"main",path:"ldrs.min.css"},{name:"@loadingio/ldcolorpicker",version:"main",path:"ldcp.min.js",async:false},{name:"@loadingio/ldcolorpicker",version:"main",path:"ldcp.min.css"},{name:"@loadingio/vscroll",version:"main",path:"index.min.js"},{name:"ldpalettepicker",version:"main",path:"index.min.css"},{name:"ldpalettepicker",version:"main",path:"index.min.js",async:false},{name:"ldpalettepicker",version:"main",path:"all.palettes.js"}]},init:function(e){var n,t,r,a,l,i,o,s,p,d,c;n=e.root,t=e.context,r=e.pubsub,a=e.data,l=e.i18n;i=t.ldview,o=t.ldcolor,s=t.ldpp,p=t.ldcover;d={pal:a.palette||s.defaultPalette};r.fire("init",{get:function(){return d.pal},set:function(e){d.pal=e;return c.render()}});n=ld$.find(n,"[plug=config]",0);c=new i({root:n,action:{click:{ldp:function(){var e;if(!d.ldpp){e=Array.isArray(a.palettes)?a.palettes:typeof a.palettes==="string"?s.get(a.palettes):s.get("all");d.ldpp=new s({root:c.get("ldcv"),ldcv:true,useClusterizejs:true,i18n:l,palette:a.palette,palettes:e,useVscroll:true})}return d.ldpp.get().then(function(e){if(!e){return}d.pal=e;c.render("color");return r.fire("event","change",d.pal)})}}},handler:{color:{list:function(){var e;return(e=d.pal||(d.pal={})).colors||(e.colors=[])},key:function(e){return o.web(e)},handler:function(e){var n,t;n=e.node,t=e.data;return n.style.backgroundColor=o.web(t)}}}});return c.render()}};return e});<\/script></div>'},{name:"@plotdb/konfig.widget.default",version:"master",path:"paragraph",code:'<div><script type="@plotdb/block">(function(t){return t()})(function(){var t;t={pkg:{extend:{name:"@plotdb/konfig.widget.default",version:"master",path:"base"},dependencies:[]},init:function(t){var n,e,r,a,i,o,u,d;n=t.root,e=t.context,r=t.data,a=t.pubsub;i={data:r["default"]||""};o=e.ldview,u=e.ldcover;a.fire("init",{get:function(){return i.data||""},set:function(t){i.data=t||"";return d.render()}});return d=new o({root:n,init:{ldcv:function(t){var n;n=t.node;return i.ldcv=new u({root:n})}},handler:{panel:function(t){var n;n=t.node},input:function(t){var n;n=t.node;return n.value=i.data||""},textarea:function(t){var n;n=t.node;return n.value=i.data||""}},action:{click:{input:function(t){var n,e,r;n=t.node;e=d.get("input").getBoundingClientRect();r=d.get("panel").getBoundingClientRect();import$(d.get("panel").style,{width:e.width+"px",left:e.left+"px",top:e.top+"px"});return i.ldcv.get().then(function(t){var n;if(t!=="ok"){return}n=d.get("textarea").value;if(i.data!==n){a.fire("event","change",n)}i.data=n;return d.render()})}}}})}};return t});function import$(t,n){var e={}.hasOwnProperty;for(var r in n)if(e.call(n,r))t[r]=n[r];return t}<\/script></div>'},{name:"@plotdb/konfig.widget.default",version:"master",path:"popup",code:'<div><script type="@plotdb/block">(function(t){return t()})(function(){var t;t={pkg:{extend:{name:"@plotdb/konfig.widget.default",version:"master",path:"base"},dependencies:[],i18n:{"zh-TW":{config:"設定"}}},init:function(t){var n,e,r,u,o,i,a,f,c,p,d;n=t.root,e=t.context,r=t.data,u=t.pubsub,o=t.t;i={};a=function(t){var n;if(!t){return null}else if(n=t.data){return n}else{return t}};f=function(t){var n;i.text=(n=t&&t.text)?n:typeof t==="string"?t+"":o("config");return d.render("button")};c=e.ldview,p=e.ldcolor;u.fire("init",{get:function(){return r.popup.data()},set:function(t){r.popup.data(t);return f(r.popup.data())}});return d=new c({root:n,action:{click:{button:function(){return r.popup.get().then(function(t){u.fire("event","change",a(t));return f(t)})}}},text:{button:function(){var t;if(t=i.text){return t}else{return o("config")}}}})}};return t});<\/script></div>'},{name:"@plotdb/konfig.widget.default",version:"master",path:"text",code:'<div><script type="@plotdb/block">(function(n){return n()})(function(){var n;n={pkg:{extend:{name:"@plotdb/konfig.widget.default",version:"master",path:"base"},dependencies:[]},init:function(n){var e,t,u,i,r,a;e=n.root,t=n.context,u=n.data,i=n.pubsub;r=t.ldview;i.fire("init",{get:function(){return a.get("input").value||""},set:function(n){return a.get("input").value=n||""}});return a=new r({root:e,init:{input:function(n){var e;e=n.node;return e.value=u["default"]||""}},action:{input:{input:function(n){var e;e=n.node;return i.fire("event","change",e.value)}},change:{input:function(n){var e;e=n.node;return i.fire("event","change",e.value)}}}})}};return n});<\/script></div>'},{name:"@plotdb/konfig.widget.default",version:"master",path:"upload",code:'<div><script type="@plotdb/block">(function(t){return t()})(function(){var t;t={pkg:{extend:{name:"@plotdb/konfig.widget.default",version:"master",path:"base"},dependencies:[]},init:function(t){var e,n,i,u,r,o;e=t.root,n=t.context,i=t.data,u=t.pubsub;r=n.ldview;u.fire("init",{get:function(){return o.get("input").value||""},set:function(t){return o.get("input").value=t||""}});return o=new r({root:e,init:{input:function(t){var e;e=t.node;if(i.multiple){return e.setAttribute("multiple",true)}}},action:{change:{input:function(t){var e;e=t.node;return u.fire("event","change",e.files)}}}})}};return t});<\/script></div>'}])}();
