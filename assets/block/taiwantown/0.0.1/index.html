<div><script type="@plotdb/block">var mod;
module.exports = {
  pkg: {
    name: 'taiwantown',
    version: '0.0.1',
    extend: {
      name: "base",
      version: "0.0.1"
    },
    dependencies: [
      {
        url: "https://d3js.org/topojson.v2.min.js",
        async: false
      }, {
        url: "/js/work/map.list.js",
        async: false
      }, {
        url: "https://cdn.jsdelivr.net/npm/pdmaptw@0.0.2/dist/pdmaptw.min.js"
      }
    ]
  },
  init: function(arg$){
    var root, context, pubsub;
    root = arg$.root, context = arg$.context, pubsub = arg$.pubsub;
    return pubsub.fire('init', {
      mod: mod({
        context: context
      })
    }).then(function(it){
      return it[0];
    });
  }
};
mod = function(arg$){
  var context, d3, forceBoundary, ldColor, repeatString$, pdmaptw, counties, towns;
  context = arg$.context;
  d3 = context.d3, forceBoundary = context.forceBoundary, ldColor = context.ldColor, repeatString$ = context.repeatString$, pdmaptw = context.pdmaptw, counties = context.counties, towns = context.towns;
  return {
    sample: function(){
      var val;
      val = {
        counties: counties.map(function(d, i){
          return {
            val: Math.random(),
            county: d
          };
        }),
        towns: towns.map(function(d, i){
          return {
            val: Math.random(),
            town: d
          };
        })
      };
      return {
        raw: val.towns,
        binding: {
          color: {
            key: 'val'
          },
          name: {
            key: 'town'
          }
        }
      };
    },
    config: {},
    dimension: {
      name: {
        type: 'N',
        name: "國家"
      },
      color: {
        type: 'R',
        name: "顏色"
      }
    },
    init: function(){
      var this$ = this;
      this.obj = pdmaptw.create({
        root: this.svg,
        type: 'town',
        baseurl: 'https://cdn.jsdelivr.net/npm/pdmaptw@0.0.2/dist'
      });
      return this.obj.init().then(function(){
        return this$.obj.fit();
      });
    },
    parse: function(){
      var this$ = this;
      return d3.select(this.svg).selectAll('path').each(function(d, i){
        return d.data = this$.data.filter(function(it){
          return it.name === d.properties.name;
        })[0] || {};
      });
    },
    resize: function(){},
    render: function(){
      var this$ = this;
      this.color = d3.interpolateTurbo;
      if (this.cfg != null && this.cfg.palette) {
        this.color = d3.interpolateDiscrete(this.cfg.palette.colors.map(function(it){
          return ldColor.web(it.value || it);
        }));
      }
      return d3.select(this.svg).selectAll('path').transition().duration(350).attr('fill', function(d, i){
        return this$.color(d.data.color);
      });
    }
  };
};</script></div><div><script type="@plotdb/block">({
  pkg: {
    name: 'taiwantown',
    version: '0.0.1',
    dependencies: [
      {
        url: "https://d3js.org/d3.v4.js",
        async: false
      }, "https://d3js.org/d3-format.v2.min.js", "https://d3js.org/d3-array.v2.min.js", "https://d3js.org/topojson.v2.min.js", {
        url: "https://d3js.org/d3-color.v1.min.js",
        async: false
      }, {
        url: "https://d3js.org/d3-interpolate.v1.min.js",
        async: false
      }, {
        url: "https://d3js.org/d3-scale-chromatic.v1.min.js",
        async: false
      }, "/js/map.list.js", "https://cdn.jsdelivr.net/npm/pdmaptw@0.0.2/dist/pdmaptw.min.js"
    ]
  },
  init: function(arg$){
    var root, context, counties, towns, c;
    root = arg$.root, context = arg$.context;
    counties = context.counties.map(function(d, i){
      return {
        val: Math.random(),
        county: d
      };
    });
    towns = context.towns.map(function(d, i){
      return {
        val: Math.random(),
        town: d
      };
    });
    c = new chart({
      root: root,
      raw: towns,
      mod: this.mod({
        context: context
      }),
      binding: {
        color: {
          name: 'val'
        },
        name: {
          name: 'town'
        }
      }
    });
    c.init().then(function(){
      return c.render();
    });
    return this.c = c;
  },
  'interface': function(){
    return this.c;
  },
  mod: function(arg$){
    var context;
    context = arg$.context;
    return {
      init: function(){
        var this$ = this;
        this.obj = context.pdmaptw.create({
          root: this.svg,
          type: 'town',
          baseurl: 'https://cdn.jsdelivr.net/npm/pdmaptw@0.0.2/dist'
        });
        return this.obj.init().then(function(){
          return this$.obj.fit();
        });
      },
      parse: function(){
        var this$ = this;
        return d3.select(this.svg).selectAll('path').each(function(d, i){
          return d.data = this$.data.filter(function(it){
            return it.name === d.properties.name;
          })[0] || {};
        });
      },
      resize: function(){},
      render: function(){
        var this$ = this;
        this.color = d3.interpolateTurbo;
        if (config.pal) {
          this.color = d3.interpolateDiscrete(config.pal);
        }
        return d3.select(this.svg).selectAll('path').transition().duration(350).attr('fill', function(d, i){
          return this$.color(d.data.color);
        });
      }
    };
  }
});</script></div>